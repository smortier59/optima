Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var d=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(d);this.df.ownerCt=this;delete (this.dateFormat);var c=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(c);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])},onRender:function(e,d){if(this.isRendered){return}Ext.ux.form.DateTime.superclass.onRender.call(this,e,d);var f;if("below"===this.timePosition||"bellow"===this.timePosition){f=Ext.DomHelper.append(e,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)}else{f=Ext.DomHelper.append(e,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)}this.tableEl=f;this.wrap=f.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(f.child("td.ux-datetime-date"));this.tf.render(f.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){f.select("input").applyStyles({top:0})}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var g=this.el.findParent(".x-form-element",10,true);this.errorIcon=g.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden()},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(b){this.df.markInvalid(b);this.tf.markInvalid(b)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){if(!this.dateValue){return""}else{if(this.dateValue instanceof Date){return this.dateValue}else{return new Date(this.dateValue)}}},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(c){var b=String(this.startValue);if(this.wrapClick){c.focus();this.wrapClick=false}if(c===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var a=this.getValue();if(String(a)!==b){this.fireEvent("change",this,a,this.startValue)}this.hasFocus=false;this.fireEvent("blur",this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase()}},onSpecialKey:function(c,d){var b=d.getKey();if(b===d.TAB){if(c===this.df&&!d.shiftKey){d.stopEvent();this.tf.focus()}if(c===this.tf&&d.shiftKey){d.stopEvent();this.df.focus()}}if(b===d.ENTER){this.updateValue()}},setDate:function(b){this.df.setValue(b)},setTime:function(b){this.tf.setValue(b)},setSize:function(a,b){if(!a){return}if("below"===this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a)}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth)}}},setValue:function(d){if(!d&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!d){this.setDate("");this.setTime("");this.updateValue();return}}if("number"===typeof d){d=new Date(d)}else{if("string"===typeof d&&this.hiddenFormat){d=Date.parseDate(d,this.hiddenFormat)}}d=d?d:new Date(1970,0,1,0,0,0);var c,e;if(d instanceof Date){this.setDate(d);this.setTime(d);this.dateValue=d}else{c=d.split(this.dtSeparator);this.setDate(c[0]);if(c[1]){if(c[2]){c[1]+=c[2]}this.setTime(c[1])}}this.updateValue()},setVisible:function(b){if(b){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth(),a.getDate())}else{this.dateValue="";this.setTime("")}},updateTime:function(){var a=this.tf.getValue();if(a&&!(a instanceof Date)){a=Date.parseDate(a,this.tf.format)}if(a&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}if(this.dateValue instanceof Date){if(a){this.dateValue.setHours(a.getHours());this.dateValue.setMinutes(a.getMinutes());this.dateValue.setSeconds(a.getSeconds())}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var b=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=b}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(f){var b=f.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;b+=" "+(f.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var a=function(d){var c=Ext.util.Format.date(d,b);return c};return a}});Ext.reg("xdatetime",Ext.ux.form.DateTime);Ext.override(Ext.form.TimeField,{reconfigure:function(h,g,m){if(typeof this.minValue=="string"){this.minValue=this.parseDate(this.minValue)}if(typeof this.maxValue=="string"){this.maxValue=this.parseDate(this.maxValue)}this.increment=m;var l=this.parseDate(this.minValue);if(!l){l=new Date(this.initDate).clearTime()}var k=this.parseDate(this.maxValue);if(!k){k=new Date(this.initDate).clearTime().add("mi",(24*60)-1)}var j=[];while(l<=k){j.push([l.dateFormat(this.format)]);l=l.add("mi",this.increment)}this.store.loadData(j)}});Ext.ns("Sch.util");Sch.util.Date={betweenLesser:function(e,d,g){var f=e.getTime();return d.getTime()<=f&&f<g.getTime()},constrain:function(e,d,f){return Sch.util.Date.min(Sch.util.Date.max(e,d),f)},add:function(g,f,k){var j=g.clone();if(!f||k===0){return j}switch(f.toLowerCase()){case this.MILLI:j=new Date(g.getTime()+k);break;case this.SECOND:j=new Date(g.getTime()+(k*1000));break;case this.MINUTE:j=new Date(g.getTime()+(k*60000));break;case this.HOUR:j=new Date(g.getTime()+(k*3600000));break;case this.DAY:j.setDate(g.getDate()+k);break;case this.WEEK:j.setDate(g.getDate()+k*7);break;case this.MONTH:var h=g.getDate();if(h>28){h=Math.min(h,this.add(g.getFirstDateOfMonth(),this.MONTH,k).getLastDateOfMonth().getDate())}j.setDate(h);j.setMonth(j.getMonth()+k);break;case this.QUARTER:j=this.add(g,this.MONTH,3);break;case this.YEAR:j.setFullYear(g.getFullYear()+k);break}return j},getMeasuringUnit:function(b){switch(b){case this.WEEK:return Sch.util.Date.DAY;break;default:return b;break}},getDurationInUnit:function(f,e,h){var g;switch(h){case this.QUARTER:g=Math.round(Sch.util.Date.getDurationInMonths(f,e)/3);break;case this.MONTH:g=Math.round(Sch.util.Date.getDurationInMonths(f,e));break;case this.WEEK:g=Math.round(Sch.util.Date.getDurationInDays(f,e))/7;break;case this.DAY:g=Math.round(Sch.util.Date.getDurationInDays(f,e));break;case this.HOUR:g=Math.round(Sch.util.Date.getDurationInHours(f,e));break;case this.MINUTE:g=Math.round(Sch.util.Date.getDurationInMinutes(f,e));break;case this.SECOND:g=Math.round(Sch.util.Date.getDurationInSeconds(f,e));break;case this.MILLI:g=Math.round(Sch.util.Date.getDurationInMilliseconds(f,e));break}return g},getUnitToBaseUnitRatio:function(d,c){if(d===c){return 1}switch(d){case this.YEAR:switch(c){case this.QUARTER:return 4;break;case this.MONTH:return 12;break}break;case this.QUARTER:switch(c){case this.YEAR:return 1/4;break;case this.MONTH:return 3;break}break;case this.MONTH:switch(c){case this.YEAR:return 12;break;case this.QUARTER:return 3;break}break;case this.WEEK:switch(c){case this.DAY:return 1/7;break;case this.HOUR:return 1/168;break}break;case this.DAY:switch(c){case this.WEEK:return 7;break;case this.HOUR:return 1/24;break;case this.MINUTE:return 1/1440;break}break;case this.HOUR:switch(c){case this.DAY:return 24;break;case this.MINUTE:return 1/60;break}break;case this.MINUTE:switch(c){case this.HOUR:return 60;break;case this.SECOND:return 1/60;break;case this.MILLI:return 1/60000;break}break;case this.SECOND:switch(c){case this.MILLI:return 1/1000;break}break}return -1},getDurationInMilliseconds:function(d,c){return(c-d)},getDurationInSeconds:function(d,c){return(c-d)/1000},getDurationInMinutes:function(d,c){return(c-d)/60000},getDurationInHours:function(d,c){return(c-d)/3600000},getDurationInDays:function(d,c){return(c-d)/86400000},getDurationInBusinessDays:function(g,f){var k=Math.round((f-g)/86400000),e=0,j;for(var h=0;h<k;h++){j=Sch.util.Date.add(g,Sch.util.Date.DAY,h).getDay();if(j!==6&&j!==0){e++}}return e},getDurationInMonths:function(d,c){return((c.getFullYear()-d.getFullYear())*12)+(c.getMonth()-d.getMonth())},getDurationInYears:function(d,c){return this.getDurationInMonths(d,c)/12},min:function(d,c){return d<c?d:c},max:function(d,c){return d>c?d:c},intersectSpans:function(f,e,h,g){return this.betweenLesser(f,h,g)||this.betweenLesser(h,f,e)},MILLI:Date.MILLI,SECOND:Date.SECOND,MINUTE:Date.MINUTE,HOUR:Date.HOUR,DAY:Date.DAY,WEEK:"w",MONTH:Date.MONTH,QUARTER:"q",YEAR:Date.YEAR};Ext.apply(Sch.util.Date,{compareUnits:(function(){var c=Sch.util.Date,b=[c.MILLI,c.SECOND,c.MINUTE,c.HOUR,c.DAY,c.WEEK,c.MONTH,c.QUARTER,c.YEAR],a,d;return function(f,e){a=b.indexOf(f);d=b.indexOf(e);return a>d?1:(a<d?-1:0)}})()});Ext.ns("Sch");Sch.AbstractSchedulerPanel=Ext.extend(Ext.grid.EditorGridPanel,{resizeHandles:"end",weekStartDay:1,snapToIncrement:false,readOnly:false,viewPreset:"weekAndDay",eventBorderWidth:2,enableColLock:false,trackMouseOver:false,columnLines:true,cmpCls:undefined,eventSelector:undefined,overClass:"sch-event-hover",resizeHandleHtml:'<div class="x-resizable-handle sch-resizable-handle-{0}"></div>',setReadOnly:function(b){this.readOnly=b;this.el[b?"addClass":"removeClass"](this.cmpCls+"-readonly")},setTimeColumnWidth:function(b){this.timeColumnWidth=b;this.getView().updateTimeColumnWidths()},getEventRecordFromDomId:function(b){throw"Abstract method call"},getEventIdFromDomNodeId:function(b){return b.substring(this.eventPrefix.length)},getXYFromDate:function(b){return this.view.getXYFromDate(b)},getDateFromDomEvent:function(c,b){return this.getDateFromXY(c.getXY(),b)},getDateFromX:function(b,c){return this.getDateFromXY([b,0],c)},getDateFromXY:function(e,d){var f=this.view.getDateFromXY(e);if(f&&d){f=this[d+"Date"](f)}return f},roundDate:function(b){return this.timeAxis.roundDate(b)},floorDate:function(b){return this.timeAxis.floorDate(b)},ceilDate:function(b){return this.timeAxis.ceilDate(Date)},getFormattedDate:function(b){return b.format(this.getDisplayDateFormat())},getFormattedEndDate:function(e,d){var g=this.timeAxis,f=g.getResolution().unit;if(f in this.largeUnits&&e.getHours()===0&&e.getMinutes()===0&&!(e.getYear()===d.getYear()&&e.getMonth()===d.getMonth()&&e.getDate()===d.getDate())){e=Sch.util.Date.add(e,Date.DAY,-1)}return e.format(this.getDisplayDateFormat())},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(d,c){this.timeAxis.setResolution(d,c);if(this.snapToIncrement){this.getView().refresh(true)}},onDestroy:function(){if(this.tip){this.tip.destroy()}Sch.AbstractSchedulerPanel.superclass.onDestroy.call(this)},afterRender:function(){Sch.AbstractSchedulerPanel.superclass.afterRender.apply(this,arguments);this.el.addClass(this.cmpCls);if(this.readOnly){this.el.addClass(this.cmpCls+"-readonly")}var b=this.getView();this.relayEvents(b,["timeheaderdblclick"]);if(this.overClass){this.mon(this.getView().mainBody,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this})}if(this.tooltipTpl){this.setupTooltip()}this.setupScheduleEvents()},setupScheduleEvents:function(){this.mon(this.getView().mainBody,{click:function(d){var c=d.getTarget("td.sch-timetd",2);if(c){var b=this.getDateFromDomEvent(d,"floor");this.fireEvent("scheduleclick",this,b,this.view.findRowIndex(c),d)}},dblclick:function(d){var c=d.getTarget("td.sch-timetd",2);if(c){var b=this.getDateFromDomEvent(d,"floor");this.fireEvent("scheduledblclick",this,b,this.view.findRowIndex(c),d)}},contextmenu:function(d){var c=d.getTarget("td.sch-timetd",2);if(c){var b=this.getDateFromDomEvent(d,"floor");this.fireEvent("schedulecontextmenu",this,b,this.view.findRowIndex(c),d)}},scope:this},this)},switchViewPreset:function(g,f,k,j){if(this.fireEvent("beforeviewchange",this)!==false){if(Ext.isString(g)){g=Sch.PresetManager.getPreset(g)}if(!g){throw"View preset not found"}Ext.apply(this,g);var h={unit:this.getSmallestHeaderUnit(),increment:this.getSmallestHeaderIncrement(),resolutionUnit:this.timeResolution.unit,resolutionIncrement:this.timeResolution.increment,weekStartDay:this.weekStartDay,mainUnit:this.getTimelineUnit(),defaultSpan:this.defaultSpan||1};if(j){if(!this.timeAxis){this.timeAxis=new Sch.TimeAxis()}h.start=f||new Date();h.end=k;this.timeAxis.on("reconfigure",this.onTimeAxisReconfigure,this)}else{h.start=f||this.timeAxis.getStart();h.end=k}this.timeAxis.reconfigure(h)}},onTimeAxisReconfigure:function(){this.fireEvent("viewchange",this)},getShiftIncrement:function(){return this.shiftIncrement||1},getStart:function(){return this.timeAxis.getStart()},getEnd:function(){return this.timeAxis.getEnd()},onMouseOver:function(c){var b=c.getTarget(this.eventSelector,this.view.cellSelectorDepth);if(b&&b!==this.lastItem){this.lastItem=b;Ext.fly(b).addClass(this.overClass)}},onMouseOut:function(a){if(this.lastItem){if(!a.within(this.lastItem,true,true)){Ext.fly(this.lastItem).removeClass(this.overClass);delete this.lastItem}}},setSnapEnabled:function(b){this.snapToIncrement=b;if(b){this.getView().refresh(true)}},initComponent:function(){if(!this.viewPreset){throw"You must define a valid view preset object. See sch.basicviewpresets.js for reference"}this.switchViewPreset(this.viewPreset,this.startDate,this.endDate,true);var a={},c=Sch.util.Date;a[c.DAY]=null;a[c.WEEK]=null;a[c.MONTH]=null;a[c.QUARTER]=null;a[c.YEAR]=null;Ext.applyIf(this,{eventPrefix:this.id+"-ev-",largeUnits:a});if(Ext.isArray(this.columns)&&!this.colModel){if(this.columns.length>0&&this.columns[0].locked){this.colModel=new Ext.ux.grid.LockingColumnModel(this.columns);delete this.columns}}if(!this.columns&&!this.colModel){this.columns=[]}Sch.AbstractSchedulerPanel.superclass.initComponent.call(this);Ext.each(this.getColumnModel().config,function(b){b.setEditor=Ext.emptyFn})},tipCfg:{cls:"sch-tip",showDelay:1000,autoHide:true,anchor:"b"},setupTooltip:function(){var b=this.getView(),a=Ext.apply({renderTo:Ext.getBody(),delegate:this.eventSelector,target:b.mainBody,listeners:{beforeshow:{fn:function(d){if(!d.triggerElement||!d.triggerElement.id){return false}var c=this.getTooltipRecord(d.triggerElement);if(!c||this.fireEvent("beforetooltipshow",this,c)===false){return false}d.update(this.tooltipTpl.apply(c.data));return true},scope:this}}},this.tipCfg);this.tip=new Ext.ToolTip(a)},getTooltipRecord:function(b){return this.getEventRecordFromDomId(b.id)},constructor:function(b){this.addEvents("beforetooltipshow","beforeviewchange","viewchange","timeheaderdblclick","scheduleclick","scheduledblclick","schedulecontextmenu");Sch.AbstractSchedulerPanel.superclass.constructor.call(this,b)},getShiftUnit:function(){return this.shiftUnit||this.getTimelineUnit()},getShiftIncrement:function(){return this.shiftIncrement||1},getTimeColumnWidth:function(){return this.timeColumnWidth||100},getDisplayDateFormat:function(){return this.displayDateFormat},getHeaderConfig:function(){return this.headerConfig},getTimelineUnit:function(){return this.headerConfig.middle.unit},getTimelineIncrement:function(){return this.headerConfig.middle.increment||1},getSmallestHeaderUnit:function(){return this.headerConfig.bottom?this.headerConfig.bottom.unit:this.headerConfig.middle.unit},getSmallestHeaderIncrement:function(){return(this.headerConfig.bottom?this.headerConfig.bottom.increment:this.headerConfig.middle.increment)||1},shiftNext:function(d){d=d||this.getShiftIncrement();var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},shiftPrevious:function(d){d=-(d||this.getShiftIncrement());var c=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),c,d),Sch.util.Date.add(this.getEnd(),c,d))},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(d,c){if(this.timeAxis){this.timeAxis.setTimeSpan(d,c)}},setStart:function(b){this.setTimeSpan(b)},setEnd:function(b){this.setTimeSpan(null,b)},getTimeAxis:function(){return this.timeAxis}});Ext.ns("Sch");Sch.PresetManager=Ext.apply(new Ext.util.MixedCollection(),{registerPreset:function(e,d){if(d){var g=d.headerConfig;for(var f in g){if(g.hasOwnProperty(f)){if(Sch.util.Date[g[f].unit]){g[f].unit=Sch.util.Date[g[f].unit.toUpperCase()]}}}if(d.timeResolution&&Sch.util.Date[d.timeResolution.unit]){d.timeResolution.unit=Sch.util.Date[d.timeResolution.unit.toUpperCase()]}if(d.shiftUnit&&Sch.util.Date[d.shiftUnit]){d.shiftUnit=Sch.util.Date[d.shiftUnit.toUpperCase()]}}if(this.isValidPreset(d)){this.add(e,d)}else{throw"Invalid preset, please check your configuration"}},isValidPreset:function(b){var e=Sch.util.Date,c=true,d=[e.MILLI,e.SECOND,e.MINUTE,e.HOUR,e.DAY,e.WEEK,e.MONTH,e.QUARTER,e.YEAR];for(var f in b.headerConfig){if(b.headerConfig.hasOwnProperty(f)){c=c&&d.indexOf(b.headerConfig[f].unit)>=0}}if(b.timeResolution){c=c&&d.indexOf(b.timeResolution.unit)>=0}if(b.shiftUnit){c=c&&d.indexOf(b.shiftUnit)>=0}return c&&!this.containsKey(name)},getPreset:function(b){return this.get(b)},deletePreset:function(b){this.removeKey(b)}});Ext.override(Ext.data.Record,{set:function(e,d){var f=Ext.isPrimitive(d)?String:Ext.encode;if(f(this.data[e])==f(d)){return}this.dirty=true;if(!this.previous){this.previous={}}this.previous[e]=this.data[e];if(!this.modified){this.modified={}}if(this.modified[e]===undefined){this.modified[e]=this.data[e]}this.data[e]=d;if(!this.editing){this.afterEdit()}},afterEdit:function(){if(this.store){this.store.afterEdit(this,this.previous)}delete this.previous},reject:function(c){var b=this.modified,d={};for(var e in b){if(typeof b[e]!="function"){d[e]=this.data[e];this.data[e]=b[e]}}delete this.modified;this.dirty=false;this.editing=false;if(c!==true){this.afterReject(d)}},afterReject:function(b){if(this.store){this.store.afterReject(this,b)}}});Ext.override(Ext.data.Store,{afterEdit:function(d,c){if(this.modified.indexOf(d)==-1){this.modified.push(d)}this.fireEvent("update",this,d,Ext.data.Record.EDIT,c)},afterReject:function(d,c){this.modified.remove(d);this.fireEvent("update",this,d,Ext.data.Record.REJECT,c)}});Ext.override(Ext.dd.DragZone,{destroy:Ext.dd.DragZone.prototype.destroy.createInterceptor(function(){if(this.containerScroll){Ext.dd.ScrollManager.unregister(this.el)}})});Ext.getMajorVersion=function(){return Math.abs(this.version.split(".")[0])};Ext.getMinorVersion=function(){return Math.abs(this.version.split(".")[1])};Ext.getRevision=function(){return Math.abs(this.version.split(".")[2])};Ext.ns("Sch");Sch.AbstractSchedulerView=Ext.extend(Ext.grid.GridView,{cellSelectorDepth:6,rowSelectorDepth:11,trackMouseInTimeHeader:false,translateToScheduleCoordinate:function(){throw"Abstract method call"},translateToPageCoordinate:function(b){return[b[0]+this.mainBody.getLeft(),b[1]+this.mainBody.getTop()]},rowPosRe:new RegExp("sch-header-row-([^\\s]+)"),initTemplates:function(){this.templates=this.templates||{};var b=this.templates;if(!b.header){b.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}" class="sch-header-row-{tclass}">',"<thead>",'<tr class="x-grid3-hd-row">{cells}</tr>',"</thead>","</table>")}if(!b.gcell){b.gcell=new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',"{value}</div></td>")}Sch.AbstractSchedulerView.superclass.initTemplates.call(this)},getColumnHeaderCls:function(e,d){var c=e===0?"x-grid3-cell-first ":(e==d?"x-grid3-cell-last ":"");return c+(this.cm.config[e].hCls||"")+(this.cm.config[e].headerCls||"")},getAccumulatedColumnWidth:function(f,d){var h=this.cm,e=0,g;for(g=f;g<d;g++){if(!h.isHidden(g)){e+=h.getColumnWidth(g)}}return e},getNumberOfTimeColumns:function(){return this.cm.getColumnCount()-this.rightColumns.length-this.leftColumns.length},getLastTimeColumnIndex:function(){return this.cm.getColumnCount()-this.rightColumns.length-1},getSingleUnitInPixels:function(b){return Sch.util.Date.getUnitToBaseUnitRatio(this.getColumnModelUnit(),b)*this.cm.getColumnWidth(this.leftColumns.length)},getScheduleSectionWidth:function(){return this.cm.getTotalWidth()-this.getLeftSectionWidth()-this.getRightSectionWidth()},getLeftSectionWidth:function(){return this.getAccumulatedColumnWidth(0,this.leftColumns.length)},getRightSectionWidth:function(){var b=this.cm.getColumnCount();return this.getAccumulatedColumnWidth(b-this.rightColumns.length,b)},resolveHeaderGroupCell:function(e){var d=e.className;if(d){var f;if(d.match(/ux-grid-hd-group-row-top/)){f="top"}else{f="middle"}return{position:f,index:d.match(this.colRe)[1]}}},onHeaderDoubleClick:function(k,h,m){var j=m.getTarget(".sch-timeheader");if(!j){return}var f=!!j.className.match("ux-grid-hd-group-cell"),l,d=k.getColumnModel();if(f){var n=this.resolveHeaderGroupCell(m.getTarget(".x-grid3-hd"));l=this.headerRows[n.position][n.index]}else{l=this.timeAxis.getAt(h-this.leftColumns.length)}this.fireEvent("timeheaderdblclick",this,l.start,l.end,m)},handleHdMove:Ext.grid.GridView.prototype.handleHdMove.createInterceptor(function(a){return !a.getTarget(".ux-grid-hd-group-cell")}),getTimeSpanRegion:function(e,d){var g=this.getXFromDate(e),f=this.getXFromDate(d||e);return new Ext.lib.Region(0,f,this.mainBody.getHeight(),g)},scrollEventIntoView:function(e,d){var f=this.getElementFromEventRecord(e);if(f){f.scrollIntoView(this.scroller);if(d){if(typeof d==="boolean"){f.highlight()}else{f.highlight(null,d)}}}},onHeaderClick:Ext.grid.GridView.prototype.onHeaderClick.createInterceptor(function(c,b,d){return !d.getTarget(".ux-grid-hd-group-cell")&&!d.getTarget(".ux-grid-hd-nogroup-cell")}),calculateTimeColumnWidth:function(j){var l=0,e=this.getColumnModelUnit(),m=this.timeAxis.getCount(),f=Number.MAX_VALUE;if(this.grid.snapToIncrement){var h=this.timeAxis.getResolution(),k=h.unit,d=h.increment;f=Sch.util.Date.getUnitToBaseUnitRatio(e,k)*d}var g=Sch.util.Date.getMeasuringUnit(e);f=Math.min(f,Sch.util.Date.getUnitToBaseUnitRatio(e,g));l=this.forceFit?Math.floor(this.getAvailableWidthForSchedule()/m):j;if(!this.forceFit||f<1){l=Math.floor(f*l)/f}return l},fitColumns:function(e){var c=this.cm,h=this.getNumberOfTimeColumns(),f=Math.floor(this.getAvailableWidthForSchedule()/h),d=this.calculateTimeColumnWidth(f);for(var g=0;g<h;g++){c.setColumnWidth(g+this.leftColumns.length,d,true)}if(e!==true){this.updateAllColumnWidths()}},getElementFromEventRecord:function(b){return Ext.get(this.grid.eventPrefix+b.id)},isTimeHeaderCell:function(a){return !!Ext.fly(a).up("td.sch-timeheader")},getLeftGroupWidth:function(d){var c=this.getAccumulatedColumnWidth(0,this.leftColumns.length);return(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2))?c:Math.max(c-this.borderWidth,0)},getRightGroupWidth:function(d){var c,e=this.cm.getColumnCount();if(this.rightColumns.length){c=this.getAccumulatedColumnWidth(e-this.rightColumns.length,e);return(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2))?c:Math.max(c-this.borderWidth,0)}else{return 0}},handleHdOver:function(g,f){var d=this.findHeaderCell(f);if(d&&!this.headersDisabled){this.activeHdRef=f;this.activeHdIndex=this.getCellIndex(d);var c=this.fly(d);this.activeHdRegion=c.getRegion();if(this.isTimeHeaderCell(f)){if(this.trackMouseInTimeHeader){c.addClass("x-grid3-hd-over");if(!this.cm.isMenuDisabled(this.activeHdIndex)){this.activeHdBtn=c.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(d.firstChild.offsetHeight-1)+"px"}}}}else{if(!this.cm.isMenuDisabled(this.activeHdIndex)){c.addClass("x-grid3-hd-over");this.activeHdBtn=c.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(d.firstChild.offsetHeight-1)+"px"}}}}},resolveColumnIndex:function(c){var d=this.cm,e=-1,b=this.getLeftSectionWidth(),f;if(c>=b){for(e=this.leftColumns.length,lastIndex=d.getColumnCount()-1;e<lastIndex;e++){if(!d.isHidden(e)){f=d.getColumnWidth(e);if(c>=b&&c<=(b+f)){break}b+=f}}}return e},onColumnWidthUpdated:function(){Sch.AbstractSchedulerView.superclass.onColumnWidthUpdated.apply(this,arguments);this.updateGroupStyles()},onAllColumnWidthsUpdated:function(){Sch.AbstractSchedulerView.superclass.onAllColumnWidthsUpdated.apply(this,arguments);this.updateGroupStyles()},onColumnHiddenUpdated:function(){Sch.AbstractSchedulerView.superclass.onColumnHiddenUpdated.apply(this,arguments);this.updateGroupStyles()},getHeaderCell:function(b){return this.mainHd.query(this.cellSelector)[b]},findHeaderCell:function(b){return b?this.fly(b).findParent("td.x-grid3-hd",this.cellSelectorDepth):false},findHeaderIndex:function(d){var c=this.findHeaderCell(d);return c?this.getCellIndex(c):false},getXYFromDate:function(b){return[this.getXFromDate(b),0]},getXFromDate:function(e){var d=-1,f=this.timeAxis.getTickFromDate(e);if(f>=0){var c=this.leftColumns.length+Math.floor(f),g=this.getAccumulatedColumnWidth(0,c);d=g+(c<this.cm.getColumnCount()?this.cm.getColumnWidth(c)*(f-Math.floor(f)):0)}return d},getDateFromXY:function(b){return this.getDateFromX(b[0])},getDateFromX:function(d){d=this.translateToScheduleCoordinate(d);var e=this.resolveColumnIndex(d),g=e-this.leftColumns.length,f=(this.getNumberOfTimeColumns()+this.leftColumns.length);if(g<0||e>f){return null}else{var c=d-this.getAccumulatedColumnWidth(0,e);if(e<f){g+=Math.min(1,c/this.cm.getColumnWidth(this.leftColumns.length))}else{if(c>2){return null}}return this.timeAxis.getDateFromTick(g)}},getHeaderRowCells:function(g){var f=this.getLeftGroupWidth(),j=this.getRightGroupWidth(),c=this.headerRows[g],k=[],l,h,d=this.templates,e=this.grid.getHeaderConfig();for(i=0,len=c.length;i<len;i++){h=c[i];if(i===0&&f){width=f;l=""}else{if(j&&i===len-1){width=j;l=""}else{width=this.getHeaderGroupCellWidth(h.start,h.end,e[g].unit,e[g].increment||1);l="sch-timeheader ";if(width<=0){l+=" x-hidden "}}}k[i]=d.gcell.apply({cls:l+(h.headerCls||"")+(h.header?" ux-grid-hd-group-cell":" ux-grid-hd-nogroup-cell"),id:i,row:g,style:"width:"+width+"px;"+(h.align?"text-align:"+h.align+";":""),istyle:h.align=="right"?"padding-right:16px":"",value:h.header||"&#160;"})}return k},getHeaderGroupCellWidth:function(o,n,m,k){var j=this.getColumnModelUnit(),l=this.getColumnModelIncrement(),g,h=Sch.util.Date.getMeasuringUnit(j),f=Sch.util.Date.getDurationInUnit(o,n,h);if(this.timeAxis.isContinuous()){g=f*this.getSingleUnitInPixels(h)/l}else{g=this.getXFromDate(n)-this.getXFromDate(o)}if(!(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2))){g-=2}return g},getColumnModelUnit:function(){var b=this.grid.getHeaderConfig();return b.bottom?b.bottom.unit:b.middle.unit},getColumnModelIncrement:function(){var b=this.grid.getHeaderConfig();return(b.bottom?b.bottom.increment:b.middle.increment)||1},updateColumnModel:function(m){if(!this.isValidHeaderConfig()){throw"Invalid header configuration, please check your header definition"}var j=this.grid,e=j.getTimeColumnWidth(),l=j.getHeaderConfig(),f=this.timeAxis,c=f.getStart(),d=f.getEnd(),h={renderer:this.timeColumnRenderer,scope:this,width:this.calculateTimeColumnWidth(e)},n=Sch.ColumnFactory.createColumns(this.timeAxis,l,h),k=n.headerRows;if(k){for(var b in k){if(k.hasOwnProperty(b)){if(this.leftColumns.length>0){k[b].unshift({colspan:this.leftColumns.length})}if(this.rightColumns.length>0){k[b].push({colspan:this.rightColumns.length})}}}}Ext.apply(this,{headerRows:k});Ext.each(this.rightColumns,function(a){delete a.id});this.cm.setConfig(this.leftColumns.concat(n.columns).concat(this.rightColumns),m)},getSnapPixelAmount:function(){if(this.grid.snapToIncrement){var b=this.timeAxis.getResolution();return(b.increment||1)*this.getSingleUnitInPixels(b.unit)}else{return 1}},isValidHeaderConfig:function(){var b=this.grid.getHeaderConfig(),d,c=true;if(b.bottom){d=Sch.util.Date.compareUnits(b.bottom.unit,b.middle.unit);if(d>0||(d===0&&(b.bottom.increment||1)>(b.middle.increment||1))){c=false}}if(b.top){d=Sch.util.Date.compareUnits(b.middle.unit,b.top.unit);if(d>0||(d===0&&(b.middle.increment||1)>(b.top.increment||1))){c=false}}return c},initializeColumns:function(){var c=this.cm,b=c.config,e=b.length,f=-1;for(var d=0;d<e;d++){if(b[d].position&&b[d].position==="right"){f=d;break}}if(f>=0){this.rightColumns=b.slice(f,e)}else{this.rightColumns=[]}this.leftColumns=b.slice(0,f>=0?f:e)},onSchedulerRender:function(){if(this.columnDrop){Ext.apply(this.columnDrop,{getTargetFromEvent:this.columnDropGetTargetFromEvent.createDelegate(this)})}if(this.columnDrag){this.columnDrag.onBeforeDrag=function(b,c){return !c.getTarget(".sch-timeheader")}}},columnDropGetTargetFromEvent:function(c){var a=Ext.lib.Event.getTarget(c),b=this.findCellIndex(a);if(b!==false&&b<this.leftColumns.length){return this.getHeaderCell(b)}return false},init:function(b){Ext.apply(this,{grid:b,rowHeight:b.rowHeight,eventBorderWidth:b.eventBorderWidth,cm:b.getColumnModel(),timeAxis:b.timeAxis});this.on("headerdblclick",this.onHeaderDoubleClick,this);this.timeAxis.on("reconfigure",function(){this.updateColumnModel()},this);this.initializeColumns(true);this.updateColumnModel();b.on({afterrender:this.onSchedulerRender,headerdblclick:this.onHeaderDoubleClick,scope:this});Sch.AbstractSchedulerView.superclass.init.apply(this,arguments)},timeColumnRenderer:function(){throw"Abstract method call"}});Ext.ns("Sch");Sch.HorizontalSchedulerView=Ext.extend(Sch.AbstractSchedulerView,{forceFit:true,setBarMargin:function(d,c){this.barMargin=d;if(!c){this.refresh()}},setRowHeight:function(b){this.rowHeight=b;if(this.grid.viewReady){this.refresh()}},managedEventLayout:true,barMargin:1,constructor:function(b){Sch.HorizontalSchedulerView.superclass.constructor.call(this,b);if(this.forceFit){this.refresh=this.refresh.createInterceptor(function(){this.fitColumns(true)})}},onEventAdd:function(g,e){var c;for(var f=0,d=e.length;f<d;f++){c=this.grid.getResourceByEventRecord(e[f]);if(c){this.refreshRow(c)}}},onEventRemove:function(d,a){var e=this.getElementFromEventRecord(a);if(e){e.fadeOut({remove:true,callback:function(){var b=this.grid.getResourceByEventRecord(a);if(b){this.refreshRow(b)}},scope:this})}},onEventUpdate:function(g,f,e,j){var h;if(j&&j.ResourceId){h=this.ds.getAt(this.ds.findExact("Id",j.ResourceId));this.refreshRow(h)}h=this.grid.getResourceByEventRecord(f);if(h){this.refreshRow(h)}},init:function(b){Ext.apply(this,{timeCellRenderer:b.timeCellRenderer,eventBodyTemplate:b.eventBodyTemplate,eventTemplate:b.eventTemplate,eventRenderer:b.eventRenderer,eventBarTextField:b.eventBarTextField});b.on({columnresize:this.refreshView,resize:this.refreshView,scope:this});Sch.HorizontalSchedulerView.superclass.init.apply(this,arguments)},refreshView:function(a){if(this.grid.viewReady){this.refresh(true)}},updateSortIcon:function(f,e){var h=this.sortClasses;var g=this.mainHd.select(this.cellSelector).removeClass(h);g.item(f).addClass(h[e=="DESC"?1:0])},getAvailableWidthForSchedule:function(){return this.grid.getGridEl().getWidth(true)-this.getScrollOffset()-this.getLeftSectionWidth()-this.getRightSectionWidth()},updateGroupStyles:function(){var o=this.headerRows;if(!o){return}var n=this.mainHd.query(".x-grid3-header-offset > table"),m=this.grid.getHeaderConfig(),q=this.getLeftGroupWidth(),r=this.getRightGroupWidth(),h=this.cm.getTotalWidth();for(var l=0;l<n.length;l++){n[l].style.width=h+"px";if(l<n.length-1){var k=n[l].firstChild.firstChild.childNodes;for(var g=0;g<k.length;g++){if(g===0&&q>0){k[g].style.width=q+"px"}else{if(g===k.length-1&&r>0){k[g].style.width=r+"px"}else{var j=m.top?(l===0?"top":"middle"):"middle",p=o[j][g],f=this.getHeaderGroupCellWidth(p.start,p.end,m[j].unit,m[j].increment||1);k[g].style.width=f+"px"}}}}}},renderHeaders:function(){var t=this.templates,h=[],u=this.cm,n=this.headerRows,g,f,w,l=this.getTotalWidth(),s=this.grid.getHeaderConfig(),k,m;if(n){if(n.top){var r=this.getHeaderRowCells("top");h.push(t.header.apply({tstyle:"width:"+l,tclass:"top",cells:r.join("")}))}if(n.middle){var q=this.getHeaderRowCells("middle");h.push(t.header.apply({tclass:"middle",tstyle:"width:"+l,cells:q.join("")}))}}m=u.getColumnCount();var o=t.hcell,j=[],e={},v=m-1;for(k=0;k<m;k++){e.id=u.getColumnId(k);e.value=u.getColumnHeader(k)||"";e.style=this.getColumnStyle(k,true);e.tooltip=this.getColumnTooltip(k);e.css=this.getColumnHeaderCls(k,v);if(u.config[k].align=="right"){e.istyle="padding-right:16px"}else{delete e.istyle}j[j.length]=o.apply(e)}h.push(t.header.apply({cells:j.join(""),tstyle:"width:"+l+";",tclass:n.middle?"bottom":"middle"}));return h.join("")},translateToScheduleCoordinate:function(a){return a-this.el.getX()},timeColumnRenderer:function(C,E,R,Q,P,O,N){var M="&#160;",u=this.grid,z=this.cm,A=this.timeAxis,x=A.getStart(),w=A.getEnd(),I=this.leftColumns.length,n=P-I,q=(P===I)?null:A.getAt(n-1).end,S=z.getColumnWidth(P),y=A.getAt(n),D=y.start,p=y.end;this.timeCellRenderer.call(u,N,E,R,Q,P,O,D,p);for(var J=0,F=N.getCount();J<F;J++){var L=N.items[J],t=L.data.StartDate,r=L.data.EndDate;if(t&&r){var K;if(P===I){K=Sch.util.Date.betweenLesser(t,D,p)||(t<D&&r>D)}else{K=Sch.util.Date.betweenLesser(t,q,p)&&((r>D)||r-t===0)}if(K){var H=p-D,B=((Sch.util.Date.max(t,D)-D)/H)*S,s=this.getXFromDate(Sch.util.Date.min(r,w))-this.getXFromDate(Sch.util.Date.max(t,x)),o={id:L.id,internalcls:(L.dirty?"sch-dirty":"")+(r>w?" sch-event-endsoutside ":"")+(t<x?" sch-event-startsoutside":""),left:B,width:Math.max(1,Ext.isBorderBox?s:s-this.eventBorderWidth)};if(this.managedEventLayout){o.top=this.barMargin;o.height=this.rowHeight-(2*this.barMargin)-(Ext.isBorderBox?0:this.eventBorderWidth)}if(this.eventRenderer){var G=this.eventRenderer.call(u,L,R,o,Q,P);if(Ext.isObject(G)&&this.eventBodyTemplate){o.body=this.eventBodyTemplate.apply(G)}else{o.body=G}}else{if(this.eventBarTextField){o.body=L.data[this.eventBarTextField]}else{if(this.eventBodyTemplate){o.body=this.eventBodyTemplate.apply(L.data)}}}M+=this.eventTemplate.apply(o)}}}E.css+=" sch-timetd";if(Ext.isIE){E.attr+=' style="z-index:'+(z.getColumnCount()-P)+'"'}return M},doRender:function(P,N,M,L,J,F){var K=this.grid,a=this.templates,s=a.cell,t=a.row,u=J-1;var D="width:"+this.getTotalWidth()+";height:"+this.grid.getRowHeight()+"px";var C=[],y,O,z={},v={tstyle:D},x,q,w=this.getScheduleSectionWidth();for(var G=0,I=N.length;G<I;G++){x=N[G];y=[];var B=(G+L),E=x.get("Id");q=this.es.data.filterBy(function(b){return b.data.ResourceId==E});for(var H=0;H<J;H++){O=P[H];z.id=O.id;z.css=H===0?"x-grid3-cell-first ":(H==u?"x-grid3-cell-last ":"");z.attr=z.cellAttr="";z.value=O.renderer.call(O.scope||O,x.data[O.name],z,x,B,H,M,q);z.style=O.style;y[y.length]=s.apply(z)}var A=[];if(F&&((B+1)%2===0)){A[0]="x-grid3-row-alt"}if(x.dirty){A[1]=" x-grid3-dirty-row"}v.cols=J;if(this.getRowClass){A[2]=this.getRowClass(x,B,v,M)}v.alt=A.join(" ");v.cells=y.join("");C[C.length]=t.apply(v)}return C.join("")},initData:function(d,c){Sch.HorizontalSchedulerView.superclass.initData.apply(this,arguments);if(!this.es){this.es=this.grid.eventStore;this.es.on({scope:this,datachanged:this.onDataChange,add:this.onEventAdd,update:this.onEventUpdate,remove:this.onEventRemove,clear:this.onClear})}if(this.cm){this.cm.un("hiddenchange",this.refreshView,this)}if(c){c.on("hiddenchange",this.refreshView,this)}},initTemplates:function(){this.templates=this.templates||{};Ext.applyIf(this.templates,{eventBodyTemplate:this.eventBodyTemplate,eventTemplate:this.eventTemplate});Sch.HorizontalSchedulerView.superclass.initTemplates.apply(this,arguments)},resolveResource:function(d){var b=null,c=this.findRowIndex(d);if(c>=0){b=this.ds.getAt(c)}return b},getScheduleRegion:function(l,k){var h=l?Ext.fly(this.getCell(this.ds.indexOf(l),this.leftColumns.length)).getRegion():this.mainBody.getRegion(),g=this.timeAxis.getStart(),o=this.timeAxis.getEnd(),e=this.grid.getDateConstraints(l,k)||{start:g,end:o},m=this.cm,f=this.translateToPageCoordinate([this.getXFromDate(Sch.util.Date.max(g,e.start)),0])[0],n=this.translateToPageCoordinate([this.getXFromDate(Sch.util.Date.min(o,e.end)),0])[0],j=h.top+this.barMargin,d=(l?(h.top+this.rowHeight):h.bottom)-this.barMargin;return new Ext.lib.Region(j,n,d,f)}});if(Ext.getMajorVersion()>=3&&Ext.getMinorVersion()>=3){Ext.override(Sch.HorizontalSchedulerView,{refreshRow:function(n){var l=this.ds,p=this.cm.getColumnCount(),f=this.getColumnData(),q=p-1,t=["x-grid3-row"],h={tstyle:String.format("width: {0};height:{1}px",this.getTotalWidth(),this.grid.getRowHeight())},a=[],o=this.templates.cell,m,u,e,s,j,g;if(Ext.isNumber(n)){m=n;n=l.getAt(m)}else{m=l.indexOf(n)}if(!n||m<0){return}var k=n.get("Id"),r=this.es.data.filterBy(function(b){return b.data.ResourceId==k});for(g=0;g<p;g++){e=f[g];if(g===0){j="x-grid3-cell-first"}else{j=(g==q)?"x-grid3-cell-last ":""}s={id:e.id,style:e.style,css:j,attr:"",cellAttr:""};s.value=e.renderer.call(e.scope,n.data[e.name],s,n,m,g,l,r);if(Ext.isEmpty(s.value)){s.value="&#160;"}if(this.markDirty&&n.dirty&&typeof n.modified[e.name]!="undefined"){s.css+=" x-grid3-dirty-cell"}a[g]=o.apply(s)}u=this.getRow(m);u.className="";if(this.grid.stripeRows&&((m+1)%2===0)){t.push("x-grid3-row-alt")}if(this.getRowClass){h.cols=p;t.push(this.getRowClass(n,m,h,l))}this.fly(u).addClass(t).setStyle(h.tstyle);h.cells=a.join("");u.innerHTML=this.templates.rowInner.apply(h);this.fireEvent("rowupdated",this,m,n)}})}Ext.ns("Sch");(function(){if(!Ext.ux||!Ext.ux.grid||!Ext.ux.grid.LockingGridView){return}var b=Ext.ux.grid.LockingGridView.prototype;var a={lockText:b.lockText,unlockText:b.unlockText,rowBorderWidth:b.rowBorderWidth,lockedBorderWidth:b.lockedBorderWidth,getEditorParent:b.getEditorParent,initElements:b.initElements,getLockedRows:b.getLockedRows,getLockedRow:b.getLockedRow,getCell:b.getCell,addRowClass:b.addRowClass,removeRowClass:b.removeRowClass,removeRow:b.removeRow,removeRows:b.removeRows,syncScroll:b.syncScroll,updateAllColumnWidths:b.updateAllColumnWidths,updateColumnWidth:b.updateColumnWidth,updateColumnHidden:b.updateColumnHidden,processRows:b.processRows,afterRenderUI:b.afterRenderUI,renderUI:b.renderUI,getOffsetWidth:b.getOffsetWidth,getResolvedXY:b.getResolvedXY,syncFocusEl:b.syncFocusEl,ensureVisible:b.ensureVisible,insertRows:b.insertRows,getColumnStyle:b.getColumnStyle,getLockedWidth:b.getLockedWidth,getTotalWidth:b.getTotalWidth,renderBody:b.renderBody,refreshRow:b.refreshRow,refresh:b.refresh,onDenyColumnLock:b.onDenyColumnLock,onColumnLock:b.onColumnLock,handleHdMenuClick:b.handleHdMenuClick,handleHdDown:b.handleHdDown,syncHeaderHeight:b.syncHeaderHeight,updateLockedWidth:b.updateLockedWidth,syncRowHeights:b.syncRowHeights,layout:b.layout,masterTpl:new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),forceFit:false,autoExpandTimeColumns:true,getAvailableWidthForSchedule:function(){return this.scroller.getWidth(true)-this.getScrollOffset()-this.getRightSectionWidth()},afterRender:function(){if(!this.forceFit&&this.autoExpandTimeColumns&&this.getScheduleSectionWidth()<this.getAvailableWidthForSchedule()){this.fitColumns()}b.afterRender.apply(this,arguments)},updateTimeColumnWidths:function(e){if(this.forceFit){return}var c=this.cm,g=this.grid.getTimeColumnWidth();for(var f=this.leftColumns.length,d=this.getLastTimeColumnIndex();f<=d;f++){c.setColumnWidth(f,g,true)}if(!e){this.refresh(true)}},getHeaderCell:function(d){var c=this.cm.getLockedCount();if(d<c){return this.lockedHd.child("table:last").dom.getElementsByTagName("td")[d]}return Sch.AbstractSchedulerView.prototype.getHeaderCell.call(this,d-c)},scrollToTime:function(e,d){var c=this.getXFromDate(e);if(c>=0){this.scroller.scrollTo("left",c,d)}},updateSortIcon:function(f,d){var k=this.sortClasses,g=this.lockedHd.select("table:last-child td").removeClass(k),j=this.mainHd.select("table:last-child td").removeClass(k),h=this.cm.getLockedCount(),e=k[d=="DESC"?1:0];if(f<h){g.item(f).addClass(e)}else{j.item(f-h).addClass(e)}},getXFromDate:function(e){var d=-1,f=this.timeAxis.getTickFromDate(e);if(f>=0){var c=Math.floor(f),g=this.getAccumulatedColumnWidth(this.leftColumns.length,this.leftColumns.length+c);d=g+(c<this.timeAxis.getCount()?this.cm.getColumnWidth(this.leftColumns.length+c)*(f-c):0)}return d},renderHeaders:function(){var A=this.cm,f=this.templates,h=f.hcell,q=[],l=[],r={},u=A.getColumnCount(),m=u-1,g=this.cm.getTotalWidth()-this.cm.getTotalLockedWidth(),o=this.getScheduleSectionWidth(),B=g+"px",j=this.getLockedWidth(),k="",v="",t;for(t=0;t<u;t++){r.id=A.getColumnId(t);r.value=A.getColumnHeader(t)||"";r.style=this.getColumnStyle(t,true);r.tooltip=this.getColumnTooltip(t);r.css=this.getColumnHeaderCls(t,m);if(A.config[t].align=="right"){r.istyle="padding-right:16px"}else{delete r.istyle}if(A.isLocked(t)){l[l.length]=h.apply(r)}else{q[q.length]=h.apply(r)}}var z=this.headerRows;if(z){var y=this.cm.getLockedCount();if(z.top){var x=this.getHeaderRowCells("top"),n=f.gcell.apply({cls:"x-grid3-cell-first x-grid3-cell-last ux-grid-hd-nogroup-cell",value:"&#160;",row:"top",id:0,style:"width:"+j}),s=f.header.apply({cells:n,tclass:"top",tstyle:"width:"+j+";"});if(y>0){k+=s}else{x.splice(1,0,n)}v+=f.header.apply({tstyle:"width:"+B,tclass:"top",cells:x.slice(1).join("")})}if(z.middle){var w=this.getHeaderRowCells("middle"),n=f.gcell.apply({cls:"x-grid3-cell-first x-grid3-cell-last ux-grid-hd-nogroup-cell",value:"&#160;",row:"middle",id:0,style:"width:"+j}),s=f.header.apply({cells:n,tclass:"middle",tstyle:"width:"+j+";"});if(y>0){k+=s}else{w.splice(1,0,n)}v+=f.header.apply({tstyle:"width:"+B,tclass:"middle",cells:w.slice(1).join("")})}}v+=f.header.apply({cells:q.join(""),tstyle:"width:"+B+";",tclass:z.middle?"bottom":"middle"});k+=f.header.apply({cells:l.join(""),tstyle:"width:"+this.getLockedWidth()+";",tclass:z.middle?"bottom":"middle"});return[v,k]},updateHeaders:function(){var d=this.renderHeaders();this.innerHd.firstChild.innerHTML=d[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();Ext.fly(this.innerHd.firstChild).select(">table").setWidth(this.getTotalWidth());this.lockedInnerHd.firstChild.innerHTML=d[1];var c=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=c;Ext.fly(this.lockedInnerHd.firstChild).select("table").setWidth(c)},initTemplates:function(){var c=this.templates||{};if(!c.master){c.master=this.masterTpl}if(!c.masterTpl){c.masterTpl=this.masterTpl}this.templates=c;Sch.AbstractSchedulerView.prototype.initTemplates.call(this)},updateGroupStyles:function(){var p=this.lockedHd.query(".x-grid3-header-offset > table"),q=this.mainHd.query(".x-grid3-header-offset > table"),j=this.headerRows||[],n=this.grid.getHeaderConfig(),l=this.rightColumns.length>0,g=(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px",h=this.getLockedWidth();for(var o=0;o<p.length;o++){p[o].style.width=h;q[o].style.width=g;if(o<p.length-1){var m=q[o].className.match(this.rowPosRe)[1],r=q[o].firstChild.firstChild.childNodes,e;r[0].style.width=h;for(var f=0;f<r.length;f++){var k=j[m][f+1];if(l&&f===r.length-1){r[f].style.width=this.getRightGroupWidth()+"px"}else{e=this.getHeaderGroupCellWidth(k.start,k.end,n[m].unit,n[m].increment||1);r[f].style.width=e+"px"}}}}},translateToScheduleCoordinate:function(c){return c-this.el.getX()-(Ext.isBorderBox?-1:this.lockedBorderWidth)+this.scroller.getScroll().left}};Sch.AbstractLockingSchedulerView=Ext.extend(Sch.AbstractSchedulerView,Ext.apply({init:function(c){if(!this.forceFit&&this.autoExpandTimeColumns){this.refresh=this.refresh.createInterceptor(function(d){if(this.getScheduleSectionWidth()<this.getAvailableWidthForSchedule()){this.fitColumns(true);if(!d){this.updateHeaders()}}})}Sch.AbstractLockingSchedulerView.superclass.init.apply(this,arguments)}},a));Sch.LockingSchedulerView=Ext.extend(Sch.HorizontalSchedulerView,Ext.apply({init:function(c){if(!this.forceFit&&this.autoExpandTimeColumns){this.refresh=this.refresh.createInterceptor(function(d){if(this.getScheduleSectionWidth()<this.getAvailableWidthForSchedule()){this.fitColumns(true);if(!d){this.updateHeaders()}}})}Sch.LockingSchedulerView.superclass.init.apply(this,arguments)},doRender:function(P,M,L,K,J,I){var E=this.templates,s=E.cell,t=E.row,w=J-1,o="width:"+this.getTotalWidth()+";height:"+this.rowHeight+"px;",n="width:"+this.getLockedWidth()+";height:"+this.rowHeight+"px;",N=[],Q=[],A,u,O,z={},v={},y,q,x=this.getScheduleSectionWidth();for(var F=0,H=M.length;F<H;F++){y=M[F];A=[];u=[];var C=(F+K),D=y.get("Id");q=this.es.data.filterBy(function(c){return c.data.ResourceId==D});for(var G=0;G<J;G++){O=P[G];z.id=O.id;z.css=(G===0?"x-grid3-cell-first ":(G==w?"x-grid3-cell-last ":""))+(this.cm.config[G].cellCls?" "+this.cm.config[G].cellCls:"");z.attr=z.cellAttr="";z.value=O.renderer.call(O.scope||O,y.data[O.name],z,y,C,G,L,q);z.style=O.style;if(Ext.isEmpty(z.value)){z.value="&#160;"}if(this.markDirty&&y.dirty&&Ext.isDefined(y.modified[O.name])){z.css+=" x-grid3-dirty-cell"}if(O.locked){u[u.length]=s.apply(z)}else{A[A.length]=s.apply(z)}}var B=[];if(I&&((C+1)%2===0)){B[0]="x-grid3-row-alt"}if(y.dirty){B[1]=" x-grid3-dirty-row"}v.cols=J;if(this.getRowClass){B[2]=this.getRowClass(y,C,v,L)}v.alt=B.join(" ");v.cells=A.join("");v.tstyle=o;N[N.length]=t.apply(v);v.cells=u.join("");v.tstyle=n;Q[Q.length]=t.apply(v)}return[N.join(""),Q.join("")]}},a));if(Ext.getMajorVersion()>=3&&Ext.getMinorVersion()>=3){Ext.override(Sch.LockingSchedulerView,{refreshRow:function(y){var x=this.ds,u=this.cm.getColumnCount(),g=this.getColumnData(),o=u-1,f=["x-grid3-row"],n={tstyle:String.format("width: {0};height:{1}px;",this.getTotalWidth(),this.rowHeight)},m={tstyle:String.format("width: {0};height:{1}px;",this.getLockedWidth(),this.rowHeight)},k=[],j=[],r=this.templates.cell,q,l,p,h,t,s,v;if(Ext.isNumber(y)){q=y;y=x.getAt(q)}else{q=x.indexOf(y)}if(!y||q<0){return}var w=y.get("Id"),e=this.es.data.filterBy(function(c){return c.data.ResourceId==w});for(v=0;v<u;v++){h=g[v];if(v===0){s="x-grid3-cell-first"}else{s=(v==o)?"x-grid3-cell-last ":""}t={id:h.id,style:h.style,css:s,attr:"",cellAttr:""};t.value=h.renderer.call(h.scope,y.data[h.name],t,y,q,v,x,e);if(Ext.isEmpty(t.value)){t.value=" "}if(this.markDirty&&y.dirty&&typeof y.modified[h.name]!="undefined"){t.css+=" x-grid3-dirty-cell"}if(h.locked){j[v]=r.apply(t)}else{k[v]=r.apply(t)}}l=this.getRow(q);l.className="";p=this.getLockedRow(q);p.className="";if(this.grid.stripeRows&&((q+1)%2===0)){f.push("x-grid3-row-alt")}if(this.getRowClass){n.cols=u;f.push(this.getRowClass(y,q,n,x))}this.fly(l).addClass(f).setStyle(n.tstyle);n.cells=k.join("");l.innerHTML=this.templates.rowInner.apply(n);this.fly(p).addClass(f).setStyle(m.tstyle);m.cells=j.join("");p.innerHTML=this.templates.rowInner.apply(m);p.rowIndex=q;this.syncRowHeights(l,p);this.fireEvent("rowupdated",this,q,y)}})}Ext.override(Sch.LockingSchedulerView,{getColumnData:function(){var e=[],d=this.cm,g=d.getColumnCount();for(var f=0;f<g;f++){var c=d.getDataIndex(f);e[f]={scope:d.config[f].scope,name:c||"",renderer:d.getRenderer(f),id:d.getColumnId(f),style:this.getColumnStyle(f),locked:d.isLocked(f)}}return e}})})();Ext.ns("Sch");Sch.SchedulerGroupingView=Ext.extend(Sch.HorizontalSchedulerView,{showSummaryInHeader:false,groupByText:Ext.grid.GroupingView.prototype.groupByText,showGroupsText:Ext.grid.GroupingView.prototype.showGroupsText,hideGroupedColumn:Ext.grid.GroupingView.prototype.hideGroupedColumn,showGroupName:Ext.grid.GroupingView.prototype.showGroupName,startCollapsed:Ext.grid.GroupingView.prototype.startCollapsed,enableGrouping:Ext.grid.GroupingView.prototype.enableGrouping,enableGroupingMenu:Ext.grid.GroupingView.prototype.enableGroupingMenu,enableNoGroups:Ext.grid.GroupingView.prototype.enableNoGroups,emptyGroupText:Ext.grid.GroupingView.prototype.emptyGroupText,ignoreAdd:Ext.grid.GroupingView.prototype.ignoreAdd,groupTextTpl:Ext.grid.GroupingView.prototype.groupTextTpl,gidSeed:Ext.grid.GroupingView.prototype.gidSeed,constructor:function(b){this.addEvents("togglegroup");Sch.SchedulerGroupingView.superclass.constructor.call(this,b)},init:function(e,d){Sch.SchedulerGroupingView.superclass.init.apply(this,arguments);if(this.hideGroupedColumn){var g=this.getGroupField(),f=this.cm.findColumnIndex(g);this.lastGroupField=g;this.cm.suspendEvents();this.cm.setHidden(f,true);this.cm.resumeEvents()}if(this.showSummaryInHeader){this.grid.on("afterrender",function(){this.el.addClass("sch-groupingsummary")},this)}},initTemplates:function(){Sch.SchedulerGroupingView.superclass.initTemplates.call(this);this.state={};var b=this.grid.getSelectionModel();b.on(b.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupHeaderRenderer?"{renderedHeader}":this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')}this.startGroup.compile();this.endGroup="</div></div>"},toggleRowIndex:Ext.grid.GroupingView.prototype.toggleRowIndex,findGroup:Ext.grid.GroupingView.prototype.findGroup,getGroups:Ext.grid.GroupingView.prototype.getGroups,onAdd:Ext.grid.GroupingView.prototype.onAdd,onRemove:Ext.grid.GroupingView.prototype.onRemove,refreshRow:Ext.grid.GroupingView.prototype.refreshRow,beforeMenuShow:Ext.grid.GroupingView.prototype.beforeMenuShow,renderUI:Ext.grid.GroupingView.prototype.renderUI,onGroupByClick:Ext.grid.GroupingView.prototype.onGroupByClick,onShowGroupsClick:Ext.grid.GroupingView.prototype.onShowGroupsClick,toggleGroup:Ext.grid.GroupingView.prototype.toggleGroup.createSequence(function(){this.fireEvent("togglegroup",this)}),toggleAllGroups:Ext.grid.GroupingView.prototype.toggleAllGroups,expandAllGroups:Ext.grid.GroupingView.prototype.expandAllGroups,collapseAllGroups:Ext.grid.GroupingView.prototype.collapseAllGroups,interceptMouse:Ext.grid.GroupingView.prototype.interceptMouse,getGroup:Ext.grid.GroupingView.prototype.getGroup,getGroupField:Ext.grid.GroupingView.prototype.getGroupField,afterRender:Ext.grid.GroupingView.prototype.afterRender,renderRows:Ext.grid.GroupingView.prototype.renderRows,processEvent:Ext.grid.GroupingView.prototype.processEvent,doRender:function(S,R,Q,P,O,N){if(R.length<1){return""}var L=this.getGroupField(),B=this.cm.findColumnIndex(L),M;this.enableGrouping=this.enableGrouping&&!!L;if(!this.enableGrouping||this.isUpdating){return Sch.SchedulerGroupingView.superclass.doRender.apply(this,arguments)}var I="width:"+this.getTotalWidth()+";";var H=this.grid.getGridEl().id;var G=this.cm.config[B];var F=G.groupRenderer||G.renderer;var E=this.showGroupName?(G.groupName||G.header)+": ":"";var D=[],v,J,K,A;for(J=0,K=R.length;J<K;J++){var C=P+J,y=R[J],u=y.data[L];M=this.getGroup(u,y,F,C,B,Q);if(!v||v.group!=M){A=H+"-gp-"+L+"-"+Ext.util.Format.htmlEncode(M);var z=typeof this.state[A]!=="undefined"?!this.state[A]:this.startCollapsed;var x=z?"x-grid-group-collapsed":"";v={group:M,gvalue:u,text:E+M,groupId:A,startRow:C,rs:[y],cls:x,style:I};D.push(v)}else{v.rs.push(y)}y._groupId=A}var w=[];for(J=0,K=D.length;J<K;J++){M=D[J];this.doGroupStart(w,M,S,Q,O);w[w.length]=Sch.SchedulerGroupingView.superclass.doRender.call(this,S,M.rs,Q,M.startRow,O,N);this.doGroupEnd(w,M,S,Q,O)}return w.join("")},getGroupId:Ext.grid.GroupingView.prototype.getGroupId,doGroupStart:function(f,h,e,k,j){if(this.groupHeaderRenderer){h.renderedHeader=this.groupHeaderRenderer(k,h)}f[f.length]=this.startGroup.apply(h)},doGroupEnd:Ext.grid.GroupingView.prototype.doGroupEnd,getRows:Ext.grid.GroupingView.prototype.getRows,updateGroupWidths:Ext.grid.GroupingView.prototype.updateGroupWidths,onColumnWidthUpdated:function(e,d,c){Sch.SchedulerGroupingView.superclass.onColumnWidthUpdated.call(this,e,d,c);this.updateGroupWidths()},onAllColumnWidthsUpdated:function(d,c){Sch.SchedulerGroupingView.superclass.onAllColumnWidthsUpdated.call(this,d,c);this.updateGroupWidths()},onColumnHiddenUpdated:function(e,d,f){Sch.SchedulerGroupingView.superclass.onColumnHiddenUpdated.call(this,e,d,f);this.updateGroupWidths()},onLayout:Ext.grid.GroupingView.prototype.onLayout,onBeforeRowSelect:Ext.grid.GroupingView.prototype.onBeforeRowSelect,constructId:Ext.grid.GroupingView.prototype.constructId,canGroup:Ext.grid.GroupingView.prototype.canGroup,getPrefix:Ext.grid.GroupingView.prototype.getPrefix});if(Ext.getMajorVersion()>=3&&Ext.getMinorVersion()>=3){Ext.override(Sch.SchedulerGroupingView,{afterRenderUI:Ext.grid.GroupingView.prototype.afterRenderUI,groupMode:Ext.grid.GroupingView.prototype.groupMode,refreshRow:function(b){if(this.ds.getCount()==1){this.refresh()}else{this.isUpdating=true;Sch.SchedulerGroupingView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false}}})}Ext.ns("Sch");(function(){if(!Sch.LockingSchedulerView){return}var a=Ext.grid.GroupingView.prototype;Sch.LockingGroupingSchedulerView=Ext.extend(Sch.LockingSchedulerView,{showSummaryInHeader:false,unlockedGroupHeaderRenderer:undefined,groupByText:a.groupByText,showGroupsText:a.showGroupsText,hideGroupedColumn:a.hideGroupedColumn,showGroupName:a.showGroupName,startCollapsed:a.startCollapsed,enableGrouping:a.enableGrouping,enableGroupingMenu:a.enableGroupingMenu,enableNoGroups:a.enableNoGroups,emptyGroupText:a.emptyGroupText,ignoreAdd:a.ignoreAdd,groupTextTpl:a.groupTextTpl,groupMode:Ext.grid.GroupingView.prototype.groupMode,gidSeed:a.gidSeed,constructor:function(b){this.addEvents("togglegroup");Sch.LockingGroupingSchedulerView.superclass.constructor.call(this,b)},init:function(d,c){Sch.LockingGroupingSchedulerView.superclass.init.apply(this,arguments);if(this.showSummaryInHeader){this.grid.on("afterrender",function(){this.el.addClass("sch-groupingsummary")},this)}},initTemplates:function(){this.state={};if(!this.startLockedGroup){this.startLockedGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group sch-grid-group-locked {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{lockedheaderstyle}"><div class="x-grid-group-title">'+(this.lockedGroupHeaderRenderer?"{renderedHeader}":this.groupTextTpl),"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')}if(!this.startUnlockedGroup){this.startUnlockedGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group x-grid-group-unlocked {cls}"><div id="{groupId}-hd" class="x-grid-group-hd {unlockedheadercls}"><div class="x-grid-group-title">'+(this.unlockedGroupHeaderRenderer?"{renderedHeader}":this.groupTextTpl)+'</div></div><div id="{groupId}-bd" class="x-grid-group-body">')}this.startLockedGroup.compile();this.startUnlockedGroup.compile();this.endGroup="</div></div>";Sch.LockingGroupingSchedulerView.superclass.initTemplates.call(this)},getLockedRows:function(){if(!this.enableGrouping){return Sch.LockingGroupingSchedulerView.superclass.getLockedRows.call(this)}var k=[];var h,d=this.getLockedGroups();for(var f=0,b=d.length;f<b;f++){h=d[f].childNodes[1].childNodes;for(var e=0,c=h.length;e<c;e++){k[k.length]=h[e]}}return k},doRender2:Sch.LockingSchedulerView.prototype.doRender,findGroup:a.findGroup,getGroups:a.getGroups,getLockedGroups:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},onAdd:a.onAdd,onRemove:function(f,e,k,j){Sch.LockingGroupingSchedulerView.superclass.onRemove.apply(this,arguments);var h=document.getElementById(e._groupId);if(h&&h.childNodes[1].childNodes.length<1){this.el.select('[id="'+e._groupId+'"]').remove()}this.applyEmptyText()},refreshRow:function(b){if(this.ds.getCount()==1){this.refresh()}else{this.isUpdating=true;Sch.LockingGroupingSchedulerView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false}},beforeMenuShow:a.beforeMenuShow,renderUI:function(){var b=Sch.LockingGroupingSchedulerView.superclass.renderUI.apply(this,arguments);if(this.interceptMouse){this.mainBody.on("mousedown",this.interceptMouse,this);this.lockedBody.on("mousedown",this.interceptMouse,this)}return b},onGroupByClick:a.onGroupByClick,onShowGroupsClick:a.onShowGroupsClick,toggleGroup:function(e,d){this.grid.stopEditing(true);e=Ext.getDom(e);var f=Ext.fly(e);d=d!==undefined?d:f.hasClass("x-grid-group-collapsed");this.state[f.dom.id]=d;this.el.select('[id="'+f.dom.id+'"]')[d?"removeClass":"addClass"]("x-grid-group-collapsed");this.fireEvent("togglegroup",this,f.dom.id,d)},toggleAllGroups:a.toggleAllGroups,expandAllGroups:a.expandAllGroups,collapseAllGroups:a.collapseAllGroups,interceptMouse:a.interceptMouse,getGroup:a.getGroup,getGroupField:a.getGroupField,afterRender:function(){if(!this.ds||!this.cm){return}Sch.LockingGroupingSchedulerView.superclass.afterRender.call(this);if(this.grid.deferRowRender){this.updateGroupWidths()}},renderRows:function(){var f=this.getGroupField();var e=!!f;if(this.hideGroupedColumn){var h=this.cm.findColumnIndex(f);if(!e&&this.lastGroupField!==undefined){this.mainBody.update("");this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField}else{if(e&&this.lastGroupField===undefined){this.lastGroupField=f;this.cm.setHidden(h,true)}else{if(e&&this.lastGroupField!==undefined&&f!==this.lastGroupField){this.mainBody.update("");var g=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(g,false);this.lastGroupField=f;this.cm.setHidden(h,true)}}}}return Sch.LockingGroupingSchedulerView.superclass.renderRows.apply(this,arguments)},processEvent:a.processEvent,doRender:function(S,R,Q,P,O,N){if(R.length<1){return""}var L=this.getGroupField(),B=this.cm.findColumnIndex(L),M;this.enableGrouping=this.enableGrouping&&!!L;if(!this.enableGrouping||this.isUpdating){return this.doRender2.apply(this,arguments)}var I="width:"+this.getLockedWidth()+";";var H=this.grid.getGridEl().id;var G=this.cm.config[B];var F=G.groupRenderer||G.renderer;var E=this.showGroupName?(G.groupName||G.header)+": ":"";var D=[],v,J,K,A;for(J=0,K=R.length;J<K;J++){var C=P+J,y=R[J],u=y.data[L];M=this.getGroup(u,y,F,C,B,Q);if(!v||v.group!=M){A=H+"-gp-"+L+"-"+Ext.util.Format.htmlEncode(M);var z=typeof this.state[A]!=="undefined"?!this.state[A]:this.startCollapsed;var x=z?"x-grid-group-collapsed":"";v={group:M,gvalue:u,text:E+M,groupId:A,startRow:C,rs:[y],cls:x,lockedheaderstyle:I};D.push(v)}else{v.rs.push(y)}y._groupId=A}var w=[],T=["",""];for(J=0,K=D.length;J<K;J++){M=D[J];this.doGroupStart(w,M,S,Q,O);w[w.length]=this.doRender2.call(this,S,M.rs,Q,M.startRow,O,N);this.doGroupEnd(w,M,S,Q,O)}for(J=0,K=w.length;J<K;J++){T[0]+=w[J][0];T[1]+=w[J][1]}return T},getGroupId:a.getGroupId,doGroupStart:function(f,h,e,k,j){f[f.length]=[this.renderUnlockedHeader(h),this.renderLockedHeader(h)]},doGroupEnd:function(f,h,e,k,j){f[f.length]=[this.endGroup,this.endGroup]},getRows:function(){if(!this.enableGrouping){return Sch.LockingGroupingSchedulerView.superclass.getRows.call(this)}var k=[];var h,d=this.getGroups();for(var f=0,b=d.length;f<b;f++){h=d[f].childNodes[1].childNodes;for(var e=0,c=h.length;e<c;e++){k[k.length]=h[e]}}return k},updateGroupWidths:function(){if(!this.enableGrouping||!this.hasRows()){return}var e,b,f=this.getLockedGroups(),c=this.getGroups(),d=this.getLockedWidth(),g=this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px";for(e=0,b=c.length;e<b;e++){c[e].firstChild.style.width=g}for(e=0,b=f.length;e<b;e++){f[e].firstChild.style.width=d}},onColumnWidthUpdated:function(e,d,c){Sch.LockingGroupingSchedulerView.superclass.onColumnWidthUpdated.call(this,e,d,c);this.updateGroupWidths()},onAllColumnWidthsUpdated:function(d,c){Sch.LockingGroupingSchedulerView.superclass.onAllColumnWidthsUpdated.call(this,d,c);this.updateGroupWidths()},onColumnHiddenUpdated:function(e,d,f){Sch.LockingGroupingSchedulerView.superclass.onColumnHiddenUpdated.call(this,e,d,f);this.updateGroupWidths()},onLayout:a.onLayout,onBeforeRowSelect:a.onBeforeRowSelect,constructId:a.constructId,canGroup:a.canGroup,getPrefix:a.getPrefix,getGroupEl:function(b){return b.up(".x-grid-group")},getGroupHeaderEl:function(b){return this.getGroupEl(b).down(".x-grid-group-hd")},getGroupEls:function(b){return this.el.select('[id="'+this.getGroupEl(b).id+'"]')},getGroupElsById:function(b){return this.el.select('[id="'+this.getPrefix(this.getGroupField())+b+'"]')},renderUnlockedHeader:function(b){if(this.unlockedGroupHeaderRenderer){b.renderedHeader=this.unlockedGroupHeaderRenderer.call(this,b)}return this.startUnlockedGroup.apply(b)},renderLockedHeader:function(b){if(this.lockedGroupHeaderRenderer){b.renderedHeader=this.lockedGroupHeaderRenderer.call(this,b)}return this.startLockedGroup.apply(b)}})})();Ext.ns("Sch");Sch.ColumnFactory={defaultRenderer:function(e,d,f){return e.format(f)},createColumns:function(n,m,k){if(!n||!m){throw"Invalid parameters passed to createColumns"}var j=[],q=m.bottom||m.middle,o=n.getTicks(),p;for(var g=0,f=o.length;g<f;g++){p={align:q.align||"center",headerCls:""};if(q.renderer){p.header=q.renderer.call(q.scope||this,o[g].start,o[g].end,p,g)}else{p.header=this.defaultRenderer(o[g].start,o[g].end,q.dateFormat)}j[j.length]=new Sch.TimeColumn(Ext.apply(p,k))}var h=this.createHeaderRows(n,m);return{columns:j,headerRows:h}},createHeaderRows:function(g,f){var k={};if(f.top){var j;if(f.top.cellGenerator){j=f.top.cellGenerator.call(this,g.getStart(),g.getEnd())}else{j=this.createHeaderRow(g,f.top)}k.top=j}if(f.bottom){var h;if(f.middle.cellGenerator){h=f.middle.cellGenerator.call(this,g.getStart(),g.getEnd())}else{h=this.createHeaderRow(g,f.middle)}k.middle=h}return k},createHeaderRow:function(o,n){var l=[],p,d=o.getStart(),f=o.getEnd(),q=f-d,m=[],e=d,g=0,h,j=n.align||"center",k;while(e<f){k=Sch.util.Date.min(o.getNext(e,n.unit,n.increment||1),f);p={align:j,start:e,end:k,headerCls:""};if(n.renderer){p.header=n.renderer.call(n.scope||this,e,k,p,g)}else{p.header=this.defaultRenderer(e,k,n.dateFormat,p,g)}l.push(p);e=k;g++}return l}};Ext.ns("Sch");Sch.EventSelectionModel=function(b){Ext.apply(this,b);this.selected=new Ext.CompositeElementLite();this.addEvents("beforeeventselect","selectionchange");Sch.EventSelectionModel.superclass.constructor.call(this)};Ext.extend(Sch.EventSelectionModel,Ext.grid.AbstractSelectionModel,{multiSelect:false,selectedClass:"sch-event-selected",clearSelectionsOnBlur:true,initEvents:function(){this.grid.on("eventclick",this.onEventClick,this);this.grid.getView().on({scope:this,refresh:this.onViewRefresh,rowupdated:this.onRowUpdated,beforerowremoved:this.clearSelections,beforerowsinserted:this.clearSelections});if(this.clearSelectionsOnBlur){this.grid.mon(Ext.getBody(),"mousedown",function(a){if(!a.getTarget(this.grid.eventSelector)){this.clearSelections()}},this)}},deselectEvent:function(a,b){this.deselect(this.grid.eventPrefix+b.id)},onRowUpdated:function(g,f,j){var d=this.selected.getCount(),l=j.id;for(var h=d-1;h>=0;h--){var k=this.selected.item(h),e=this.grid.getEventRecordFromDomId(k.dom.id);if(!e||l===e.get("ResourceId")){this.selected.removeElement(k)}}},onViewRefresh:function(){this.clearSelections(true)},clearSelections:function(d,c){if(this.selected.getCount()>0){if(!c){this.selected.removeClass(this.selectedClass)}this.selected.clear();if(!d){this.fireEvent("selectionchange",this,this.selected.elements)}}},hasSelection:function(){return this.selection?true:false},onEventClick:function(f,d,h){var c=h.getTarget(this.grid.eventSelector);if(h.ctrlKey&&this.isSelected(c)){this.deselect(c)}else{this.select(c,this.multiSelect)}},getSelectionCount:function(){return this.selected.getCount()},getSelectedNodes:function(){return this.selected.elements},isSelected:function(b){return this.selected.contains(this.getNode(b).id)},deselect:function(d){var c=this.getNode(d);if(this.isSelected(c)){c=this.getNode(c);this.selected.removeElement(c);Ext.fly(c).removeClass(this.selectedClass);this.fireEvent("selectionchange",this,this.selected.elements)}},select:function(g,f,k){if(Ext.isArray(g)){if(!f){this.clearSelections(true)}for(var h=0,e=g.length;h<e;h++){this.select(g[h],true,true)}if(!k){this.fireEvent("selectionchange",this,this.selected.elements)}}else{var j=this.getNode(g);if(!f){this.clearSelections(true)}if(j&&!this.isSelected(j)){if(this.fireEvent("beforeventselect",this,j,this.selected.elements)!==false){Ext.fly(j).addClass(this.selectedClass);this.selected.add(j);if(!k){this.fireEvent("selectionchange",this,this.selected.elements)}}}}},getNode:function(b){if(typeof b==="string"){return document.getElementById(b)}return b},onEditorKey:Ext.emptyFn});Ext.ns("Sch");Sch.LazyResizable=function(f,d,h,g){this.addEvents("partialresize");Sch.LazyResizable.superclass.constructor.apply(this,arguments);this.handleOver();this.onMouseDown(this[h],g)};Ext.extend(Sch.LazyResizable,Ext.Resizable,{startSizing:Ext.Resizable.prototype.startSizing.createInterceptor(function(a){return this.fireEvent("beforeresize",this,a)!==false}),resizeElement:Ext.Resizable.prototype.resizeElement.createInterceptor(function(){var c=this.proxy.getBox(),b=this.el.getWidth();if(c.width!==b){this.fireEvent("partialresize",this,c.width,b)}})});Ext.ns("Sch.plugins");Sch.plugins.DragSelector=Ext.extend(Ext.dd.DragTracker,{constructor:function(b){b=b||{};Ext.applyIf(b,{onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});Sch.plugins.DragSelector.superclass.constructor.call(this,b)},init:function(b){b.on({afterrender:this.onSchedulerRender,destroy:this.onSchedulerDestroy,scope:this});this.scheduler=b},onBeforeStart:function(a){return a.ctrlKey},onStart:function(f){var a=this.scheduler,d=a.getView();if(!this.proxy){this.proxy=a.el.createChild({cls:"sch-drag-selector x-view-selector"})}else{this.proxy.show()}this.bodyRegion=d.mainBody.getRegion();var g=[];d.mainBody.select(a.eventSelector).each(function(b){g[g.length]={region:b.getRegion(),node:b.dom}},this);this.eventData=g;this.sm.clearSelections()},onDrag:function(j){var n=this,k=n.startXY,c=this.sm,r=this.eventData,q=this.dragRegion,s=n.getXY(),o=Math.min(k[0],s[0]),m=Math.min(k[1],s[1]),p=Math.abs(k[0]-s[0]),f=Math.abs(k[1]-s[1]),d,l,g,b;q.left=o;q.top=m;q.right=o+p;q.bottom=m+f;q.constrainTo(this.bodyRegion);this.proxy.setRegion(q);for(d=0,g=r.length;d<g;d++){l=r[d];b=q.intersect(l.region);if(b&&!l.selected){l.selected=true;c.select(l.node,true)}else{if(!b&&l.selected){l.selected=false;c.deselect(l.node)}}}},onEnd:function(a){if(this.proxy){this.proxy.setDisplayed(false)}},onSchedulerRender:function(a){this.dragRegion=new Ext.lib.Region(0,0,0,0);this.sm=a.getSelectionModel();this.initEl(a.view.mainBody)},onSchedulerDestroy:function(){Ext.destroy(this.proxy);this.destroy()}});Ext.ns("Sch.plugins");Sch.plugins.EventEditor=Ext.extend(Ext.form.FormPanel,{durationText:"hrs",saveText:"Save",deleteText:"Delete",cancelText:"Cancel",hideOnBlur:true,timeConfig:{allowBlank:false,editable:false,forceSelection:true,value:"11:00"},dateConfig:{allowBlank:false},dateFormat:"Y-m-d",timeFormat:"H:i",constructor:function(b){this.addEvents("beforeeventdelete","beforeeventsave");Sch.plugins.EventEditor.superclass.constructor.apply(this,arguments)},show:function(e,d){if(this.deleteButton){this.deleteButton.setVisible(!!e.store)}this.eventRecord=e;var f=Sch.util.Date.getDurationInHours(e.get("StartDate"),e.get("EndDate"));this.durationField.setValue(f);this.getForm().loadRecord(e);d=d||this.scheduler.view.getElementFromEventRecord(e);this.el.alignTo(d,"bl",this.getConstrainOffsets(d));this.expand()},getConstrainOffsets:function(b){return[0,0]},cls:"sch-eventeditor",layout:"border",border:false,onSaveClick:function(){var g=this,f=g.eventRecord,h=g.getForm();if(h.isValid()&&this.fireEvent("beforeeventsave",this,f)!==false){var d=g.startDateField.getValue(),e=g.durationField.getValue();if(d&&e>=0){end=Sch.util.Date.add(d,Sch.util.Date.MINUTE,e*60)}else{return}var j=h.getValues();f.beginEdit();h.updateRecord(f);f.set("StartDate",d);f.set("EndDate",end);f.endEdit();if(!this.eventRecord.store){if(this.scheduler.fireEvent("beforeeventadd",this.scheduler,f)!==false){this.eventStore.add(f)}}g.collapse()}},onDeleteClick:function(){if(this.fireEvent("beforeeventdelete",this,this.eventRecord)!==false){this.eventStore.remove(this.eventRecord)}this.collapse()},onCancelClick:function(){this.collapse()},buildButtons:function(){this.saveButton=new Ext.Button({text:this.saveText,scope:this,handler:this.onSaveClick});this.deleteButton=new Ext.Button({text:this.deleteText,scope:this,handler:this.onDeleteClick});this.cancelButton=new Ext.Button({text:this.cancelText,scope:this,handler:this.onCancelClick});return[this.saveButton,this.deleteButton,this.cancelButton]},buildDurationFields:function(){this.startDateField=new Ext.ux.form.DateTime({name:"StartDate",x:10,y:7,width:160,timeFormat:this.timeFormat,timeWidth:60,timeConfig:this.timeConfig,dateFormat:this.dateFormat,dateConfig:this.dateConfig});this.durationField=new Ext.ux.form.SpinnerField({x:180,y:7,width:55,minValue:0,allowNegative:false});this.durationLabel=new Ext.form.Label({y:7,x:240,xtype:"label",text:this.durationText});return[this.startDateField,this.durationField,this.durationLabel]},initComponent:function(){if(!this.fieldsPanelConfig){throw"Must define a fieldsPanelConfig property"}this.fieldsPanelConfig.region="center";Ext.apply(this,{fbar:this.buildButtons(),items:[{region:"north",layout:"absolute",height:35,border:false,cls:"sch-eventeditor-timefields",items:this.buildDurationFields()},this.fieldsPanelConfig]});Sch.plugins.EventEditor.superclass.initComponent.call(this)},init:function(b){this.scheduler=b;this.eventStore=b.getEventStore();this.scheduler.on({eventdblclick:this.onEventDblClick,afterrender:this.onSchedulerRender,destroy:this.onSchedulerDestroy,dragcreateend:this.onDragCreateEnd,scope:this});this.scheduler.registerEventEditor(this)},onEventDblClick:function(c,b){this.show(b)},onSchedulerRender:function(){this.render(Ext.getBody());this.collapse();if(this.hideOnBlur){this.mon(Ext.getBody(),"mousedown",this.onMouseDown,this)}},onMouseDown:function(c){var b=this.startDateField;if(!this.collapsed&&!c.within(this.getEl())&&(!b.tf.view||!c.within(b.tf.view.el))&&(!b.df.menu||!c.within(b.df.menu.el))){this.collapse(false)}},onSchedulerDestroy:function(){this.scheduler.un("eventdblclick",this.onEventDblClick,this)},onDragCreateEnd:function(c,b){if(!this.dragProxyEl&&this.scheduler.dragCreator){this.dragProxyEl=this.scheduler.dragCreator.getProxy()}this.scheduler.onEventCreated(b);this.show(b,this.dragProxyEl)},onCollapse:function(){var b=this.dragProxyEl;if(b){b.hide()}Sch.plugins.EventEditor.superclass.onCollapse.apply(this,arguments)}});Ext.ns("Sch.plugins");Sch.AbstractTimeSpan=Ext.extend(Ext.util.Observable,{disabled:false,setDisabled:function(b){if(b){this.removeElements()}this.disabled=b},constructor:function(b){this.cls=this.cls||("sch-timespangroup-"+Ext.id());Ext.apply(this,b);Sch.AbstractTimeSpan.superclass.constructor.apply(this,arguments)},getElements:function(){return this.containerEl.select("."+this.cls)},removeElements:function(){return this.getElements().remove()},init:function(b){this.scheduler=b;if(!this.store){throw"Without a store, there's not much use for this plugin"}b.on({render:this.onAfterRender,destroy:this.onDestroy,scope:this})},onAfterRender:function(b){var c=b.getView();this.containerEl=c.scroller;this.schedulerBodyEl=c.mainBody;this.store.on({load:this.renderElements,datachanged:this.renderElements,add:this.renderElements,remove:this.renderElements,update:this.renderElements,clear:this.renderElements,scope:this});c.on({refresh:this.renderElements,rowremoved:this.refreshElements,rowsinserted:this.refreshElements,scope:this});b.on({viewchange:this.renderElements,afterrender:this.renderElements,scope:this});if("togglegroup" in c.events){c.on("togglegroup",this.refreshElements,this)}if("togglerow" in c.events){c.on("togglerow",this.refreshElements,this)}b.mon(b.getColumnModel(),"hiddenchange",this.renderElements,this)},renderElements:function(){if(this.disabled||!this.scheduler.viewReady){return}this.renderElementsInternal.defer(10,this)},renderElementsInternal:function(){this.removeElements();var d=this.schedulerBodyEl.getHeight(),f=this.scheduler.getStart(),b=this.scheduler.getEnd(),e=this.getElementData(f,b,d);for(var c=0,a=e.length;c<a;c++){e[c].uniquecls=this.cls}this.template.insertFirst(this.containerEl,e)},getElementData:function(e,d,f){throw"Abstract method call"},refreshElements:function(){var a=this.schedulerBodyEl.getHeight();this.getElements().setHeight(a)},onDestroy:function(){this.store.destroy()}});Ext.ns("Sch.plugins");Sch.plugins.Lines=Ext.extend(Sch.AbstractTimeSpan,{dateFormat:"y-m-d G:i",init:function(b){if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div title="{[values.Date.format("'+this.dateFormat+'")]} - {[values.Text || ""]}" class="sch-timeline {uniquecls} {Cls}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px"></div>',"</tpl>")}Sch.plugins.Lines.superclass.init.call(this,b)},getElementData:function(p,o){var q=this.store,k=this.scheduler,n=k.getView(),g=q.getRange(),j=[],c,e,m,d;for(var h=0,f=q.getCount();h<f;h++){c=g[h];e=c.get("Date");if(e.between(p,o)){m=n.getTimeSpanRegion(e);j[j.length]=Ext.apply({left:m.left,top:m.top,width:Math.max(1,m.right-m.left),height:Math.max(1,m.bottom-m.top)},c.data)}}return j}});Ext.ns("Sch.plugins");Sch.plugins.Zones=Ext.extend(Sch.AbstractTimeSpan,{init:function(b){if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div class="sch-zone {uniquecls} {Cls}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px"></div>',"</tpl>")}Sch.plugins.Zones.superclass.init.call(this,b)},getElementData:function(o,n){var q=this.store,j=this.scheduler,m=j.getView(),f=q.getRange(),h=[],c,p,d,k;for(var g=0,e=q.getCount();g<e;g++){c=f[g];p=c.get("StartDate");d=c.get("EndDate");if(Sch.util.Date.intersectSpans(p,d,o,n)){k=m.getTimeSpanRegion(Sch.util.Date.max(p,o),Sch.util.Date.min(d,n));h[h.length]=Ext.apply({left:k.left,top:k.top,width:k.right-k.left,height:k.bottom-k.top},c.data)}}return h}});Ext.ns("Sch.plugins");Sch.plugins.SummaryColumn=Ext.extend(Ext.grid.Column,{showPercent:false,nbrDecimals:1,dayText:"d",hourText:"h",minuteText:"min",sortable:false,fixed:true,menuDisabled:true,width:80,dataIndex:"_sch_not_used",constructor:function(b){this.renderer=this.renderer.createDelegate(this);Sch.plugins.SummaryColumn.superclass.constructor.call(this,b)},init:function(b){this.grid=b;this.eventStore=b.eventStore},renderer:function(m,c,k){var h=this.grid,n=this.eventStore,f=h.getStart(),l=h.getEnd(),e=0,d=this.calculate(n.query("ResourceId",k.get("Id")),f,l);if(d<=0){return""}if(this.showPercent){var j=Sch.util.Date.getDurationInMinutes(f,l);return Math.min(100,(Math.round((d*100)/j)))+" %"}else{if(d>1440){return(d/1440).toFixed(this.nbrDecimals)+" "+this.dayText}if(d>=30){return(d/60).toFixed(this.nbrDecimals)+" "+this.hourText}return d+" "+this.minuteText}},calculate:function(f,k,j){var h=0,g,a;f.each(function(b){g=b.get("StartDate");a=b.get("EndDate");if(Sch.util.Date.intersectSpans(k,j,g,a)){h+=Sch.util.Date.getDurationInMinutes(Sch.util.Date.max(g,k),Sch.util.Date.min(a,j))}});return h}});Ext.ns("Sch");Sch.SchedulerPanel=Ext.extend(Sch.AbstractSchedulerPanel,{enableEventDragDrop:true,enableDragCreation:true,allowOverlap:true,constrainDragToResource:false,startParamName:"start",endParamName:"end",passStartEndParameters:false,viewOrientation:"horizontal",rowHeight:22,getViewOrientation:function(){return this.viewOrientation},dndValidatorFn:function(g,f,k,j,h){return true},resizeValidatorFn:function(g,f,k,j,h){return true},createValidatorFn:function(f,d,h,g){return true},timeCellRenderer:Ext.emptyFn,getResourceStore:function(){return this.resourceStore},getEventStore:function(){return this.eventStore},getEventRecordFromElement:function(d){var c=Ext.get(d);if(!c.is(this.eventSelector)){c=c.up(this.eventSelector)}return this.getEventRecordFromDomId(c.id)},cmpCls:"sch-schedulerpanel",eventSelector:".sch-event",setReadOnly:function(b){if(this.dragCreator){this.dragCreator.setDisabled(b)}Sch.SchedulerPanel.superclass.setReadOnly.apply(this,arguments)},getEventRecordFromDomId:function(d){var c=this.getEventIdFromDomNodeId(d);return this.eventStore.getById(c)},getSelectedRecords:function(){var d=[],c=this.getSelectionModel().selected.elements;for(var b=0,a=c.length;b<a;b++){d[d.length]=this.getEventRecordFromDomId(c[b].id)}return d},onDestroy:function(){if(this.eventStore.autoDestroy){this.eventStore.destroy()}Sch.SchedulerPanel.superclass.onDestroy.call(this)},afterRender:function(){Sch.SchedulerPanel.superclass.afterRender.apply(this,arguments);this.el.addClass("sch-"+this.viewOrientation);this.setupClickListeners()},initComponent:function(){var b=this.resourceStore||this.store;if(!this.selModel&&!this.disableSelection){this.selModel=new Sch.EventSelectionModel()}Ext.applyIf(this,{viewOrientation:this.viewOrientation,store:b,resourceStore:b});Sch.SchedulerPanel.superclass.initComponent.call(this);if(!this.eventTemplate){this.eventTemplate=new Ext.XTemplate('<div unselectable="on" id="'+this.eventPrefix+'{id}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event x-unselectable {internalcls} {cls}">',(this.resizeHandles==="both"||this.resizeHandles==="start")?String.format(this.resizeHandleHtml,"start"):"",(this.resizeHandles==="both"||this.resizeHandles==="end")?String.format(this.resizeHandleHtml,"end"):"",'<div unselectable="on" class="sch-event-inner">{body}',"</div>","</div>",{compiled:true,disableFormats:true})}this.setupEvents();this.configureFunctionality()},setupEvents:function(){this.on({beforednd:this.onBeforeDragDrop,dndstart:this.onDragDropStart,afterdnd:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeresize:this.onBeforeResize,resizestart:this.onResizeStart,resizeend:this.onResizeEnd,scope:this});if(this.passStartEndParameters){this.eventStore.on("beforeload",this.applyStartEndParameters,this)}},applyStartEndParameters:function(d,c){c.params=c.params||{};c.params[this.startParamName]=this.getStart();c.params[this.endParamName]=this.getEnd()},getTooltipRecord:function(b){return this.getEventRecordFromDomId(b.id)},setupClickListeners:function(){this.mon(this.getView().mainBody,{click:function(b){var a=b.getTarget(this.eventSelector);if(a){b.stopEvent();this.fireEvent("eventclick",this,this.getEventRecordFromDomId(a.id),b)}},dblclick:function(b){var a=b.getTarget(this.eventSelector);if(a){b.stopEvent();this.fireEvent("eventdblclick",this,this.getEventRecordFromDomId(a.id),b)}},contextmenu:function(b){var a=b.getTarget(this.eventSelector);if(a){b.stopEvent();this.fireEvent("eventcontextmenu",this,this.getEventRecordFromDomId(a.id),b)}},scope:this},this)},configureFunctionality:function(){var a=this.validatorFnScope||this;if(this.resizeHandles!=="none"&&Sch.Resize){this.resizePlug=new Sch.Resize(this,Ext.applyIf({validatorFn:function(f,e,h,g){return(this.allowOverlap||this.isDateRangeAvailable(h,g,e.id,f.id))&&this.resizeValidatorFn.apply(a,arguments)},validatorFnScope:this},this.resizeConfig||{}))}if(this.enableEventDragDrop!==false&&Sch.DragDrop){this.dragdropPlug=new Sch.DragDrop(this,{validatorFn:function(g,f,k,j,h){return(this.allowOverlap||this.isDateRangeAvailable(k,Sch.util.Date.add(k,Sch.util.Date.MILLI,j),g[0].id,f.id))&&this.dndValidatorFn.apply(a,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{},dropConfig:this.dropConfig||{}})}if(this.enableDragCreation!==false&&Sch.DragCreator){this.dragCreator=new Sch.DragCreator(this,Ext.applyIf({disabled:this.readOnly,validatorFn:function(e,d,f){return(this.allowOverlap||this.isDateRangeAvailable(d,f,null,e.id))&&this.createValidatorFn.apply(a,arguments)},validatorFnScope:this},this.createConfig||{}))}},onBeforeDragDrop:function(c,b,d){return !this.readOnly&&!d.getTarget().className.match("x-resizable-handle")},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(true)}if(this.tip){this.tip.hide();this.tip.disable()}},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(false)}if(this.tip){this.tip.enable()}},onBeforeDragCreate:function(a,b){return !this.readOnly&&!b.ctrlKey},onDragCreateStart:function(){if(this.overClass){var a=this.getView().mainBody;this.mun(a,"mouseover",this.onMouseOver,this);this.mun(a,"mouseout",this.onMouseOut,this)}if(this.tip){this.tip.hide();this.tip.disable()}},onDragCreateEnd:function(c,b,d){if(!this.eventEditor){if(this.fireEvent("beforeeventadd",this,b)!==false){this.onEventCreated(b);this.eventStore.add(b);this.dragCreator.getProxy().hide()}}},onEventCreated:function(b){},onAfterDragCreate:function(){if(this.overClass){this.mon(this.getView().mainBody,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this})}if(this.tip){this.tip.enable()}},onBeforeResize:function(c,b,d){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onResizeEnd:function(){if(this.tip){this.tip.enable()}},getResourceByEventRecord:function(b){return this.resourceStore.getById(b.get("ResourceId"))},isDateRangeAvailable:function(g,f,k,j){var h=true;this.eventStore.each(function(a){if(Sch.util.Date.intersectSpans(g,f,a.get("StartDate"),a.get("EndDate"))&&(j===a.get("ResourceId")&&(!k||k!==a.id))){h=false;return false}});return h},getEventsInView:function(){var b=this.getStart(),a=this.getEnd();return this.eventStore.queryBy(function(e){var d=e.get("StartDate"),c=e.get("EndDate");return Sch.util.Date.intersectSpans(d,c,b,a)})},constructor:function(b){this.addEvents("eventclick","eventdblclick","eventcontextmenu","beforeresize","resizestart","partialresize","afterresize","beforednd","dndstart","drop","afterdnd","beforedragcreate","dragcreatestart","dragcreateend","afterdragcreate","beforeeventadd");Sch.SchedulerPanel.superclass.constructor.call(this,b)},getView:function(){if(!this.view){var d=this.viewConfig||{};if(this.viewOrientation==="horizontal"){var c=this.getColumnModel(),e=(c.getColumnCount()>0&&c.config[0].locked);if(e){this.view=new Sch.LockingSchedulerView(d)}else{this.view=new Sch.HorizontalSchedulerView(d)}}else{throw"Not supported"}}return this.view},registerEventEditor:function(b){this.eventEditor=b},getEventEditor:function(){return this.eventEditor},getDateConstraints:function(d,c){},getRowHeight:function(){return this.view.rowHeight},setRowHeight:function(b){this.getView().setRowHeight(b)}});Ext.reg("scheduler",Sch.SchedulerPanel);Ext.ns("Sch.plugins");Sch.plugins.Pan=Ext.extend(Object,{enableVerticalPan:true,hideScrollbar:false,constructor:function(b){Ext.apply(this,b)},init:function(b){b.on("render",this.onRender,this)},onRender:function(b){this.eventSelector=b.eventSelector;this.panEl=b.getView().scroller;b.mon(this.panEl,"mousedown",this.onMouseDown,this,{delegate:".x-grid3-row"});if(this.hideScrollbar){this.panEl.setStyle("overflow","hidden")}},onMouseDown:function(b,a){if(!b.getTarget(this.eventSelector)){this.mouseX=b.getPageX();this.mouseY=b.getPageY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this)}},onMouseMove:function(d){d.stopEvent();var a=d.getPageX(),f=d.getPageY(),c=a-this.mouseX,b=f-this.mouseY;this.panEl.scrollTo("left",this.panEl.dom.scrollLeft-c);this.mouseX=a;this.mouseY=f;if(this.enableVerticalPan){this.panEl.scrollTo("top",this.panEl.dom.scrollTop-b)}},onMouseUp:function(a){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this)}});Ext.ns("Sch.plugins");Sch.plugins.TimeGap=Ext.extend(Sch.plugins.Zones,{getZoneCls:Ext.emptyFn,init:function(b){this.store=new Ext.data.JsonStore({fields:["StartDate","EndDate","Cls"]});b.on("viewchange",this.populateStore,this);b.eventStore.on({load:this.populateStore,update:this.populateStore,remove:this.populateStore,add:this.populateStore,datachanged:this.populateStore,scope:this});Sch.plugins.TimeGap.superclass.init.apply(this,arguments)},populateStore:function(k){var j=this.scheduler.getEventsInView(),f=[],e=this.scheduler.getStart(),m=this.scheduler.getEnd(),b=j.getCount(),n=e,h,g=0,a;j.sort("ASC",function(d,c){return d.get("StartDate")-c.get("StartDate")});a=j.itemAt(0);while(n<m&&g<b){h=a.get("StartDate");if(!Sch.util.Date.betweenLesser(n,h,a.get("EndDate"))&&n<h){f.push(new this.store.recordType({StartDate:n,EndDate:h,Cls:this.getZoneCls(n,h)||""}))}n=Sch.util.Date.max(a.get("EndDate"),n);g++;a=j.itemAt(g)}if(n<m){f.push(new this.store.recordType({StartDate:n,EndDate:m,Cls:this.getZoneCls(n,m)||""}))}this.store.removeAll(f.length>0);this.store.add(f)}});Ext.ns("Sch.plugins");Sch.plugins.CurrentTimeLine=function(d,c){Ext.apply(this,d);this.grid=c;Sch.plugins.CurrentTimeLine.superclass.constructor.call(this)};Ext.extend(Sch.plugins.CurrentTimeLine,Sch.plugins.Lines,{tooltipText:"Current time",updateInterval:60000,autoUpdate:true,init:function(d){var c=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.tooltipText}]});if(this.autoUpdate){this.runner=new Ext.util.TaskRunner();this.runner.start({run:function(){c.getAt(0).set("Date",new Date())},interval:this.updateInterval})}d.on("destroy",this.onHostDestroy,this);this.store=c;Sch.plugins.CurrentTimeLine.superclass.init.apply(this,arguments)},onHostDestroy:function(){if(this.runner){this.runner.stopAll()}}});Ext.ns("Sch");Sch.ClockTemplate=function(){var j=Math.PI/180,m=Math.cos,k=Math.sin,n=7,d=2,e=10,l=6,f=3,a=10;function b(r){var q=r*j,c=m(q),t=k(q),p=l*k((90-r)*j),s=l*m((90-r)*j),u=Math.min(l,l-p),o=r>180?s:0,v="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+c+", M12 = "+(-t)+", M21 = "+t+", M22 = "+c+")";return String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",v,u+f,o+a)}function h(r){var q=r*j,c=m(q),t=k(q),p=n*k((90-r)*j),s=n*m((90-r)*j),u=Math.min(n,n-p),o=r>180?s:0,v="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+c+", M12 = "+(-t)+", M21 = "+t+", M22 = "+c+")";return String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",v,u+d,o+e)}function g(c){return String.format("transform:rotate({0}deg);-moz-transform: rotate({0}deg);-webkit-transform: rotate({0}deg);-o-transform:rotate({0}deg);",c)}return new Ext.XTemplate('<div class="sch-clockwrap {cls}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours()%12) * 30)]}">{[Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6)]}">{[values.date.getDate()]}</div></div><span class="sch-clock-text">{text}</span></div>',{compiled:true,disableFormats:true,getMinuteStyle:Ext.isIE?h:g,getHourStyle:Ext.isIE?b:g})};Ext.ns("Sch");Sch.DragCreator=function(d,c){Ext.apply(this,c||{});this.lastTime=new Date(1970);this.scheduler=d;this.scheduler.on({render:this.onSchedulerRender,destroy:this.onSchedulerDestroy,scope:this});Sch.DragCreator.superclass.constructor.call(this)};Ext.extend(Sch.DragCreator,Ext.util.Observable,{disabled:false,showHoverTip:true,showDragTip:true,dragTolerance:2,template:new Ext.Template('<div class="sch-dragcreator-proxy sch-event"><div class="sch-event-inner"></div></div>',{compiled:true,disableFormats:true}),validatorFn:Ext.emptyFn,validatorFnScope:null,setDisabled:function(b){this.disabled=b;if(this.hoverTip){this.hoverTip.setDisabled(b)}if(this.dragTip){this.dragTip.setDisabled(b)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.scheduler.getView().el,{},true)}return this.proxy},onMouseMove:function(f){var d=this.hoverTip;if(d.disabled||this.dragging){return}if(f.getTarget(".sch-timetd",2)||f.getTarget(".x-grid3-row",1)){var c=this.scheduler.getDateFromDomEvent(f,"floor");if(c){if(c-this.lastTime!==0){this.updateHoverTip(c);this.lastTime=c;d.doAutoWidth();if(d.hidden){try{d[Sch.util.Date.compareUnits(this.scheduler.getTimeResolution().unit,Sch.util.Date.DAY)>=0?"addClass":"removeClass"]("sch-day-resolution");d.show()}catch(f){}}}}else{d.hide();this.lastTime=null}}else{d.hide();this.lastTime=null}},updateHoverTip:function(d){if(d){var c=this.scheduler.getFormattedDate(d);this.hoverTipTemplate.overwrite(this.hoverTip.body,{date:d,text:c})}},onBeforeDragStart:function(d){var a=d.getTarget(".sch-timetd",2),b=this.scheduler,c=b.view.resolveResource(a);if(!this.disabled&&a&&b.fireEvent("beforedragcreate",b,c,d)!==false){this.resourceRecord=c;this.originalStart=b.getDateFromDomEvent(d);this.resourceRegion=b.view.getScheduleRegion(this.resourceRecord,this.originalStart);this.dateConstraints=b.getDateConstraints(this.resourceRecord,this.originalStart);return true}return false},onDragStart:function(){var e=this,d=e.scheduler.view,f=e.getProxy();e.containerRegion=d.mainBody.getRegion();this.dragging=true;if(e.scheduler.snapToIncrement){e.originalStart=e.scheduler.floorDate(e.originalStart);var c=e.scheduler.getXYFromDate(e.originalStart);e.tracker.startXY[0]=c[0]+e.containerRegion.left;e.tracker.startXY[1]=c[1]+e.containerRegion.top}if(this.hoverTip){this.hoverTip.disable()}e.start=e.originalStart;e.end=e.start;e.dragRegion.top=e.resourceRegion.top;e.dragRegion.bottom=e.resourceRegion.bottom;f.show();f.setRegion({top:e.dragRegion.top,right:e.tracker.startXY[0],bottom:e.dragRegion.bottom,left:e.tracker.startXY[0]});e.scheduler.fireEvent("dragcreatestart",e.scheduler);if(e.showDragTip){e.dragTip.update(e.start,e.end,true);e.dragTip.targetXY=f.getXY();e.dragTip.enable().show()}},onDrag:function(d){var h=this,n=h.scheduler,l=n.getDateFromDomEvent(d);if(!l){return}var g=h.tracker.startXY,m=h.tracker.getXY(),j=m[0],f=n.view,k=Math.abs(g[0]-m[0]),c=h.dragRegion;if(l){if(l>h.originalStart){h.start=n.floorDate(h.originalStart);h.end=n.roundDate(l);if(h.dateConstraints){h.end=Sch.util.Date.constrain(h.end,h.dateConstraints.start,h.dateConstraints.end)}}else{h.end=n.roundDate(h.originalStart);h.start=n.roundDate(l);if(h.dateConstraints){h.start=Sch.util.Date.constrain(h.start,h.dateConstraints.start,h.dateConstraints.end)}}this.valid=this.validatorFn.call(this.validatorFnScope||this,this.resourceRecord,h.start,h.end)!==false;if(h.showDragTip){h.dragTip.update(h.start,h.end,this.valid)}if(l>h.originalStart){c.left=g[0];if(n.snapToIncrement){c.right=n.getXYFromDate(h.end)[0]+h.containerRegion.left}else{c.right=g[0]+k;c.constrainTo(this.resourceRegion)}}else{if(n.snapToIncrement){c.left=n.getXYFromDate(h.start)[0]+h.containerRegion.left}else{c.left=g[0]-k;c.constrainTo(this.resourceRegion)}c.right=g[0]}this.getProxy().setRegion(c)}},onDragEnd:function(d){var c=this.scheduler;this.dragging=false;if(this.showDragTip){this.dragTip.hide()}if(!this.start||!this.end||(this.end-this.start<=0)){this.valid=false}if(this.valid){var b=new c.eventStore.recordType({ResourceId:this.resourceRecord.get("Id"),StartDate:this.start,EndDate:this.end});c.fireEvent("dragcreateend",c,b,this.resourceRecord,d)}else{this.proxy.hide()}this.scheduler.fireEvent("afterdragcreate",c);if(this.hoverTip){this.hoverTip.enable()}},tipCfg:{trackMouse:true,bodyCssClass:"sch-hovertip",autoHide:false,dismissDelay:1000,showDelay:300},dragging:false,onSchedulerRender:function(d){var c=d.getView().mainBody;this.tracker=new Ext.dd.DragTracker({el:c,tolerance:this.dragTolerance,onBeforeStart:this.onBeforeDragStart.createDelegate(this),onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this)});this.dragRegion=new Ext.lib.Region(0,0,0,0);if(this.showDragTip){this.dragTip=new Sch.Tooltip({cls:"sch-dragcreate-tip",scheduler:d,listeners:{beforeshow:{fn:function(){return this.dragging},scope:this}}})}if(this.showHoverTip){this.hoverTipTemplate=this.hoverTipTemplate||new Sch.ClockTemplate();this.hoverTip=new Ext.ToolTip(Ext.applyIf({renderTo:document.body,target:c,disabled:this.disabled,delayShow:Ext.emptyFn},this.tipCfg));this.hoverTip.on("beforeshow",this.onBeforeShow,this);d.mon(c,"mousemove",this.onMouseMove,this);d.mon(c,"mouseleave",function(){this.hoverTip.hide()},this)}},onSchedulerDestroy:function(){if(this.hoverTip){this.hoverTip.destroy()}if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}},onBeforeShow:function(b){return !this.disabled&&!this.dragging&&b.body.dom.innerHTML!==""&&this.lastTime!==null}});Ext.ns("Sch");Sch.DragDrop=Ext.extend(Ext.util.Observable,{validatorFn:function(g,f,k,j,h){return true},enableCopy:false,useDragProxy:false,showTooltip:true,constructor:function(d,c){Ext.apply(this,c);this.scheduler=d;this.scheduler.on({afterrender:this.onRender,destroy:this.cleanUp,scope:this});Sch.DragDrop.superclass.constructor.call(this)},cleanUp:function(){if(this.scheduler.dragZone){this.scheduler.dragZone.destroy()}if(this.scheduler.dropZone){this.scheduler.dropZone.destroy()}if(this.tip){this.tip.destroy()}},onRender:function(){var b=!!document.elementFromPoint;if(!this.dragConfig.useDragProxy&&b){this.initProxyLessDD()}else{this.initProxyDD()}},initProxyLessDD:function(){var b=this.scheduler,a=b.getView();b.dragZone=new Sch.PointSchedulerDragZone(a.mainBody,Ext.apply({ddGroup:b.id,scheduler:b,enableCopy:this.enableCopy,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope,showTooltip:this.showTooltip,view:a},this.dragConfig))},initProxyDD:function(){var b=this.scheduler,a=this.scheduler.getView();b.dragZone=new Sch.SchedulerDragZone(a.scroller,Ext.apply({ddGroup:this.scheduler.id,scheduler:this.scheduler,enableCopy:this.enableCopy},this.dragConfig));b.dropZone=new Sch.SchedulerDropZone(a.mainBody,Ext.apply({ddGroup:this.scheduler.id,scheduler:this.scheduler,enableCopy:this.enableCopy,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dropConfig))}});Sch.ClassicDDProxy=function(a){return new Ext.XTemplate('<span class="sch-dd-newtime">{[ this.getText(values) ]}</span>',{getText:function(d){var c=a.getFormattedDate(d.StartDate);if(d.Duration){c+=" - "+a.getFormattedEndDate(Sch.util.Date.add(d.StartDate,Sch.util.Date.MILLI,d.Duration),d.StartDate)}return c}})};Sch.SchedulerDragZone=Ext.extend(Ext.dd.DragZone,{containerScroll:true,onStartDrag:function(){var a=this.scheduler;a.fireEvent("dndstart",a,this.dragData.records)},getDragData:function(n){var r=this.scheduler,j=n.getTarget(r.eventSelector);if(j){var q=r.getSelectionModel(),m=Ext.get(j),d=m.is(r.eventSelector)?j:m.up(r.eventSelector).dom,o=r.getEventRecordFromDomId(d.id);if(!q.isSelected(d)){q.select(d,q.multiSelect,true)}if(r.fireEvent("beforednd",r,o,n)===false){return null}var p,h=o.get("StartDate"),g=q.getSelectedNodes(),c,f=Ext.get(Ext.DomHelper.createDom({cls:"sch-dd-wrap",children:[{cls:"sch-dd-proxy-hd",html:"&nbsp"}]}));for(var k=0,l=g.length;k<l;k++){c=g[k].cloneNode(true);c.id=Ext.id();f.appendChild(c)}return{repairXY:Ext.fly(j).getXY(),ddel:f.dom,sourceEventRecord:o,records:r.getSelectedRecords(),duration:o.get("EndDate")-h}}return null},afterRepair:function(){this.dragging=false;var a=this.scheduler;a.fireEvent("afterdnd",a)},getRepairXY:function(){return this.dragData.repairXY},onDragKeyDown:function(b){var a=this.getProxy();if(b.ctrlKey&&(a.dropStatus===a.dropAllowed||a.dropStatus===(a.dropAllowed+" add"))){a.setStatus(a.dropAllowed+" add")}},onDragKeyUp:function(b){if(!b.ctrlKey){var a=this.getProxy();a.setStatus(a.dropStatus.replace(" add",""))}},onMouseDown:function(){if(this.enableCopy){Ext.getBody().on({keydown:this.onDragKeyDown,keyup:this.onDragKeyUp,scope:this})}},onMouseUp:function(){var a=Ext.getBody();a.un("keydown",this.onDragKeyDown,this);a.un("keyup",this.onDragKeyUp,this)}});Sch.SchedulerDropZone=Ext.extend(Ext.dd.DropZone,{constructor:function(){Sch.SchedulerDropZone.superclass.constructor.apply(this,arguments);this.proxyTpl=this.proxyTpl||new Sch.ClassicDDProxy(this.scheduler)},validatorFn:Ext.emptyFn,getTargetFromEvent:function(a){return a.getTarget(".sch-timetd")},onNodeEnter:function(f,d,g,h){Ext.fly(f).addClass("sch-dd-cellover")},onNodeOut:function(f,d,g,h){Ext.fly(f).removeClass("sch-dd-cellover")},onNodeOver:function(g,f,l,n){var j=this.scheduler,h=j.getDateFromDomEvent(l,"round"),k;if(!h){return this.dropNotAllowed}this.proxyTpl.overwrite(f.proxy.el.child(".sch-dd-proxy-hd"),{StartDate:h,Duration:n.duration});var m=j.view.resolveResource(g);if(this.validatorFn.call(this.validatorFnScope||this,n.records,m,h,n.duration,l)!==false){return this.dropAllowed+((this.enableCopy&&l.ctrlKey)?" add":"")}else{return this.dropNotAllowed}},onNodeDrop:function(p,o,k,n){var r=this.scheduler,q=r.getView(),g=r.view.resolveResource(p),h=r.getDateFromDomEvent(k,"round"),f=false,m=this.enableCopy&&k.ctrlKey;if(h&&this.validatorFn.call(this.validatorFnScope||this,n.records,g,h,n.duration,k)!==false){var l,j=r.resourceStore.indexOf(g);if(m){l=this.copyRecords(n.records,h,g,n.sourceEventRecord,j);f=true}else{f=this.updateRecords(n.records,h,g,n.sourceEventRecord,j,n)}if(f){r.getSelectionModel().clearSelections()}r.fireEvent("drop",r,m?l:n.records,m)}r.fireEvent("afterdnd",r);return f},updateRecords:function(v,t,s,q,p,o){if(v.length===1){q.beginEdit();q.set("ResourceId",s.get("Id"));q.set("StartDate",t);q.set("EndDate",Sch.util.Date.add(t,Sch.util.Date.MILLI,o.duration));q.endEdit();return true}var m=q.get("StartDate"),x=s.store,z=t-m,n=x.indexOfId(q.get("ResourceId")),w,u,k,h,y,j=x.getCount(),l;for(l=0;l<v.length;l++){h=v[l];u=x.indexOfId(h.get("ResourceId"));y=u-n+p;if(y<0||y>j){return false}}for(l=0;l<v.length;l++){h=v[l];u=x.indexOfId(h.get("ResourceId"));w=u-n;k=x.getAt(p+w);h.beginEdit();h.set("ResourceId",k.get("Id"));h.set("StartDate",Sch.util.Date.add(h.get("StartDate"),Sch.util.Date.MILLI,z));h.set("EndDate",Sch.util.Date.add(h.get("EndDate"),Sch.util.Date.MILLI,z));h.endEdit()}return true},copyRecords:function(h,g,o,n,m){var k=h[0],j=k.copy(),l=n.get("EndDate")-n.get("StartDate");j.set("ResourceId",o.get("Id"));j.set("StartDate",g);j.set("EndDate",Sch.util.Date.add(g,Sch.util.Date.MILLI,l));return[j]}});Sch.SchedulerDragProxy=Ext.extend(Ext.dd.StatusProxy,{constructor:function(b){Ext.apply(this,b);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,tag:"div",cls:"sch-dragproxy x-dd-drag-proxy",children:[{tag:"div",cls:"x-dd-drag-ghost"}]},shadow:false});this.ghost=Ext.get(this.el.dom.childNodes[0]);this.dropStatus=this.dropNotAllowed},reset:function(b){this.el.dom.className="sch-dragproxy x-dd-drag-proxy "+this.dropNotAllowed;this.dropStatus=this.dropNotAllowed;if(b){this.ghost.update("")}}});Sch.PointSchedulerDragZone=Ext.extend(Ext.dd.DragZone,{containerScroll:true,getRepairXY:function(){return this.dragData.repairXY},constructor:function(d,c){c.proxy=new Sch.SchedulerDragProxy({shadow:false,dropAllowed:Ext.dd.StatusProxy.prototype.dropAllowed+" sch-dragproxy",dropNotAllowed:Ext.dd.StatusProxy.prototype.dropNotAllowed+" sch-dragproxy"});Sch.PointSchedulerDragZone.superclass.constructor.apply(this,arguments);this.scroll=false;this.isTarget=true;this.ignoreSelf=false;Ext.dd.ScrollManager.register(this.view.scroller)},destroy:function(){Sch.PointSchedulerDragZone.superclass.destroy.call(this);Ext.dd.ScrollManager.unregister(this.view.scroller)},autoOffset:function(b,f){var c=this.dragData.repairXY,e=b-c[0],d=f-c[1];this.setDelta(e,d)},constrainTo:function(d,c){this.resetConstraints();this.initPageX=d.left;this.initPageY=d.top;this.setXConstraint(d.left,d.right-(c.right-c.left),this.xTickSize);this.setYConstraint(d.top,d.bottom-(c.bottom-c.top),this.yTickSize)},setXConstraint:function(e,d,f){this.leftConstraint=e;this.rightConstraint=d;this.minX=e;this.maxX=d;if(f){this.setXTicks(this.initPageX,f)}this.constrainX=true},setYConstraint:function(e,d,f){this.topConstraint=e;this.bottomConstraint=d;this.minY=e;this.maxY=d;if(f){this.setYTicks(this.initPageY,f)}this.constrainY=true},resolveStartEndDates:function(e){var c=this.dragData,f=c.origStart,d=c.origEnd;if(!c.startsOutsideView){f=this.scheduler.getDateFromXY([e.left,e.top],"round")||c.start;d=Sch.util.Date.add(f,Sch.util.Date.MILLI,c.duration)}else{if(!c.endsOutsideView){d=this.scheduler.getDateFromXY([e.left+c.eventNodeWidth,e.top],"round")||c.end;f=Sch.util.Date.add(d,Sch.util.Date.MILLI,-c.duration)}}c.start=f;c.end=d},onDragOver:function(h,f){var d=this.dragData,g=this.scheduler,k=this.proxy.el.getRegion();this.resolveStartEndDates(k);if(!d.originalHidden){d.sourceNode.hide();d.originalHidden=true}var j=g.constrainDragToResource?d.resourceRecord:this.resolveResource([k.left+d.offsets[0],k.top+d.offsets[1]]);if(j){d.resourceRecord=j;this.valid=this.validatorFn.call(this.validatorFnScope||this,[d.eventRecord],j,d.start,d.duration,h)}else{this.valid=false}if(this.showTooltip){this.tip.update(d.start,d.end,this.valid)}},onStartDrag:function(){var b=this.scheduler,a=this.dragData;this.start=a.origStart;this.end=a.origEnd;if(this.showTooltip){if(!this.tip){this.tip=new Sch.Tooltip({constrainToResource:false,scheduler:b,autoHide:true,cls:"sch-dragdrop-tip"})}this.tip.enable();this.tip.mouseOffset=[0,-a.offsets[1]+4];this.tip.targetXY=[a.repairXY[0]+a.offsets[0],a.repairXY[1]+a.offsets[1]];this.tip.update(this.start,this.end,true);this.tip.show()}b.fireEvent("dndstart",b,[a.eventRecord])},getDragData:function(o){var x=this.scheduler,w=o.getTarget(x.eventSelector);if(!w){return}var r=x.getEventRecordFromDomId(w.id);if(x.fireEvent("beforednd",x,r,o)===false){return null}var q=o.getXY(),f=Ext.get(w),k=f.getXY(),j=[q[0]-k[0],q[1]-k[1]],h=x.getResourceByEventRecord(r),v=f.getRegion(),l=x.view.getSnapPixelAmount();this.clearTicks();if(x.constrainDragToResource){this.constrainTo(this.view.getScheduleRegion(h,r),v);this.setYConstraint(v.top,v.top)}else{this.constrainTo(this.view.getScheduleRegion(null,r),v)}if(l!==1){this.setXConstraint(this.leftConstraint,this.rightConstraint,l)}var p=r.get("StartDate"),n=r.get("EndDate"),d=f.dom.cloneNode(true),m=p<x.getStart(),g=n>x.getEnd(),u=Ext.getBody().getScroll();d.id=Ext.id();return{offsets:j,sourceNode:f,repairXY:k,ddel:d,eventRecord:r,resourceRecord:h,origStart:p,origEnd:n,eventNodeWidth:v.right-v.left,duration:n-p,startsOutsideView:m,endsOutsideView:g,bodyScroll:u}},afterRepair:function(){var a=this.scheduler;this.dragData.sourceNode.show();this.dragging=false;a.fireEvent("afterdnd",a)},onDragDrop:function(g,k){var m=this.scheduler,h=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(k),f=this.dragData,c=f.start,l=false;if(this.valid&&f.start&&f.end){var j=this.dragData.eventRecord,d=f.resourceRecord.get("Id");l=(f.start-f.origStart)!==0||(f.end-f.origEnd)!==0||d!==j.get("ResourceId");j.beginEdit();j.set("ResourceId",f.resourceRecord.get("Id"));j.set("StartDate",f.start);j.set("EndDate",f.end);j.endEdit();m.fireEvent("drop",m,[j],false)}if(this.tip){this.tip.disable()}if(this.valid&&l){this.onValidDrop(h,g,k)}else{this.onInvalidDrop(h,g,k)}m.fireEvent("afterdnd",m)},onInvalidDrop:function(){if(this.tip){this.tip.disable()}Sch.PointSchedulerDragZone.superclass.onInvalidDrop.apply(this,arguments)},resolveResource:function(e){var d=this.proxy.el.dom;d.style.display="none";var f=document.elementFromPoint(e[0]-this.dragData.bodyScroll.left,e[1]-this.dragData.bodyScroll.top);d.style.display="block";return this.view.resolveResource(f)}});Ext.ns("Sch");Ext.ns("Sch");Sch.Resize=function(d,c){Ext.apply(this,c);this.scheduler=d;this.scheduler.on({render:this.onSchedulerRender,destroy:this.cleanUp,scope:this});Sch.Resize.superclass.constructor.call(this)};Ext.extend(Sch.Resize,Ext.util.Observable,{useTooltip:true,validatorFn:Ext.emptyFn,validatorFnScope:null,onSchedulerRender:function(){var a=this.scheduler;a.mon(a.getView().mainBody,"mousedown",this.onMouseDown,this,{delegate:".x-resizable-handle"})},onMouseDown:function(c){var b=this.scheduler,a=c.getTarget(b.eventSelector),d=b.getEventRecordFromElement(a);if(b.fireEvent("beforeresize",b,d,c)===false){return}c.stopEvent();this.createResizable(Ext.get(a),d,c);b.fireEvent("resizestart",b,d)},createResizable:function(q,p,m){var w=m.getTarget(),x=this.scheduler,u=x.getView(),f=!!w.className.match("sch-resizable-handle-start"),n=x.getResourceByEventRecord(p),k=u.getSnapPixelAmount(),j=q.getLeft(),h=q.getRight(),g=q.getWidth(),r=u.getScheduleRegion(n,p),d=x.getDateConstraints(n,p);this.resizable=new Sch.LazyResizable(q,{startLeft:j,startRight:h,dateConstraints:d,resourceRecord:n,eventRecord:p,handles:f?"w":"e",dynamic:true,handleCls:"x-hidden",maxWidth:g+(f?(j-r.left):(r.right-h)),minWidth:k,widthIncrement:k,listeners:{partialresize:{fn:this[f?"partialWestResize":"partialEastResize"],scope:this},resize:{fn:this.afterResize,scope:this}}},f?"west":"east",m);if(this.useTooltip){if(!this.tip){this.tip=new Sch.Tooltip({scheduler:x,cls:"sch-resize-tip",target:Ext.getBody(),renderTo:Ext.getBody()})}var o=p.get("StartDate"),l=p.get("EndDate");this.tip.update(o,l,true);this.tip.targetXY=[m.getPageX(),q.getY()];this.tip.enable().show()}if(Ext.isIE){q.up(".x-grid3-cell-inner").setStyle("z-index",100)}},partialEastResize:function(j,f,d){var g=this.scheduler,e=g.getDateFromX(j.startLeft+Math.min(f,this.resizable.maxWidth),"round");if(!e){return}if(j.dateConstraints){e=Sch.util.Date.constrain(e,j.dateConstraints.start,j.dateConstraints.end)}var k=j.eventRecord.get("StartDate"),h=this.validatorFn.call(this.validatorFnScope||this,j.resourceRecord,j.eventRecord,k,e)!==false;j.end=e;g.fireEvent("partialresize",g,j.eventRecord,k,e,j.el);if(this.useTooltip){this.tip.update(k,e,h)}},partialWestResize:function(h,e,d){var f=this.scheduler,k=f.getDateFromX(h.startRight-e,"round");if(!k){return}if(h.dateConstraints){k=Sch.util.Date.constrain(k,h.dateConstraints.start,h.dateConstraints.end)}var j=h.eventRecord.get("EndDate"),g=this.validatorFn.call(this.validatorFnScope||this,h.resourceRecord,h.eventRecord,k,j)!==false;h.start=k;f.fireEvent("partialresize",f,h.eventRecord,k,j,h.el);if(this.useTooltip){this.tip.update(k,j,g)}},afterResize:function(b,n,j,k){if(this.useTooltip){this.tip.disable()}var m=b.resourceRecord,l=b.eventRecord,f=l.get("StartDate"),o=l.get("EndDate"),c=b.start||f,d=b.end||o,g=this.scheduler;if(c&&d&&(d-c>0)&&((c-f!==0)||(d-o!==0))&&this.validatorFn.call(this.validatorFnScope||this,m,l,c,d,k)!==false){l.beginEdit();l.set("StartDate",c);l.set("EndDate",d);l.endEdit()}else{g.getView().refreshRow(m)}b.destroy();g.fireEvent("afterresize",g,l)},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.ns("Sch");Sch.TimeAxis=Ext.extend(Ext.util.Observable,{continuous:true,autoAdjust:true,constructor:function(b){this.addEvents("reconfigure");this.tickStore=new Ext.data.JsonStore({fields:[{name:"start",type:"date"},{name:"end",type:"date"}]});this.tickStore.on("datachanged",function(){this.fireEvent("reconfigure",this)},this);Ext.apply(this,b);Sch.TimeAxis.superclass.constructor.apply(this,arguments)},reconfigure:function(d){Ext.apply(this,d);var c=this.generateTicks(this.start,this.end,this.unit,this.increment||1,this.mainUnit);this.tickStore.loadData(c)},setTimeSpan:function(e,d){var f=this.generateTicks(e,d);this.tickStore.loadData(f)},getIncrement:function(){return this.increment},filterBy:function(a,d){this.continuous=false;this.tickStore.filterBy(function(c,b){return a.call(d||this,c.data,b)},this)},isContinuous:function(){return this.continuous&&!this.tickStore.isFiltered()},clearFilter:function(){this.tickStore.clearFilter()},generateTicks:function(g,f,l,k){var j=[],h;l=l||this.unit;k=k||this.increment;if(this.autoAdjust){g=this.floorDate(g||this.getStart(),false);f=this.ceilDate(f||Sch.util.Date.add(g,this.mainUnit,this.defaultSpan),false)}while(g<f){h=this.getNext(g,l,k);j.push({start:g,end:h});g=h}return j},getTickFromDate:function(g){if(this.getStart()>g||this.getEnd()<g){return -1}var e=this.tickStore.getRange(),d;for(var h=0,f=e.length;h<f;h++){d=e[h].data.end;if(g<=d){var j=e[h].data.start;return h+(g>j?(g-j)/(d-j):0)}}return -1},getDateFromTick:function(d){var c=this.tickStore.getCount();if(d===c){return this.getEnd()}var e=this.getAt(Math.floor(d));return Sch.util.Date.add(e.start,Sch.util.Date.MILLI,(d-Math.floor(d))*(e.end-e.start))},getAt:function(b){return this.tickStore.getAt(b).data},getCount:function(){return this.tickStore.getCount()},getTicks:function(){var b=[];this.tickStore.each(function(a){b.push(a.data)});return b},getStart:function(){return this.tickStore.getAt(0).data.start.clone()},getEnd:function(){return this.tickStore.getAt(this.tickStore.getCount()-1).data.end.clone()},roundDate:function(C){var A=C.clone(),l=this.getStart(),B=this.resolutionIncrement;switch(this.resolutionUnit){case Sch.util.Date.MILLI:var z=Sch.util.Date.getDurationInMilliseconds(l,A),m=Math.round(z/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.MILLI,m);break;case Sch.util.Date.SECOND:var y=Sch.util.Date.getDurationInSeconds(l,A),v=Math.round(y/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.MILLI,v*1000);break;case Sch.util.Date.MINUTE:var x=Sch.util.Date.getDurationInMinutes(l,A),k=Math.round(x/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.SECOND,k*60);break;case Sch.util.Date.HOUR:var w=Sch.util.Date.getDurationInHours(this.getStart(),A),q=Math.round(w/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.MINUTE,q*60);break;case Sch.util.Date.DAY:var u=Sch.util.Date.getDurationInDays(l,A),n=Math.round(u/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.HOUR,n*24);break;case Sch.util.Date.WEEK:A.clearTime();var t=A.getDay()-this.weekStartDay,D;if(t<0){t=7+t}if(Math.round(t/7)===1){D=7-t}else{D=-t}A=Sch.util.Date.add(A,Sch.util.Date.DAY,D);break;case Sch.util.Date.MONTH:var s=Sch.util.Date.getDurationInMonths(l,A)+(A.getDate()/A.getDaysInMonth()),p=Math.round(s/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.MONTH,p);break;case Sch.util.Date.QUARTER:A.clearTime();A.setDate(1);A=Sch.util.Date.add(A,Sch.util.Date.MONTH,3-(A.getMonth()%3));break;case Sch.util.Date.YEAR:var r=Sch.util.Date.getDurationInYears(l,A),o=Math.round(r/B)*B;A=Sch.util.Date.add(l,Sch.util.Date.YEAR,o);break}return A},floorDate:function(E,C){C=C!==false;var B=E.clone(),m=C?this.getStart():null,D=this.resolutionIncrement;switch(C?this.resolutionUnit:this.mainUnit){case Sch.util.Date.MILLI:if(C){var A=Sch.util.Date.getDurationInMilliseconds(m,B),n=Math.floor(A/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.MILLI,n)}break;case Sch.util.Date.SECOND:if(C){var z=Sch.util.Date.getDurationInSeconds(m,B),x=Math.floor(z/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.MILLI,x*1000)}else{B.setMilliseconds(0)}break;case Sch.util.Date.MINUTE:if(C){var y=Sch.util.Date.getDurationInMinutes(m,B),l=Math.floor(y/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.SECOND,l*60)}else{B.setSeconds(0);B.setMilliseconds(0)}break;case Sch.util.Date.HOUR:if(C){var w=Sch.util.Date.getDurationInHours(this.getStart(),B),r=Math.floor(w/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.MINUTE,r*60)}else{B.setMinutes(0);B.setSeconds(0);B.setMilliseconds(0)}break;case Sch.util.Date.DAY:if(C){var v=Sch.util.Date.getDurationInDays(m,B),o=Math.floor(v/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.HOUR,o*24)}else{B.clearTime()}break;case Sch.util.Date.WEEK:var u=B.getDay();B.clearTime();if(u!==this.weekStartDay){B=Sch.util.Date.add(B,Sch.util.Date.DAY,-(u>this.weekStartDay?(u-this.weekStartDay):(7-u-this.weekStartDay)))}break;case Sch.util.Date.MONTH:if(C){var t=Sch.util.Date.getDurationInMonths(m,B),q=Math.floor(t/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.MONTH,q)}else{B.clearTime();B.setDate(1)}break;case Sch.util.Date.QUARTER:B.clearTime();B.setDate(1);B=Sch.util.Date.add(B,Sch.util.Date.MONTH,-(B.getMonth()%3));break;case Sch.util.Date.YEAR:if(C){var s=Sch.util.Date.getDurationInYears(m,B),p=Math.floor(s/D)*D;B=Sch.util.Date.add(m,Sch.util.Date.YEAR,p)}else{B=new Date(E.getFullYear(),0,1)}break}return B},ceilDate:function(f,e){var k=f.clone();e=e!==false;var j=e?this.resolutionIncrement:1,g=e?this.resolutionUnit:this.mainUnit,h=false;switch(g){case Sch.util.Date.DAY:if(k.getMinutes()>0||k.getSeconds()>0||k.getMilliseconds()>0){h=true}break;case Sch.util.Date.WEEK:k.clearTime();if(k.getDay()!==this.weekStartDay){h=true}break;case Sch.util.Date.MONTH:k.clearTime();if(k.getDate()!==1){h=true}break;case Sch.util.Date.QUARTER:k.clearTime();if(k.getMonth()%3!==0){h=true}break;case Sch.util.Date.YEAR:k.clearTime();if(k.getMonth()!==0&&k.getDate()!==1){h=true}break;default:break}if(h){return this.getNext(k,g,j)}else{return k}},getNext:function(g,f,k){var j=g.clone();k=k||1;switch(f){case Sch.util.Date.DAY:j=Sch.util.Date.add(j,Sch.util.Date.DAY,k);break;case Sch.util.Date.WEEK:var h=j.getDay();j=Sch.util.Date.add(j,Sch.util.Date.DAY,(7*(k-1))+(h<this.weekStartDay?(this.weekStartDay-h):(7-h+this.weekStartDay)));break;case Sch.util.Date.MONTH:j=Sch.util.Date.add(j,Sch.util.Date.MONTH,k);j.setDate(1);break;case Sch.util.Date.QUARTER:j=Sch.util.Date.add(j,Sch.util.Date.MONTH,((k-1)*3)+(3-(j.getMonth()%3)));break;case Sch.util.Date.YEAR:j=new Date(j.getFullYear()+k,0,1);break;default:j=Sch.util.Date.add(g,f,k);break}return j},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(d,c){this.resolutionUnit=d;this.resolutionIncrement=c||1}});Ext.ns("Sch");Sch.TimeColumn=Ext.extend(Ext.grid.Column,{align:"center",menuDisabled:true,hideable:false,resizable:false,sortable:false,headerCls:"",hCls:" sch-timeheader ",dataIndex:"_sch_not_used"});Ext.ns("Sch.plugins");Sch.Tooltip=Ext.extend(Ext.ToolTip,{startText:"Starts: ",endText:"Ends: ",autoHide:true,anchor:"b",padding:"0 3 0 0",trackMouse:true,showDelay:0,hideDelay:0,dismissDelay:0,html:"&nbsp;",mouseOffset:[0,4],constructor:function(b){var a=new Sch.ClockTemplate();this.renderTo=this.target=document.body;if(!this.template){this.template=new Ext.XTemplate('<div class="{[values.valid ? "sch-tip-ok" : "sch-tip-notok"]}">','{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}','{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}',"</div>",{compiled:true,disableFormats:true,renderClock:function(e,d,f){return a.apply({date:e,text:d,cls:f})}})}Sch.Tooltip.superclass.constructor.call(this,b)},update:function(f,e,j){var h=this.scheduler.getFormattedDate(f),g=this.scheduler.getFormattedEndDate(e,f);if(this.mode==="calendar"&&e.getHours()===0&&e.getMinutes()===0&&!(e.getYear()===f.getYear()&&e.getMonth()===f.getMonth()&&e.getDate()===f.getDate())){e=Sch.util.Date.add(e,Sch.util.Date.DAY,-1)}Sch.Tooltip.superclass.update.call(this,this.template.apply({valid:j,startDate:f,startText:h,endText:g,endDate:e}));this.doAutoWidth()},show:function(b){if(Sch.util.Date.compareUnits(this.scheduler.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.el.addClass("sch-day-resolution")}else{this.mode="clock";this.el.removeClass("sch-day-resolution")}Sch.Tooltip.superclass.show.call(this);this.origXY=this.getPositionEl().getXY()},constrainToResource:true,onMouseMove:function(d){var c=this.delegate?d.getTarget(this.delegate):this.triggerElement=true;if(c){this.targetXY=d.getXY();if(c===this.triggerElement){if(!this.hidden&&this.trackMouse){var b=this.getTargetXY();if(this.constrainToResource){this.setPagePosition([b[0],this.origXY[1]])}else{this.setPagePosition(b)}}}else{this.hide();this.lastActive=new Date(0);this.onTargetOver(d)}}else{if(!this.closable&&this.isVisible()){this.hide()}}}});Ext.ns("Sch");Sch.ViewPreset=Ext.extend(Object,{constructor:function(b){return b}});Sch.ViewPresetHeaderRow=Ext.extend(Object,{constructor:function(b){return b}});Ext.ns("Sch");Sch.BasicViewPresets={hourAndDay:{timeColumnWidth:40,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:12,timeResolution:{unit:"MINUTE",increment:15},headerConfig:{middle:{unit:"HOUR",dateFormat:"G:i"},top:{unit:"DAY",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",dateFormat:"D d M"},top:{unit:"WEEK",renderer:function(e,d,f){return"w."+e.format("W M Y")}}}},weekAndDay:{timeColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M",align:"left"}}},weekAndMonth:{timeColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",renderer:function(e,d,f){f.align="left";return e.format("d M")}},top:{unit:"MONTH",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",dateFormat:"M Y"},top:{unit:"YEAR",dateFormat:"Y"}}},year:{timeColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{bottom:{unit:"QUARTER",renderer:function(e,d,f){return String.format("Q{0}",Math.floor(e.getMonth()/3)+1)}},middle:{unit:"YEAR",dateFormat:"Y"}}}};(function(){var b=Sch.PresetManager,c=Sch.BasicViewPresets;for(var d in c){if(c.hasOwnProperty(d)){b.registerPreset(d,c[d])}}})();function schedulerDiagnostics(){var a;if(console&&console.log){a=console.log}else{if(!window.schedulerDebugWin){window.schedulerDebugWin=new Ext.Window({height:400,width:500,bodyStyle:"padding:10px",closeAction:"hide",autoScroll:true})}window.schedulerDebugWin.show();schedulerDebugWin.update("");a=function(b){schedulerDebugWin.update((schedulerDebugWin.body.dom.innerHTML||"")+b+"<br/>")}}var g=Ext.select(".sch-schedulerpanel");if(g.getCount()===0){a("No scheduler component found")}var e=Ext.getCmp(g.elements[0].id),f=e.getResourceStore(),d=e.getEventStore();a("Scheduler view start: "+e.getStart()+", end: "+e.getEnd());if(!e.resourceStore){a("No store configured");return}if(!d){a("No event store configured");return}a(f.getCount()+" records in the resource store");a(d.getCount()+" records in the eventStore");a(Ext.select(e.eventSelector).getCount()+" events present in the DOM");if(d.getCount()>0){if(!d.getAt(0).get("StartDate")||!(d.getAt(0).get("StartDate") instanceof Date)){a("The eventStore reader is misconfigured - The StartDate field is not setup correctly, please investigate");return}if(!d.getAt(0).get("EndDate")||!(d.getAt(0).get("EndDate") instanceof Date)){a("The eventStore reader is misconfigured - The EndDate field is not setup correctly, please investigate");return}if(!d.fields.get("ResourceId")){a("The eventStore reader is misconfigured - The ResourceId field is not present");return}a("Records in the event store:");d.each(function(c,b){a((b+1)+". Start:"+c.get("StartDate")+", End:"+c.get("EndDate")+", ResourceId:"+c.get("ResourceId"))})}else{a("Event store has no data.")}if(f.getCount()>0){a("Records in the resource store:");f.each(function(c,b){a((b+1)+". Id:"+c.get("Id"));return});if(!f.fields.get("Id")){a("The resource store reader is misconfigured - The Id field is not present");return}}else{a("Resource store has no data.");return}a("Everything seems to be setup ok!")}Ext.ns("Sch.util");Sch.util.headerRenderers=function(){var b=new Ext.XTemplate('<table class="sch-nested-hdr-tbl" cellpadding="0" cellspacing="0"><tr><tpl for="."><td class="sch-dayheadercell-{dayOfWeek}">{text}</td></tpl></tr></table>').compile();var a=new Ext.XTemplate('<table class="sch-nested-hdr-tbl" cellpadding="0" cellspacing="0"><tr><tpl for="."><td>{text}</td></tpl></tr></table>').compile();return{quarterMinute:function(e,d,g,f){g.headerCls="sch-timeheader sch-nested-hdr-pad";return'<table class="sch-nested-hdr-tbl" cellpadding="0" cellspacing="0"><tr><td>00</td><td>15</td><td>30</td><td>45</td></tr></table>'},dateCells:function(h,d,c){return function(f,e,k){k.headerCls="sch-timeheader sch-nested-hdr-nopad";var j=[],g=f.clone();while(g<e){j.push({text:g.format(c)});g=Sch.util.Date.add(g,h,d)}return a.apply(j)}},dateNumber:function(f,e,j){j.headerCls="sch-timeheader sch-nested-hdr-nopad";var h=[],g=f.clone();while(g<e){h.push({dayOfWeek:g.getDay(),text:g.getDate()});g=Sch.util.Date.add(g,Sch.util.Date.DAY,1)}return b.apply(h)},dayLetter:function(f,e,j){j.headerCls="sch-timeheader sch-nested-hdr-nopad";var h=[],g=f;while(g<e){h.push({dayOfWeek:g.getDay(),text:Date.dayNames[g.getDay()].substr(0,1)});g=Sch.util.Date.add(g,Sch.util.Date.DAY,1)}return b.apply(h)},dayStartEndHours:function(e,d,f){f.headerCls="sch-timeheader sch-hdr-startend";return String.format('<span class="sch-hdr-start">{0}</span><span class="sch-hdr-end">{1}</span>',e.format("G"),d.format("G"))}}}();Sch.SchedulerPanel.prototype.onRender=Sch.SchedulerPanel.prototype.onRender.createSequence(function(){return});