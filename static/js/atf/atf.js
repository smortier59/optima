function updateBytes(e){e.lengthComputable&&(e.target.curLoad=e.loaded)}function updateSpeed(e){e.curLoad&&(e.prevLoad=e.curLoad)}function updateProgress(e){if(updateBytes(e),e.lengthComputable){var t=e.loaded/e.total;if(1>t){var r=150*t;10>r&&(r=10),e.target.log.style.width=r+"px"}}}function loadError(e){e.target.log.setAttribute("status","error"),e.target.log.parentNode.parentNode.previousSibling.previousSibling.textContent="error",clearTarget(e.target)}function loaded(e){updateBytes(e),e.target.log.style.width="150px",e.target.log.setAttribute("status","loaded"),e.target.log.parentNode.parentNode.previousSibling.previousSibling.textContent="",clearTarget(e.target)}function initXHREventTarget(e,t){var r=document.createElement("div");r.className="progressBarContainer",t.appendChild(r);var n=document.createElement("div");r.appendChild(n),n.className="progressBar",e.log=n,e.interval=setInterval(updateSpeed,1e3,e),e.curLoad=0,e.prevLoad=0,e.onprogress=updateProgress,e.onload=loaded,e.onerror=loadError}var ATF=new Object;ATF.timer_loading=0,ATF.debug=!1,ATF.networkReady=!0,ATF.errors=new Array,ATF.formErrors=new Array,ATF.notices=new Array,ATF.warnings=new Array,ATF.godirect=!1,ATF.previousPage=!1,ATF.currentPage=!1,ATF.changeUrl=!1,ATF.staticserver="",ATF.ongletThreads=new Array,ATF.errorSystemTitle="Système d'erreur AbsysTech",ATF.errorSystemMsg='<b>L\'application vient de provoquer une erreur !</b><br/>Nous allons étudier la cause du problème et le corriger aussi vite que possible. Si vous êtes bloqué merci de contacter le <a href=http://hotline.absystech.net/" target="_blank">support AbsysTech</a> en précisant les circonstances exactes.',ATF.timeoutMsg="<b>Problème de connexion Internet</b><br/>Veuillez vérifier la connexion réseau de votre ordinateur.",ATF.newVersionAlreadyDisplay=!1,ATF.menuLength=null,ATF.formIsActive=!1,ATF.currentpage=Array(),"undefined"!=typeof Ext&&Ext.onReady(function(){Ext.QuickTips.init(),ATF.loadMask=new Ext.LoadMask(Ext.getBody(),{msg:"Please Wait..."}),ATF.deleteLoadMask=new Ext.LoadMask(Ext.getBody(),{msg:"Delete Request.Please Wait..."})}),ATF.createLoadMask=function(e){return new Ext.LoadMask(e,{msg:"Chargement...",removeMask:!0,store:e.store})},ATF.log=function(e){try{console.log(e)}catch(t){1==ATF.debug&&Ext.Msg.alert("Console.log ",e)}},ATF.version=function(){Ext.Msg.alert(ATF.errorSystemTitle,"5 !")},ATF.setJsError=function(e){ATF.loadMask.hide(),ATF.deleteLoadMask.hide(),Ext.Ajax.request({url:"error.ajax",method:"POST",params:{fileName:e.fileName?e.fileName:"NameNotFound",lineNumber:e.lineNumber?e.lineNumber:"LineNotFound",message:e.message?e.message:"ErrorNotFound",name:e.name?e.name:"NameNotFound",url:ATF.currentPage?ATF.currentPage:"UrlNotFound",jsStack:e.stack?e.stack:"JsStackNotFound"}}),ATF.debug&&(ATF.log("Erreur Javascript : "+e.message),ATF.log(e.stack))},ATF.calendar=function(e,t){var r=e.date.getFullYear(),n=e.date.getMonth()+1,a=e.date.getDate();1!=n&&2!=n&&3!=n&&4!=n&&5!=n&&6!=n&&7!=n&&8!=n&&9!=n||(n="0"+n),1!=a&&2!=a&&3!=a&&4!=a&&5!=a&&6!=a&&7!=a&&8!=a&&9!=a||(a="0"+a);var i=r+"-"+n+"-"+a;ATF.tpl2div(t,"date="+i)},ATF.concatAdresse=function(e,t,r,n,a,i){var e=e.value+" "+a.value+" "+i.value+" "+n.value+" "+t.value+" "+r.value;ATF.geocode(e,"societe")},ATF.geocode=function(e,t){ATF.ajax(t+",geocode.ajax","url="+e,{onComplete:function(e){document.getElementById("societe[latitude]").value=e.result.Placemark[0].Point.coordinates[0],document.getElementById("societe[longitude]").value=e.result.Placemark[0].Point.coordinates[1]}})},ATF.tpl2div=function(e,t,r){return ATF.ajax(e,t,r)},ATF.ajax=function(e,t,r){if(!r)var r=new Object;return r.postBody=t,r.onComplete&&(r.onCompleteFinal=r.onComplete),r.onSuccess&&(r.onSuccessFinal=r.onSuccess),r.onSuccess=function(e){try{ATF.networkReady=!0,ATF.bindTips(!0);var t=$.parseJSON(e.responseText);if(r.onCompleteFinal)var n=r.onCompleteFinal(t,e);if(r.onSuccessFinal)var n=r.onSuccessFinal(t,e);if(ATF.ajax_refresh(jQuery.extend(t,r)),n)return n}catch(a){ATF.setJsError(a)}},r.onFailure=function(e,t){if(-1==e.status||0==e.status)ATF.loadMask.hide(),ATF.deleteLoadMask.hide(),-1==e.status&&(ATF.networkReady=!1,Ext.Msg.alert(ATF.errorSystemTitle,ATF.timeoutMsg));else if(ATF.networkReady){var r=new Object;r.message='Maybe Url "'+t.url+'" not exists or request error : '+e.toString(),r.name=e.status,ATF.setJsError(r)}else Ext.Msg.alert(ATF.errorSystemTitle,ATF.timeoutMsg)},r.onException=function(){},Ext.Ajax.request({url:e,method:"POST",success:r.onSuccess,failure:r.onFailure,onException:r.onException,params:t,timeout:12e4})},ATF.TogglePanel=function(e,t){"#"!=e.slice(0,1)&&(e="#"+e);var r=$(e+"_img");ATF.Toggle(e,t,{afterFinish:function(){r.src.match(/arrow_expand_up/)?r.src=ATF.staticserver+"images/icones/arrow_expand_down.png":r.src=ATF.staticserver+"images/icones/arrow_expand_up.png"}})},ATF.ToggleToolBar=function(){$("#toolbar").toggle()},ATF.Toggle=function(e,t){return t||(t={}),t=jQuery.extend({duration:.25,afterFinish:function(){ATF.adjustContainer()}},t),$(e).toggle(t)};var oldShortcutImg;ATF.showContainer=function(e,t,r){var n="selected";t="#"+t,$(t+"_img").hasClass(n)&&$("#panelContainer")&&$("#panelContainer").is(":visible")?($(t+"_img").removeClass(),$("#panelContainer").fadeOut({duration:.3})):($(oldShortcutImg)&&$(oldShortcutImg).hasClass(n)&&$(oldShortcutImg).removeClass(),oldShortcutImg=t+"_img",$(t+"_img").addClass(n),ATF.tpl2div("user,createShorcutContainer.ajax","shortcut=1&tpl="+e,{onComplete:function(){$("#panelContainerTitle").html(r),$("#panelContainer").show({scaleX:!0,scaleY:!1,duration:.3,complete:function(){$(".leftPanelContentContainer").each(function(e,t){$(t).height($("#contentContainer").height())})}})}}))},ATF.BlindLeftToRight=function(e){"none"==$(e).style.display?Effect.BlindDown(e,{scaleX:!0,duration:1.5}):Effect.BlindUp(e,{scaleX:!0,duration:1.5})},ATF.goto_login=function(){try{Modalbox.hide()}catch(e){}window.location.replace("")},ATF.no_session=function(e){if(e){try{Modalbox.show('<div><div id="__loadingBoxTimer" style="display:none">_</div>'+ATF.__redirectBox.content+"</div>",ATF.__redirectBox.params)}catch(t){return ATF.setJsError(t),!1}return setTimeout("ATF.goto_login()",5e3),!0}return!1},ATF.im={getUserList:function(){if(r=Ext.getCmp("panel-IMUserList"))return r;var e=new Ext.data.JsonStore({url:"im,getList.ajax",root:"result.im.online",fields:["id_user","login","user"]});e.load();var t=new Ext.list.ListView({store:e,hideHeaders:!0,multiSelect:!1,emptyText:"Aucun utilisateur connecté",columns:[{width:1,dataIndex:"user",cls:"im-userListView-user"}],listeners:{dblclick:function(e,t){e.store.getAt(t)}}}),r=new Ext.Panel({id:"panel-IMUserList",renderTo:"userListIM",title:"Liste des utilisateurs",hidden:!0,width:200,height:300,items:t});return r},msg:function(e){$("im"),$("im_data");if(e.msg){var t=/\/to=(.[^\/]*)\/(.*)/g,r=t.exec(e.msg);r&&(e.id_user_recipient_login=r[1],e.msg=r[2]);var n=document.createElement("div");e.current_id_user==e.id_user?n.className="selfMessage":n.className="newMessage",e.id_user_recipient_login&&(n.className+=" privateMessage"),n.innerHTML="",e.id_user_recipient_login&&(n.innerHTML+="&gt;&gt;&gt; "+e.id_user_recipient_login+" | "),e.me&&(n.innerHTML+="&gt;&gt;&gt; "),n.innerHTML+="<span class='im_name'>"+e.user+"</span> ",e.me||(n.innerHTML+=": "),n.innerHTML+=e.msg,e.location&&(n.innerHTML+=" ("+e.location+")"),(el=Ext.getCmp("panel-IMchat-dialog"))&&(el.add({xtype:"label",html:"<div class='panel-chat-item'>"+n.innerHTML+"</div>",id:e.id}),el.addClass(n.className),el.doLayout())}e.online},scrollMax:function(){if(e=Ext.getCmp("panel-IMchat-dialog")){var t=(e.el.dom,e.height());e.el.scrollTo("bottom",t,!0)}}},ATF.ajax_refresh=function(e){if(!ATF.no_session(e.nosession)){if(e.alert&&Ext.Msg.alert(ATF.errorSystemTitle,e.alert),e.result){if(e.result.modalbox){Modalbox.show("<div>"+e.result.modalbox.text+"</div>",e.result.modalbox.params)}e.result.im&&ATF.im.msg(e.result.im)}if(e.scrollTop&&scroll(0,0),e.ongletAnchor&&($("#anchorsTabs")&&$("#anchorsTabs").show(),$(e.ongletAnchor)&&$(e.ongletAnchor).show()),e.cadre_refreshed){try{for(var t in e.cadre_refreshed)"function"!=typeof e.cadre_refreshed[t]&&("title"==t?document.title=e.cadre_refreshed[t]:$("#"+t+"_data").length&&t+"_data"!="main_data"?($("#"+t+"_data").css({"min-height":"0px"}),$("#"+t+"_data").html(e.cadre_refreshed[t])):$("#"+t).length&&($("#"+t).css({"min-height":"0px"}),$("#"+t).html(e.cadre_refreshed[t])))}catch(r){ATF.setJsError(r)}ATF.bindListingSelectors(),ATF.initEditors()}if(e.url&&(!e.error||0==e.error.length)&&e.url!=ATF.previousPage){ATF.changeUrl=!0;var n=new RegExp(":","g");e.url.match(n)?ATF.currentPage=e.url.substr(0,e.url.indexOf(":")):ATF.currentPage=e.url,window.location.hash=e.url}if(e.skin&&ATF.loadObjs(e.skin),e.formErrors&&e.formErrors.length>0){ATF.formErrors=e.formErrors;var a=!1,i=!1;e.formErrorConfig&&e.formErrorConfig.highlight&&(a=!0),e.formErrorConfig&&e.formErrorConfig.smartip&&(i=!0),ATF.showFormErrors(a,i)}e.error&&e.error.length>0?(ATF.errors=e.error,e.notice=null,e.warning=null,ATF.previousPage&&ATF.previousPage!=ATF.currentPage&&(ATF.changeUrl=!0,window.location.hash=ATF.previousPage),ATF.showError()):(ATF.previousPage=ATF.currentPage,e.notice&&ATF.showNotice(e.notice),e.warning&&ATF.showWarning(e.warning)),!ATF.newVersionAlreadyDisplay&&e.newVersion&&(ATF.newVersionAlreadyDisplay=!0,setTimeout("Modalbox.show('new_version.dialog', { scrollTo:0, width: 700, title: 'Nouvelle Version' })",2e3)),setTimeout("ATF.adjustContainer();",1e3),setTimeout("ATF.renderProgressBars();",1e3)}},ATF.ajaxCompleter=function(e,t,r){ATF.ajax(e,t,{onSuccess:function(e){$(r).update($(r).innerHTML+e.responseText),ATF.adjustContainer()}})},ATF.listing_mapping=new Object({listing_0:"listing_0_selected",listing_1:"listing_1_selected",listing_0_selected:"listing_0",listing_1_selected:"listing_1"}),ATF.bindListingSelectors=function(){$("tr.listing_0","tr.listing_1").each(function(e){e.onclick=function(){this.className=ATF.trim11(this.className),$("input.check_select_row[value="+this.id+"]").each(function(e){e.checked=!e.checked,ATF.updSelTR(e)})}}),$("input.check_select_row[value]").each(function(e){e.onclick=function(){this.checked=!this.checked}})},ATF.updSel=function(e,t,r){$("table.listing_table_"+e+" input."+(r?r:"check_select_row")).each(function(e){switch(t){case"all":e.checked=!0;break;case"no":e.checked=!1;break;default:e.checked=!e.checked}r||ATF.updSelTR(e)})},ATF.updSelTR=function(e){-1===$w(e.up().up().className).indexOf("listing_1")&&-1===$w(e.up().up().className).indexOf("listing_1_selected")?(e.up().up().removeClassName("listing_0"),e.up().up().removeClassName("listing_0_selected"),e.checked?e.up().up().addClassName("listing_1_selected"):e.up().up().addClassName("listing_1")):(e.up().up().removeClassName("listing_1"),e.up().up().removeClassName("listing_1_selected"),e.checked?e.up().up().addClassName("listing_0_selected"):e.up().up().addClassName("listing_0"))},ATF.trim11=function(e){e=e.replace(/^\s+/,"");for(var t=e.length-1;t>=0;t--)if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}return e},ATF.getListingSelected=function(e,t){var r=[],n=[];return $("table.listing_table_"+e+" > tbody > tr > td > input.check_select_row").each(function(e){e.checked?r.push(e.value):n.push(e.value)}),r.length>0&&!t?"id[]="+r.join("&id[]="):r.length>0?"id["+r.join("]=1&id[")+"]=1":t?"id["+n.join("]=1&id[")+"]=1":void 0},ATF.bindTips=function(e){},ATF.noticebox=function(){function e(e,t){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',e,"</h3>",t,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")}var t;return{msg:function(r,n,a){t||(t=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},!0)),t.alignTo(document,"t-t");var i=String.format.apply(String,Array.prototype.slice.call(arguments,1)),o=Ext.DomHelper.append(t,{html:e(r,i)},!0);o.slideIn("t").pause(Number(a)).ghost("t",{remove:!0}),o.dom.onclick=function(){o.remove()}},init:function(){var e=Ext.get("lib-bar");e&&e.show()}}}(),ATF.showNotice=function(e){if(e&&(ATF.notices=e),ATF.notices&&ATF.notices.length>0){var t=ATF.notices.shift();new Array;t.timer||(t.timer=3.5),ATF.noticebox.msg(t.title,t.msg,t.timer),ATF.notices.length>0&&ATF.showNotice()}},ATF.showWarning=function(e){if(e&&(ATF.warnings=e),ATF.warnings&&ATF.warnings.length>0){var t=ATF.warnings.shift();new Array;t.title||(t.title="Attention"),t.timer||(t.timer=5),ATF.noticebox.msg('<span style="color:red">'+t.title+"</span>",'<span style="color:red">'+t.msg+"</span>",t.timer),ATF.warnings.length>0&&ATF.showWarning()}},ATF.showError=function(){if(ATF.errors&&ATF.errors.length>0){var e=ATF.errors.shift(),t=new Array;e.msg.text||(e.msg.text=e.msg),e.msg&&(t[0]='<div style="color:red;font-weight:bold;">'+e.msg.text+"</div>",t[1]||(t[1]=new Object),t[1]=e.msg.params),ATF.errors.length>0?t[1].beforeHide=function(){return ATF.showError(),!1}:t[1].beforeHide=function(){return ATF.showNotice(),ATF.showWarning(),!1},ATF.log(ATF.errors),ATF.log(t),Modalbox.show(t[0],t[1])}},ATF.showFormErrors=function(e,t){return},ATF.panneau_lateral=function(e){"none"==$(e).style.display?new ATF.tpl2div("tpl2div.ajax","div="+$(e).id+"&template=left",{onSuccess:function(){Effect.toggle(e,"appear",{scaleX:!0,scaleY:!1,duration:.3})}}):Effect.toggle(e,"appear",{scaleX:!0,scaleY:!1,duration:.3})},ATF.__toLocation=function(e){window.location=e},ATF.keepOnline=function(){"undefined"!=typeof Ext?Ext.Ajax.request({url:"usr,keepOnline.ajax"}):$.ajax({url:"usr,keepOnline.ajax"}),setTimeout("ATF.keepOnline();",3e5)},ATF.include=function(e){document.getElementsByTagName&&(Script=document.createElement("script"),Script.type="text/javascript",Script.src=e,Body=document.getElementsByTagName("BODY"),Body&&Body[0].appendChild(Script))},ATF.sendmail=function(e,t,r,n){var a=new Ext.FormPanel({frame:!0,width:690,height:470,items:[{xtype:"textfield",fieldLabel:"To",name:"to",id:"to",value:t},{xtype:"textfield",fieldLabel:"Sujet",id:"sujet",name:"sujet",value:r},{xtype:"textarea",fieldLabel:"Message",id:"message",name:"message",anchor:"100%",height:350,value:n}],buttons:[{text:"Envoyer",handler:function(){ATF.ajax(e+",sendMailEXT.ajax",{msg:Ext.getCmp("message").getValue(),to:Ext.getCmp("to").getValue(),subject:Ext.getCmp("sujet").getValue()},{onComplete:function(){ATF.currentWindow.close(),Ext.Msg.alert("","Le(s) mail(s) a(ont) bien(s) été(s) envoyé(s)")}})}}]});ATF.currentWindow=new Ext.Window({title:'{ATF::$usr->trans("Envoi de mails")}',id:"mywindow",width:700,height:500,buttonAlign:"center",autoScroll:!1,closable:!0,items:[a]}).show()},ATF.update=function(e,t,r){ATF.hideAllEditors();var n=$(e);if(ATF.speedmail)for(var a in ATF.speedmail.instances)ATF.speedmail.instances[a]();t||(t=new Object),t.onComplete||(t.onComplete=function(e){ATF.speedmail=void 0,ATF.ajax_refresh(e)}),r||(r=n.name+".ajax"),new ATF.ajax(r,n.serialize(),t)},ATF.cloner=ATF.insert=function(e,t,r,n){ATF.hideAllEditors();var a=$(e);t||(t=new Object),t.onComplete||(t.onComplete=function(e){ATF.ajax_refresh(e)}),r||(r=a.name+".ajax"),n?new ATF.ajax(r,"nocr=true&speed_insert=true&"+a.serialize(),t):new ATF.ajax(r,a.serialize(),t)},ATF.deletor=function(e,t,r){var n="id_"+e+"="+t;r&&(n+="&"+r),new ATF.ajax(e+",delete.ajax",n,{onComplete:function(e){ATF.ajax_refresh(e)}})},ATF.countdownTimer=function(e){this.ms=e,this.tp=0},ATF.countdownTimer.prototype.start=function(e){this.tp>0&&this.reset(),this.tp=window.setTimeout(e,this.ms)},ATF.countdownTimer.prototype.reset=function(){this.tp>0&&window.clearTimeout(this.tp),this.tp=0},ATF.showPaging=function(e){ATF.timer(e.id,1,function(){var t=0;$("#"+e.id+" > div.retractable").each(function(e){e.id||($(e).css({width:e.width()+"px",height:e.height()+"px"}),e.id=this.id+"_zut"+ ++t),e.visible()||Effect.Grow(e.id,{duration:.3})}.bind(e))}.bind(e))},ATF.hidePaging=function(e){ATF.timer(e.id,1,function(){$("#"+e.id+" > div.retractable").each(function(e){$(e.id)&&Effect.Shrink(e.id,{duration:.3})}.bind(e))}.bind(e))},ATF.timer=function(e,t,r){e=$(e),e&&(ATF.timers||(ATF.timers=new Object),ATF.timers[e.id]&&ATF.timers[e.id].cancel(),ATF.timers[e.id]=new Effect.Opacity(e.id,{duration:t,from:$(e.id).getStyle("opacity"),to:$(e.id).getStyle("opacity"),afterFinish:r}))},ATF.updWaitMsg="",ATF.updWait=function(e,t,r){t=ATF.updWaitMsg+t+"</div>";var n=$(e);n&&(n.css("min-height:"+n.height()+"px"),r?new Effect.Opacity(e,{from:1,to:0,duration:.5,afterFinish:function(){n.update(t),n.setOpacity(1),r&&r()}}):n.update(t))},ATF.start=function(e,t){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){xhr=new XMLHttpRequest}var n=$("#filename_upload");n.textContent=e.fileName,n.className="filename",initXHREventTarget(xhr.upload,n);var a=$("#tbody");a.appendChild(n),a.style.display="",$("#secondary")&&$("#secondary").css({padding:parseFloat($("#slipContainer").height())+parseFloat(55)+"px 0px 0px 0px"}),$(".slipContentContainer").each(function(e){$(e).css({height:10+$("#slipContainer").height()+"px"})}),xhr.open("POST",t+",upload_fichier.ajax"),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");var i="table="+t+"&filename="+e.fileName+"&content="+e.getAsBinary();xhr.send(i)},ATF.startXHR=function(e){var t=$("#file").files;if(t){var r=t.item(0);if(r&&r.fileSize)return r.fileSize>26214400?void alert("Le fichier est trop gros: "+r.fileName+", "+Number(r.fileSize/m).toFixed(1)+"Mo"):void ATF.start(r,e)}alert("Rien à uploader !")},ATF.verif_horaire=function(e,t,r){tab=$(e).value.split(":");var n=new Date(2e3,1,1,tab[0],tab[1],0,0),a=n.getHours();return $(e).value.match("^([0-9]|[0-1][0-9]|2[0-4]):[0-5][0-9]$")?0>a||a>24?(alert("La valeur doit être comprise entre 0:00 et 24:00 heures"),$(e).value="0:00",!1):(t&&ATF.pointage.change_color_case_horaire(e,t,r),!0):(alert("Le temps inscrit n'est pas correctement formaté"),$(e).value="0:00",!1)},ATF.adjustContainer=function(){$(".slipContentContainer").each(function(e,t){$(t).css({height:10+$("#slipContainer").height()+"px"})})},ATF.number_format=function(e,t,r,n,a,i,o,s){a||(a=""),i||(i=""),o||(o=""),s||(s="");var l=Math.round(e*Math.pow(10,t));l>=0&&(o=s="");var d=(""+Math.abs(l)).split(""),c=d.length-t;0>c&&c--;for(var u=c;0>u;u++)d.unshift("0");for(d.splice(c,0,n),d[0]==n&&d.unshift("0");c>3;)c-=3,d.splice(c,0,r);var m=a+o+d.join("")+s+i;return m},ATF.progressBar=function(e,t,r,n,a,i,o){if(ATF.bar||(ATF.bar=Array()),ATF.bar[e]=new Ext.ProgressBar({text:r?r:"0%",id:"bar-"+e,height:20,width:i?i:"120",ctCls:"ctProgress",baseCls:t?t:"x-progress",per:n?n:0}),n&&ATF.bar[e].updateProgress(n/100,r?r:n+"%"),a&&!r){barUpdate=function(e,t,r){r?e.per<100&&(e.per=parseInt(t)+parseInt(e.per),e.updateProgress(e.per/100,e.per+"%")):e.per>0&&(e.per=parseInt(e.per)-parseInt(t),e.updateProgress(e.per/100,e.per+"%")),o&&o(e.per)},$("#plus-"+e).observe("click",function(){barUpdate(ATF.bar[e],10,!0)}),$("#moins-"+e).observe("click",function(){barUpdate(ATF.bar[e],10,!1)})}},ATF.renderProgressBars=function(){if(ATF.bar)for(i in ATF.bar)if($(i))try{ATF.bar[i].rendered||ATF.bar[i].render(i)}catch(e){}},ATF.editorSettings={simpleEditor:{mode:"none",language:"fr",theme:"advanced",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,undo,redo,|,cleanup,|,bullist,numlist",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0},inventaireEditor:{mode:"none",language:"fr",theme:"advanced",theme_advanced_buttons1:"bold,italic,underline,|,undo,redo,|,cleanup,|,bullist,numlist",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0},fullEditor:{mode:"none",language:"fr",theme:"advanced",plugins:"pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave",theme_advanced_buttons1:"save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect",theme_advanced_buttons2:"cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",theme_advanced_buttons3:"tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",theme_advanced_buttons4:"insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0,content_css:"css/content.css",template_external_list_url:"lists/template_list.js",external_link_list_url:"lists/link_list.js",external_image_list_url:"lists/image_list.js",media_external_list_url:"lists/media_list.js",style_formats:[{title:"Bold text",inline:"b"},{title:"Red text",inline:"span",styles:{color:"#ff0000"}},{title:"Red header",block:"h1",styles:{color:"#ff0000"}},{title:"Example 1",inline:"span",classes:"example1"},{title:"Example 2",inline:"span",classes:"example2"},{title:"Table styles"},{title:"Table row 1",selector:"tr",classes:"tablerow1"}],template_replace_values:{username:"Some User",staffid:"991234"}}},ATF.editors=new Object,ATF.initEditors=function(){},ATF.hideAllEditors=function(){for(var e in ATF.editors)tinyMCE.execCommand("mceRemoveControl",!1,e),delete ATF.editors[e]},ATF.autocompleteConfig=function(e){var t={store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:e.url,method:"POST",listeners:{exception:function(e,t,r,n,a){ATF.extRefresh({response:a})}}}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCount"},e.mapping)}),loadingText:e.loadingText,width:e.width?e.width:300,noClearOnTrigger:e.noClearOnTrigger,onTriggerClick:function(){this.noClearOnTrigger||(this.clearValue(),$(this.id.replace("label_",""))&&($(this.id.replace("label_","")).value=null)),this.readOnly||this.disabled||(this.isExpanded()?(this.collapse(),this.el.focus()):(this.onFocus({}),"all"==this.triggerAction?this.doQuery(this.allQuery,!0):this.doQuery(this.getRawValue()),this.el.focus()))},pageSize:10,minChars:0,tpl:new Ext.XTemplate(e.template),itemSelector:"div.search-item"};return e.onSelect&&(t.onSelect=e.onSelect),e.applyTo&&(t.applyTo=e.applyTo),t},ATF.autocomplete=function(e,t){var r=this.autocompleteConfig(e);return t&&(r=jQuery.extend(r,t)),new Ext.form.ComboBox(r)},ATF.datefield=function(e,t,r){return r?new Ext.form.DateField({width:120,applyTo:e,format:t,listeners:{change:r}}):new Ext.form.DateField({width:120,applyTo:e,format:t})},ATF.dateTimeField=function(e,t,r){new Ext.form.CompositeField({renderTo:e+"_bis",items:[{xtype:"datefield",listeners:{change:function(){$(e).value=$(e+"_date").value+" "+$(e+"_time").value}},format:"d-m-Y",width:100,name:e+"_date",id:e+"_date",value:t},{xtype:"timefield",name:e+"_time",id:e+"_time",format:"H:i",minValue:"9:00",maxValue:"18:00",increment:30,width:65,value:r,listeners:{change:function(){$(e).value=$(e+"_date").value+" "+$(e+"_time").value}}}]})},"undefined"!=typeof Ext&&Ext.onReady(function(){Ext.form.DateField&&Ext.apply(Ext.form.DateField.prototype,{initComponent:function(){this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger"},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-date-trigger"}]},Ext.form.DateField.superclass.initComponent.apply(this,arguments)},onTrigger1Click:function(){this.setValue(""),this.fireEvent("select",[this,null])},getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,onTrigger2Click:Ext.form.DateField.prototype.onTriggerClick,trigger1Class:Ext.form.DateField.prototype.triggerClass,trigger2Class:Ext.form.DateField.prototype.triggerClass})}),ATF.verifMail=function(e){valide1=!1;for(var t=1;t<e.value.length;t++)if("@"==e.value.charAt(t)&&t<e.value.length-4)for(var r=t;r<e.value.length-2;r++)"."==e.value.charAt(r)&&(valide1=!0);return valide1};var reinit_temps=new ATF.countdownTimer(1500);ATF.__submitSearchChampsSelectAll=function(e,t,r){reinit_temps.start("$('__res_"+r+"_"+t+"_loading').show(); ATF.__callSearchChampsSelectAll('"+e+"','"+t+"','"+r+"');")},ATF.__callSearchChampsSelectAll=function(e,t,r){ATF.ajax(e+",update.ajax","nocr=true&id_"+e+"="+t+"&"+r+"="+$(e+"["+r+"_"+t+"]").value,{onComplete:function(){$("__res_"+r+"_"+t+"_loading").hide()}})},ATF.clickOnglet=function(e,t,r,n,a){if($(r+"_content")){var i=$(r+"_content").visible();ATF.ajax(e+",saveOuvertureOnglet.ajax","onglet=gsa_"+t+"_"+e+"&showorhide="+i),i?ATF.godirect||ATF.closeOnglet(e,r):ATF.openOnglet(e,r,t,n,a),ATF.godirect=!1}},ATF.openOnglet=function(e,t,r,n,a){$(e+"_switch2")&&$(e+"_switch2").hide(),$(t+"_content")&&($(t+"_no_content")?(Effect.toggle(t+"_content","blind",{duration:.5}),ATF.updWait(t+"_content","Merci de patienter, le contenu de l'onget va s'afficher dans un instant..."),ATF.tpl2div(e+",updateSelectAll.div","pager="+t+"&parent_class="+r+"&function=&fk_name="+n+"&fk_value="+a)):Effect.toggle(t+"_content","blind",{duration:.5}));var i=Array(t+"_pager",t+"_pagerSearch",t+"_pagerFilter",t+"_pagerColumn",t+"_pagerExport",t+"_pagerGeoloc",t+"_checkedSelectionDown",t+"_pagerSort");i.each(function(e){$(e)&&!$(e).visible()&&Effect.Appear(e,{duration:.5})})},ATF.closeOnglet=function(e,t){$(t+"_content")&&Effect.toggle(t+"_content","blind",{duration:.5}),$(e+"_switch2")&&$(e+"_switch2").show();var r=Array(t+"_pager",t+"_pagerSearch",t+"_pagerFilter",t+"_pagerColumn",t+"_pagerExport",t+"_pagerGeoloc",t+"_checkedSelectionDown",t+"_pagerSort");r.each(function(e){$(e)&&$(e).visible()&&Effect.Fade(e,{duration:.5})})},ATF.createOnglet=function(e,t,r,n,a,i,o,s,l){l||(l=0),ATF.ongletThreads.push(ATF.tpl2div(r+",onglet.ajax","template=generic-onglet&div=onglet_"+r+"_content&parent_name="+e+"&id="+t+"&opened="+n+"&field="+a+"&table="+i+"&function="+o+"&select="+s+"&permapdf="+l,{ongletAnchor:"anchor_"+i}))},ATF.addOnglet=function(e,t,r,n){ATF.loadMask.show(),ATF.tpl2div(e+",save_onglet.div","table="+e+"&id_"+e+"="+r+"&ongletInsert="+n,{onComplete:function(){ATF.loadMask.hide()}})},ATF.rmOnglet=function(e,t,r){ATF.loadMask.show(),ATF.tpl2div(e+",save_onglet.div","table="+e+"&id_"+e+"="+r+"&ongletDelete="+t,{onComplete:function(){ATF.loadMask.hide()}})},ATF.goToOnglet=function(e){$(e+"_switch2").length&&"none"!=$(e+"_switch2").getStyle("display")?$("#onglet_"+e)&&(ATF.godirect=!0,window.scroll(0,$("#onglet_"+e)[0].offsetTop),$(e+"_switch").onclick()):$("#onglet_"+e)[0]&&window.scroll(0,$("#onglet_"+e)[0].offsetTop)},ATF.updateHtmlOptions=function(e,t,r,n){if(!r)throw"Paramètre optionId manquant !";if(!$(r))throw"'infos.optionId' N'est pas un élément DOM !";ATF.ajax(e,t,{onComplete:function(e){for(var t=$(r);t.length>0;)t.remove(t.length-1);if(n){var a=document.createElement("option");a.text=n,a.value="";try{t.add(a,null)}catch(i){t.add(a)}}if(e.result)for(var o=0;o<e.result.length;o++){var a=document.createElement("option");a.text=e.result[o].text,a.value=e.result[o].value,e.result[o].selected&&(t.selectedIndex=o);try{t.add(a,null)}catch(i){t.add(a)}}}})},ATF.conv=function(e){return function(t,r){return r[e]}},ATF.extParseFields=function(e){for(var t in e)e[t].convert&&(e[t].convert=ATF.conv(e[t].convert));return e},ATF.permalink=function(e,t){Ext.Msg.prompt("Envoyer cette fiche en lien direct","Merci de noter une adresse email",function(r,n){"ok"==r&&ATF.ajax(e+",sendPermalink.ajax","id="+t+"&email="+n)})},ATF.preventUnload=function(){window.onbeforeunload=function(){return""}},ATF.unPreventUnload=function(){window.onbeforeunload=null},ATF.setFormIsActive=function(){ATF.preventUnload(),ATF.formIsActive=!0},ATF.unsetFormIsActive=function(){ATF.unPreventUnload(),ATF.formIsActive=!1},ATF.extRefresh=function(e,t){t&&(e=t);var r=Ext.util.JSON.decode(e.response.responseText);if(ATF.ajax_refresh(r),(!r.error||!r.error.length)&&r.extTpl)for(var n in r.extTpl)Ext.ComponentMgr.get(n).removeAll(),Ext.ComponentMgr.get(n).add(Ext.util.JSON.decode(r.extTpl[n])),Ext.ComponentMgr.get(n).doLayout(!0)},"undefined"!=typeof Ext&&Ext.grid&&Ext.grid.EditorGridPanel&&(Ext.ux.FormGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{hiddenValue:null,onRender:function(){Ext.ux.FormGridPanel.superclass.onRender.apply(this,arguments),this.on("afteredit",this.refreshHiddenValues)},refreshHiddenValues:function(){var e=this.getStore();if(this.hiddenValue&&e){for(var t=new Array,r=e.getRange(),n=0;n<r.length;n++)t.push(r[n].data);this.hiddenValue.setValue(Ext.encode(t))}}})),ATF.buildGridEditor=function(e){var t=new Ext.ux.FormGridPanel(jQuery.extend({autoHeight:!0,autoWidth:!0,layout:"fit",trackMouseOver:!0,disableSelection:!0,loadMask:!0},e));return e.renderTo&&t.render(e.renderTo),t.store&&(t.store.on("load",t.refreshHiddenValues,t),t.store.load({params:{start:0,limit:30}})),t.hiddenValue=new Ext.form.Hidden({xtype:"hidden",name:"values_"+t.id,id:"values_"+t.id,value:""}),[t,t.hiddenValue]},ATF.formatNumeric=function(e){e=Math.round(100*(e-0))/100,e=e==Math.floor(e)?e+".00":10*e==Math.floor(10*e)?e+"0":e,e=String(e);for(var t=e.split("."),r=t[0],n=t[1]?"."+t[1]:".00",a=/(\d+)(\d{3})/;a.test(r);)r=r.replace(a,"$1 $2");return e=r+n},ATF.extJSGridComboboxSeparator="|#ref=",ATF.goTo=function(e){var t=new RegExp(":","g");e.match(t)&&(window.location.hash.match(t)?e=window.location.hash.substr(0,window.location.hash.indexOf(":"))+e:e&&(e=window.location.hash?window.location.hash+e:"#"+window.location.pathname.substr(1)+e),e=e.substr(1)),window.location.hash&&window.location.hash.substr(1)==e?ATF.loadUrl(window.location.hash.substr(1)):Ext.History.add(e)},ATF.loadUrl=function(e){var t="",r="",n=new RegExp(":","g");if(e.match(n)){var a=e.substr(e.indexOf(":")+1);r=e.substr(0,e.indexOf(":")),n=new RegExp("select","g"),r.match(n)?ATF.previousPage==r?ATF.goToOnglet(a):(ATF.currentPage=r,ATF.loadMask.show(),ATF.tpl2div(r.substr(0,r.length-5)+".div",null,{onComplete:function(){ATF.loadMask.hide(),setTimeout("ATF.goToOnglet('"+a+"')",3e3)}})):Ext.Msg.alert(ATF.errorSystemTitle,ATF.errorSystemMsg+"L'url n'est pas valide.</div>",function(e){"ok"==e&&Ext.History.back()},{minWidth:300})}else{if(ATF.loadMask.lastXHR&&ATF.loadMask.lastXHR.conn&&ATF.loadMask.lastXHR.conn.abort(),ATF.ongletThreads){for(key in ATF.ongletThreads)ATF.ongletThreads[key]&&ATF.ongletThreads[key].conn&&ATF.ongletThreads[key].conn.abort();ATF.ongletThreads=new Array}ATF.currentPage=e,n=new RegExp(",","g"),e.match(n)?(t=e.substr(e.indexOf(",")+1),r=e.substr(0,e.indexOf(",")-5)):r=e.substr(0,e.length-5),ATF.previousPage==r+".html"?ATF.goToOnglet(a):(ATF.loadMask.show(),ATF.loadMask.lastXHR=ATF.tpl2div(r+".div",t,{onComplete:function(){if(ATF.loadMask.hide(),scroll(0,0),ATF.highlightMenuItem){var e=new RegExp("-","g");r.match(e)?ATF.highlightMenuItem(r.substr(0,r.indexOf("-"))):ATF.highlightMenuItem(r)}}}))}},ATF.loadObjs=function(){if(document.getElementById)for(i=0;i<arguments.length;i++){var e=arguments[i],t="";-1!=e.indexOf(".js")?(t=document.createElement("script"),t.setAttribute("type","text/javascript"),t.setAttribute("src",e)):-1!=e.indexOf(".css")&&(t=document.createElement("link"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)),""!=t&&document.getElementsByTagName("head").item(0).appendChild(t)}},"undefined"!=typeof Ext&&Ext.onReady(function(){Ext.form.TwinTriggerField&&(Ext.ns("Ext.ux.form"),
Ext.ux.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.ux.form.SearchField.superclass.initComponent.call(this),this.on("specialkey",function(e,t){t.getKey()==t.ENTER&&this.onTrigger2Click()},this),this.on("afterrender",function(){this.value&&(this.triggers[0].show(),this.hasSearch=!0)},this)},validationEvent:!1,validateOnBlur:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:!0,width:180,hasSearch:!1,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var e={start:0};this.store.baseParams=this.store.baseParams||{},this.store.baseParams[this.paramName]="",this.store.reload({params:e}),this.triggers[0].hide(),this.hasSearch=!1}},onTrigger2Click:function(){var e=this.getRawValue();if(e.length<1)return void this.onTrigger1Click();var t={start:0};this.store.baseParams=this.store.baseParams||{},this.store.baseParams[this.paramName]=e,this.store.reload({params:t}),this.hasSearch=!0,this.triggers[0].show()}}))}),ATF.blank_png="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkJENDZGRjg0N0ZBNDExRTA5Qjk3OTI5RTBDOEI2ODg1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkJENDZGRjg1N0ZBNDExRTA5Qjk3OTI5RTBDOEI2ODg1Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QkQ0NkZGODI3RkE0MTFFMDlCOTc5MjlFMEM4QjY4ODUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QkQ0NkZGODM3RkE0MTFFMDlCOTc5MjlFMEM4QjY4ODUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6Rfc00AAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg==",ATF.render=function(e,t,r,n){return ATF.renderer[e]?ATF.renderer[e](t,r,n):ATF.renderer.searchHighlight},ATF.renderer={},ATF.renderer.searchHighlight=function(e,t,r,n,a,i){if(e){e=String(e),e=e.replace(new RegExp("\\n","g"),"<br />").replace(new RegExp("\\r","g"),""),e=e.replace(new RegExp("&lt;!--.*--&gt;","g"),""),e=e.replace(new RegExp("<xml>.*</xml>","g"),""),e=e.replace(new RegExp("<style>.*</style>","g"),""),e=e.replace(new RegExp("<br />","g"),"\n").replace(new RegExp("<br>","g"),"\n"),e=e.replace(new RegExp("\\n\\n","g"),"\n"),e=Ext.util.Format.stripTags(Ext.util.Format.stripScripts(e)),e=e.replace(new RegExp("\\n","g"),"<br />");var o=i.searchBox.getValue();return o?e.replace(new RegExp("("+o+")","i"),'<span class="searchSelectionFound">$1</span>'):e}},ATF.renderer.actions=function(e,t,r,n){return function(a,i,o){if(a)return a;var s=o.data[e+"__dot__id_"+e];if(!s)var s=o.data[e+"__dot__id_"+e];return html="",t||(html+='<a href="#'+e+"-select-"+s+'.html"><img class="smallIcon select" src="'+ATF.blank_png+'" /></a>'),r||(n?html+=' <a href="#'+e+"-select-"+s+'.html,edit=1"><img class="smallIcon update" src="'+ATF.blank_png+'" /></a>':html+=' <a href="#'+e+"-update-"+s+'.html"><img class="smallIcon update" src="'+ATF.blank_png+'" /></a>'),html}},ATF.renderer.foreignKey=function(e,t,r){return function(n,a,i){return n?(id=i.data[e+"__dot__"+t+"_fk"],id||(id=i.data[e+"__dot__"+t]),'<a href="#'+r+"-select-"+id+'.html">'+n+"</a>"):void 0}},ATF.renderer.file=function(e,t){return function(r,n,a){return a.json?(id=a.data[e+"__dot__id_"+e],ATF.is_object(r)&&1==r.force_generate&&r.fonction?'<a href="'+r.fonction+"-"+id+'.pdf" alt="'+ATF.usr.trans("popup_download",e)+'" target="_blank"><img class="smallIcon pdf" src="'+ATF.blank_png+'" class="icone" /></a>':r?'<a href="'+e+"-select-"+t+"-"+id+'.dl" alt="'+ATF.usr.trans("popup_download",e)+'"><img class="smallIcon '+r+'" src="'+ATF.blank_png+'" class="icone" /></a>':'<img class="smallIcon noAction" src="'+ATF.blank_png+'" />'):void 0}},ATF.renderer._datefield=function(e,t,r,n,a,i){return e?"0000-00-00"==e||e.length<1?"":e.length>10?(e=Date.parseDate(e,"Y-m-d H:i:s"),Ext.util.Format.dateRenderer("d/m/Y H\\hi")(e,t,r,n,a,i)):e.match(new RegExp("[:]","g"))?(e=Date.parseDate(e,"H:i:s"),Ext.util.Format.dateRenderer("H\\hi's''")(e,t,r,n,a,i)):(e=Date.parseDate(e,"Y-m-d"),Ext.util.Format.dateRenderer("d/m/Y")(e,t,r,n,a,i)):void 0},ATF.renderer.datefield=function(){return ATF.renderer._datefield},ATF.renderer.temps=function(){return function(e){if(e){var t=Math.round(60*(100*e%100)/100);0==t?t="00":10>t&&(t="0"+t),e=Math.floor(e);var r;return e>=7&&(j=Math.floor(e/7),e%=7,r=j+"j "+e+"h"+t),r?r:e+"h"+t}}},ATF.renderer.tel=function(){return function(e,t,r,n,a){if(e){var i=r.fields.items[a-1].name.split("__dot__"),o=r.data[i[0]+"__dot__id_"+i[0]];return 10==e.length&&(e=e.substr(0,2)+" "+e.substr(2,2)+" "+e.substr(4,2)+" "+e.substr(6,2)+" "+e.substr(8,2)),"<a onclick=\"ATF.tpl2div('asterisk,createCall.ajax','id="+o+"&amp;table="+i[0]+"&amp;field="+i[0]+"."+i[1]+'\');" href="javascript:;"><img class="smallIcon call" src="'+ATF.blank_png+'" /></a>&nbsp;'+e}}},ATF.renderer.url=function(){return function(e,t,r,n,a){if(e){var i=r.fields.items[a-1].name.split("__dot__");r.data[i[0]+"__dot__id_"+i[0]];return'<a href="'+e+'" target="_blank"><img class="smallIcon url" src="'+ATF.blank_png+'" /></a>&nbsp;'+e}}},ATF.renderer.email=function(){return function(e){return e?'<a href="mailto:'+e+'" class="email"><img class="smallIcon email" src="'+ATF.blank_png+'" /></a>&nbsp;<a href="mailto:'+e+'" class="email">'+e+"</a>":void 0}},ATF.renderer.priorite=function(){return function(e,t,r){function n(e,t){return"oui"==t&&(e="MEP_prevue"),ATF.usr.trans(e,"hotline")}function a(e,t,r){if("oui"==r)return"green";switch(e){case"free":return"red";case"annulee":return"grey";default:return 10>t?"green":15>t?"orange":"red"}return"grey"}function i(e,t){switch(e){case"fixing":case"wait":return 20+.6*t;case"done":return 90;case"payee":return 100;case"annulee":return 100}return 0}if(e>=0){var o=r.data.hotline__dot__etat,s=r.data.hotline__dot__avancement,l=r.data.hotline__dot__wait_mep,d=e+"/"+n(o,l),c=i(o,s),u=a(o,e,l),c=parseFloat(i(o,s)/100),m=Ext.id();return function(){var e={renderTo:m,value:c,text:d,ctCls:u+"Bar"};if($(m)){new Ext.ProgressBar(e)}}.defer(25),'<span id="'+m+'"></span>'}}},ATF.renderer.ponderation=function(){return function(e){function t(e){return 4>e?"green":7>e?"orange":"red"}function r(e){return 10*e}if(e>=0){var n=e,a=r(e),i=t(e),a=parseFloat(r(e)/100),o=Ext.id();return function(){var e={renderTo:o,value:a,text:n,ctCls:i+"Bar"};if($(o)){new Ext.ProgressBar(e)}}.defer(25),'<span id="'+o+'"></span>'}}},ATF.renderer.progress=function(){return function(e){if(e>=0){var t=Ext.id();return e=parseFloat(e/100),function(){var r={renderTo:t,value:e,text:Math.round(100*e)+" %"};if(e>.66?r.ctCls="greenBar":e>.33?r.ctCls="orangeBar":r.ctCls="redBar",$(t)){new Ext.ProgressBar(r)}}.defer(25),'<span id="'+t+'"></span>'}}},ATF.renderer.meteo=function(){return function(e){if(e){e=parseFloat(e);var t={},r={};if(0!=e){var n=[];if(n[1]="Sunny",n[2]="Mostly_Sunny",n[3]="Mostly_Cloudy",n[4]="Cloudy",n[5]="Rain",n[6]="Cloudy_With_Dizzle",n[7]="Rain_Or_Snow",n[8]="Flurries",n[9]="Snow",n[10]="Thunderstorms",!ATF.meteo)throw"ATF.meteo not found !";meteo_moyenne=ATF.meteo.meteo_moyenne,small=ATF.meteo.small,big=ATF.meteo.big,j=0;var t=[];for(i=2;i<=10;i+=2)j++,t[j]=(meteo_moyenne-small)*(i/10)+small;for(i=2;i<=10;i+=2)j++,t[j]=(big-meteo_moyenne)*(i/10)+meteo_moyenne;for(i=1;i<=10;i++)e<=t[i]&&(r.icone=n[i],r.echelle=i,i=11)}else r.icone="Fog",r.echelle="Pas de données pour la météo";return e='<a rel="'+(r.echelle?r.echelle+"/10":"NC")+'">',e+='<img class="meteo '+r.icone+'" src="'+ATF.blank_png+'" />',e+="</a>"}}},ATF.renderer.atcard=function(){return function(e,t,r){if(r.json){var n=r.data.societe__dot__id_societe;return'<a href="societe,atcard.ajax,id_societe='+n+'"><img class="smallIcon atcard" src="'+ATF.blank_png+'" /></a>'}}},ATF.renderer.derniereFacture=function(){return function(e,t,r,n,a,i){if(r.json){var o=ATF.renderer._datefield(e,t,r,n,a,i);if(e){var s=new Date(e),l=new Date,d=l-s,c=Math.round(d/864e5);return 365>c?'<img class="smallIcon ledgreen" src="'+ATF.blank_png+'" title="'+o+'" alt="'+o+'" />':'<img class="smallIcon ledorange" src="'+ATF.blank_png+'" title="'+o+'" alt="'+o+'" />'}return'<img class="smallIcon ledred" src="'+ATF.blank_png+'" title="'+o+'" alt="'+o+'" />'}}},ATF.renderer.uploadFile=function(e,t){return function(r,n,a,i,o,s){if(a.json){var l=Ext.id(),d=a.data[e+"__dot__id_"+e];return function(){var r={renderTo:l,fileUpload:!0,width:24,layout:"fit",items:[{xtype:"fileuploadfield",id:t,buttonText:"",buttonOnly:!0,buttonCfg:{iconCls:"fileUploadIcon"},listeners:{fileselected:function(){n.getForm().submit({submitEmptyText:!1,method:"post",url:"extjs.ajax",params:{id:d,extAction:e,extMethod:"uploadFileFromSA"},success:function(e,t){ATF.extRefresh(t),s.load()},failure:function(e,t){ATF.extRefresh(t)},timeout:3600})}}}]},n=new Ext.FormPanel(r)}.defer(25),html='<div class="floatLeft" id="'+l+'" style="width:50%; text-align:center"></div>',html+='<div class="floatLeft" style="width:50%; text-align:center">',r?html+='<a href="'+e+"-select-"+t+"-"+d+'.dl" alt="'+ATF.usr.trans("popup_download",e)+'"><img class="smallIcon '+r+'" src="'+ATF.blank_png+'" class="icone" /></a>':html+='<img class="smallIcon warning" src="'+ATF.blank_png+'" />',html+="</div>",html}}},ATF.renderer.updateDate=function(e,t){return function(r,n,a,i,o,s){if(a.json){var l=Ext.id(),d=a.data[e+"__dot__id_"+e];return function(){var r={renderTo:l,bodyStyle:"background-color:transparent; border:0px",frame:!1,border:!1,format:"d-m-Y",defaults:{xtype:"datefield",format:"d-m-Y",width:150,hideLabel:!0},items:[{id:e+"updateDate"+d+t+Ext.id(),name:"updateDate",value:a.data[e+"__dot__"+t],listeners:{select:function(r){ATF.ajax(e+",updateDate.ajax","id_"+e+"="+d+"&key="+t+"&value="+r.value),s.load()},change:function(r){ATF.ajax(e+",updateDate.ajax","id_"+e+"="+d+"&key="+t+"&value="+r.value),s.load()}}}]};new Ext.FormPanel(r)}.defer(25),'<div  id="'+l+'"></div>'}}},ATF.renderer.rating=function(e){return function(t,r,n){if(n.json){var a=Ext.id(),i=(n.data[e+"__dot__id_"+e],n.data[e+"__dot__note"]);return html='<span class="ratingSpriteGrey" title="'+i+'">',html+='<span class="ratingSpriteYellow" style="width: '+10*i+'%;"></span>',html+="</span>",'<div  id="'+a+'">'+html+"</div>"}}},ATF.renderer.etat=function(e,t){return function(r,n,a){var i=Ext.id();a.data[e+"__dot__id_"+e];if(a.data[e+"__dot__"+t])var o=a.data[e+"__dot__"+t];else var o=a.data[t];if(o){var s=!1;switch(html='<img class="smallIcon ',o){case"accepte":case"accepter":html+="accepte";break;case"nok":case"refus":case"refuse":case"refuser":case"perdu":html+="refus";break;case"termine":case"terminee":case"done":case"fini":html+="done";break;case"immo":case"immobilise":html+="immo";break;case"livr":html+="done";break;case"livraison":html+="livraison";break;case"lock":case"bloque":case"close":html+="lock";break;case"unlock":case"open":html+="unlock";break;case"arreter":case"annulee":case"annule":case"cancel":case"mort":case"erreur":case"probleme":html+="perdu";break;case"ok":case"gagne":case"valid":case"valide":case"validee":case"valider":html+="valid";break;case"attente":case"en_attente":case"non_loyer":case"sending":case"wait":html+="wait";break;case"envoyee":case"sent":html+="sent";break;case"a_regler":case"attente_paiement":case"impayee":html+="impayee";break;case"payee":case"facturee":case"vente":html+="payee";break;case"reception":case"recu":html+="recu";break;case"sinistr":case"sinistre":html+="sinistre";break;case"defectueux":html+="broken";break;case"attente_christophe":case"attente_frederique":case"pret":case"en_cours":case"en_attente_etls":case"etude":case"fnp":case"fae":case"stock":case"recu":case"demande":case"remplace":case"mis_loyer":case"prolongation":case"actif":case"indisponible":case"inactif":case"oui":case"non":html+=o;break;default:s=!0,html='<span style="font-weight:bold">'+ATF.usr.trans(o,e)+"</span>"}return s||(html+='" title="'+ATF.usr.trans(o,e)+'"  alt="'+ATF.usr.trans(o,e)+'" src="'+ATF.blank_png+'" />'),'<div class="center" id="'+i+'">'+html+"</div>"}}},ATF.renderer.duree=function(e,t){return function(r,n,i){var o=Ext.id();i.data[e+"__dot__id_"+e];if(i.data[e+"__dot__id_"+t])var s=String(i.data[e+"__dot__id_"+t]);else var s=String(i.data[t]);return s?0==s?html=ATF.usr.trans("aucun"):.5==s?html="1/2 "+ATF.usr.trans("journee"):1==s?html="1 "+ATF.usr.trans("jour"):s.indexOf(".")?(a=s.split("."),html=a[0],a[1]&&5==a[1]?html+=ATF.usr.trans("journee_et_demi"):html+=" "+ATF.usr.trans("jours")):html=a+" "+ATF.usr.trans("jours"):html='<img class="smallIcon noAction" src="'+ATF.blank_png+'" />','<div id="'+o+'">'+html+"</div>"}},ATF.renderer.money=function(e,t){return function(r,n,a){if(!isNaN(r)){var i=Ext.id();a.data[e+"__dot__id_"+e];if(a.data[e+"__dot__"+t])var o=a.data[e+"__dot__"+t];else if(a.data[t])var o=a.data[t];o?strpos(o,",")&&(o=o.replace(",",".")):o=0,o=Math.round(100*(o-0))/100,o=o==Math.floor(o)?o+".00":10*o==Math.floor(10*o)?o+"0":o,o=String(o);for(var s=o.split("."),l=s[0],d=s[1]?"."+s[1]:".00",c=/(\d+)(\d{3})/;c.test(l);)l=l.replace(c,"$1,$2");return o=l+d,"-"==o.charAt(0)&&(o="-"+o.substr(1)),'<div class="right" id="'+i+'">'+o+" &euro;</div>"}}},ATF.renderer.percent=function(e,t){return function(r,n,a){var i=Ext.id();a.data[e+"__dot__id_"+e];if(a.data[e+"__dot__"+t])var o=a.data[e+"__dot__"+t];else if(a.data[t])var o=a.data[t];return o?html=Math.round(100*o)+"%":html="0%",'<div id="'+i+'">'+html+"</div>"}},ATF.renderer.combo=function(e,t){return function(r){var n="";return r&&(n=ATF.usr.trans(t,e,r,!0)),!r||n&&r!=n?n:ATF.usr.trans(r,e)}},ATF.renderer.comboBoxRenderer=function(e){return function(t){var r=e.store.find(e.valueField,t),n=e.store.getAt(r);return n?n.get(e.displayField):t}},ATF.rowEditor=function(e,t,r){return ATF.rowEditor[e]?ATF.rowEditor[e](t,r):ATF.rowEditor.std(t,r)},ATF.rowEditor.std=function(e,t){return new Ext.form.TextField({value:0,id:e+"_"+t+"_"+Ext.id(),fieldLabel:"",listeners:{change:function(){ATF.ajax(e+",update.ajax","id_"+e+"="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue())},specialkey:function(r,n){n.getKey()==n.ENTER&&ATF.ajax(e+",update.ajax","id_"+e+"="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue())}}})},ATF.rowEditor.ouinon=function(e,t){var r=[];return r.push(["oui","Oui"]),r.push(["non","Non"]),new Ext.form.ComboBox({typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:r}),valueField:"myId",displayField:"displayText",listeners:{change:function(){var r=this.gridEditor;ATF.ajax(e+",EtatUpdate.ajax","id_"+e+"="+r.record.data[e+"__dot__id_"+e]+"&field="+t+"&"+t+"="+this.getValue(),{onComplete:function(){r.record.store.reload()}})}}})},ATF.rowEditor.prioriteUpdate=function(e){for(var t=[],r=0;21>r;r++)t.push([r,r]);return new Ext.form.ComboBox({typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:t}),valueField:"myId",displayField:"displayText",listeners:{change:function(){ATF.ajax("hotline,setPriorite.ajax","id_hotline="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&priorite="+this.getValue())}}})},ATF.rowEditor.forecastUpdate=function(e){for(var t=[],r=1;6>r;r++)t.push([20*r,20*r]);return new Ext.form.ComboBox({typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:t}),valueField:"myId",displayField:"displayText",listeners:{change:function(){ATF.ajax("affaire,setForecast.ajax","id_affaire="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&forecast="+this.getValue())}}})},ATF.rowEditor.actifUpdate=function(e,t){var r=[];return r.push(["actif","Actif"]),r.push(["inactif","Inactif"]),new Ext.form.ComboBox({typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:r}),valueField:"myId",displayField:"displayText",listeners:{change:function(){var r=this.gridEditor;ATF.ajax(e+",actifUpdate.ajax","id_"+e+"="+r.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue(),{onComplete:function(){r.record.store.reload()}})}}})},ATF.rowEditor.interesseUpdate=function(e,t){var r=[];return r.push(["oui","Oui"]),r.push(["non","Non"]),r.push(["attente","En attente"]),new Ext.form.ComboBox({typeAhead:!0,triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:r}),valueField:"myId",displayField:"displayText",listeners:{change:function(){var r=this.gridEditor;ATF.ajax(e+",interesseUpdate.ajax","id_"+e+"="+r.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue(),{onComplete:function(){r.record.store.reload()}})}}})},ATF.rowEditor.setInfos=function(e,t){return new Ext.form.TextField({value:0,id:e+"_"+t+"_"+Ext.id(),fieldLabel:"",listeners:{change:function(){ATF.ajax(e+",setInfos.ajax","id_"+e+"="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue()+"&field="+t)},specialkey:function(r,n){n.getKey()==n.ENTER&&ATF.ajax(e+",setInfos.ajax","id_"+e+"="+this.gridEditor.record.data[e+"__dot__id_"+e]+"&"+t+"="+this.getValue()+"&field="+t)}}})},ATF.usr={lang:"fr",trans:function(e,t,r,n,a){if("Array"==typeof e){var i;for(var o in e){var s=e[o];i[o]=ATF.usr.trans(s,t,r,n,id_language)}return i}return t&&r&&ATF.loc[t+"_"+e+"_"+r]?ATF.loc[t+"_"+e+"_"+r]:!t||!ATF.loc[t+"_"+e]||r&&n?!ATF.loc[e]||(r||t)&&n?n?a?ATF.usr.trans(e,t+"_"+a,r,n):void 0:e:ATF.loc[e]:ATF.loc[t+"_"+e]}},ATF.loc={},"undefined"!=typeof Ext&&Ext.onReady(function(){Ext.form.Action&&Ext.extend(Ext.form.Action.Submit,Ext.form.Action,{type:"submit",run:function(){var e=this.options,t=this.getMethod(),r="GET"==t;if(e.clientValidation===!1||this.form.isValid()){if(e.submitEmptyText===!1){var n=this.form.items,a=[],i=function(e){e.el&&e.el.getValue()==e.emptyText&&(a.push(e),e.el.dom.value=""),e.isComposite&&e.rendered&&e.items.each(i)};n.each(i)}Ext.Ajax.request(Ext.apply(this.createCallback(e),{form:this.form.el.dom,url:this.getUrl(r),method:t,headers:e.headers,params:r?null:this.getParams(),isUpload:this.form.fileUpload})),e.submitEmptyText===!1&&Ext.each(a,function(e){e.applyEmptyText&&e.applyEmptyText()})}else e.clientValidation!==!1&&(this.failureType=Ext.form.Action.CLIENT_INVALID,this.form.afterAction(this,!1))},success:function(e){var t=this.processResponse(e);return t===!0||t.success?void this.form.afterAction(this,!0):(t.errors&&this.form.markInvalid(t.errors),this.failureType=Ext.form.Action.SERVER_INVALID,void this.form.afterAction(this,!1))},handleResponse:function(e){if(this.form.errorReader){var t=this.form.errorReader.read(e),r=[];if(t.records)for(var n=0,a=t.records.length;a>n;n++){var i=t.records[n];r[n]=i.data}return r.length<1&&(r=null),{success:t.success,errors:r}}return Ext.decode(e.responseText)}})}),"undefined"==typeof Range||Range.prototype.createContextualFragment||(Range.prototype.createContextualFragment=function(e){var t=document.createDocumentFragment(),r=document.createElement("div");return t.appendChild(r),r.outerHTML=e,t}),"undefined"!=typeof Ext&&Ext.onReady(function(){Ext.DomQuery.matchers&&(Ext.DomQuery.matchers[2]={re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?(["']?)(.*?)\4)?[\]\}])/,select:'n = byAttribute(n, "{2}", "{5}", "{3}", "{1}");'},Ext.override(Ext.form.Radio,{getGroupValue:function(){var e=this.el.up("form")||Ext.getBody(),t=e.child('input[name="'+this.el.dom.name+'"]:checked',!0);return t?t.value:null},onClick:function(){if(this.el.dom.checked!=this.checked){var e=this.getCheckEl().select('input[name="'+this.el.dom.name+'"]');e.each(function(e){e.dom.id==this.id?this.setValue(!0):Ext.getCmp(e.dom.id).setValue(!1)},this)}},setValue:function(e){if("boolean"==typeof e)Ext.form.Radio.superclass.setValue.call(this,e);else{var t=this.getCheckEl().child('input[name="'+this.el.dom.name+'"][value="'+e+'"]',!0);t&&Ext.getCmp(t.id).setValue(!0)}return this}}))}),ATF.gridGetCols=function(e,t){if(t){var r="";for(ind in e)"updateBtn"==e[ind].dataIndex||1!=e[ind].hideable||e[ind].hidden||(r&&(r+=","),r+=e[ind].dataIndex)}else{var r=Array();for(ind in e)"updateBtn"==e[ind].dataIndex||1!=e[ind].hideable||e[ind].hidden||(r[ind]=e[ind].dataIndex)}return r},ATF.gridRaffraichissement=function(nom_grid,id_grid,reponse,nom_pager,searchbox,nom_table){ATF.loadMask.hide(),eval(reponse),nom_grid.colModel.setConfig(cols[nom_pager]),store[nom_pager].searchBox=searchbox,store[nom_pager].searchBox.store=store[nom_pager],nom_grid.reconfigure(store[nom_pager],nom_grid.colModel),Ext.getCmp(id_grid).getStore().load({params:{start:0,limit:30}}),ATF.modifColsEvent(nom_table,nom_grid,cols[nom_pager])},ATF.gridCheckCols=function(e,t,r){var n=new RegExp("("+t+".)","g"),a=r.replace(n,""),i=t+"__dot__"+a;for(ind in e)if("updateBtn"!=e[ind].dataIndex&&1==e[ind].hideable&&!e[ind].hidden&&(e[ind].dataIndex==r||e[ind].dataIndex==i))return!0;return!1},ATF.modifColsEvent=function(e,t,r){t.colModel.on("columnmoved",function(){ATF.ajax("vue,update.ajax","vue="+e+"&ordre_colonne="+ATF.gridGetCols(r))}),t.on("columnresize",function(){var t="";for(ind in r)"updateBtn"==r[ind].dataIndex||1!=r[ind].hideable||r[ind].hidden||(t&&(t+=","),t+=r[ind].dataIndex+"-"+r[ind].width);ATF.ajax("vue,update.ajax","vue="+e+"&ordre_colonne="+ATF.gridGetCols(r)+"&tailles="+t)}),t.on("sortchange",function(n,a){ATF.ajax("vue,update.ajax","vue="+e+"&ordre_colonne="+ATF.gridGetCols(r)+"&champs="+a.field+"&ordre="+a.direction,{onComplete:function(){t.saveHeight="undefined"}})})},ATF.toolbarAddBold=function(e){var t=e.parentMenu.ownerCt;t&&"Vue"!=t.text&&(t.addClass("bold"),ATF.toolbarAddBold(t))},ATF.toolbarRemoveBold=function(e){var t=e.parentMenu.ownerCt,r=t.menu.items.items;for(cle_enfant in r)if(1==r[cle_enfant].checked)return;t.removeClass("bold"),ATF.toolbarRemoveGrandParentBold(t)},ATF.toolbarRemoveGrandParentBold=function(e){var t=e.parentMenu.ownerCt,r=t.menu.items.items;for(cle_freres in r)if(r[cle_freres].menu){var n=r[cle_freres].menu.items.items;for(cle_enfant in n)if(1==n[cle_enfant].checked)return}t.removeClass("bold")},ATF.chargerAggregat=function(e,t,r){var n=Ext.getCmp(t),a=n.getColumnModel().config,i=n.store.recordType,o=30;if(n.store.totalLength<30&&(o=n.store.totalLength),o>1&&n.store.data.length<31){var s=new i,l=new i,d=new i,c=new i;n.store.insert(0,l),n.store.insert(1,d),n.store.insert(2,c),n.store.insert(3,s);var u=n.store.getAt(0),m=n.store.getAt(1),g=n.store.getAt(2),f=n.store.getAt(3);for(ind in a)!a[ind].hidden&&a[ind].dataIndex&&ATF.ajax(r+",recupAggregate.ajax","champs="+a[ind].dataIndex,{onComplete:function(e){e.result&&(e.result.sum&&(f.set(e.result.sum.champs,e.result.sum.valeur),f.set("updateBtn",ATF.usr.trans("sum","aggregat"))),e.result.min&&(u.set(e.result.min.champs,e.result.min.valeur),u.set("updateBtn",ATF.usr.trans("min","aggregat"))),e.result.max&&(m.set(e.result.max.champs,e.result.max.valeur),m.set("updateBtn",ATF.usr.trans("max","aggregat"))),e.result.avg&&(g.set(e.result.avg.champs,e.result.avg.valeur),g.set("updateBtn",ATF.usr.trans("avg","aggregat"))))}})}},ATF.cacherAggregat=function(e,t){for(var r=Ext.getCmp(t),n=0;3>=n;n++)r.store.removeAt(0)},ATF.actionAggregat=function(e,t,r,n){ATF.ajax(r+",saveAggregat.ajax","filtre="+n,{onComplete:function(n){1==n.result?ATF.chargerAggregat(e,t,r):ATF.cacherAggregat(e,t,r)}})},ATF.is_array=function(e){return"object"==typeof e&&e instanceof Array},ATF.is_object=function(e){return"[object Array]"===Object.prototype.toString.call(e)?!1:null!==e&&"object"==typeof e},Modalbox={show:function(e,t){if(t=t||{},!$("#modalBox").length){var r=$("<div id='modalBox'></div>");$("body").prepend(r)}if($("#modalBox").length>0){var n=$("#modalBox");n.html(e),".dialog"==e.slice(-7)&&n.load(e,t),n.dialog({autoOpen:!0,title:t.title,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3}})}},hide:function(){$("#modalBox")&&$("#modalBox").remove()}};